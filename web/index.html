<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Intercambio de Aguacates - Consola de Trading</title>
    
    <!-- Avocado Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f951.png">
    <link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f951.png">
    
    <!-- Meta tags for better SEO and branding -->
    <meta name="description" content="Plataforma profesional de trading de aguacates con simulaci贸n en tiempo real y herramientas avanzadas de an谩lisis.">
    <meta name="keywords" content="trading, aguacates, avocado, exchange, mercado, simulaci贸n, finanzas">
    <meta name="author" content="Intercambio de Aguacates">
    <meta name="theme-color" content="#00b894">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:title" content=" Intercambio de Aguacates - Trading Platform">
    <meta property="og:description" content="Plataforma profesional de trading con simulaci贸n en tiempo real y an谩lisis avanzado.">
    <meta property="og:image" content="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f951.png">
    <meta property="og:url" content="">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content=" Intercambio de Aguacates - Trading Platform">
    <meta name="twitter:description" content="Plataforma profesional de trading con simulaci贸n en tiempo real.">
    <meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f951.png">
    
    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #7c3aed;
            --accent-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --success-color: #059669;
            --info-color: #0284c7;
            --dark-bg: #1f2937;
            --card-bg: #374151;
            --border-color: #d1d5db;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --avocado-green: #059669;
            --avocado-dark: #047857;
            --bg-gradient: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 50%, #d1d5db 100%);
        }
        
        html, body {
            font-family: 'Inter', sans-serif !important;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-primary);
        }
        
        .is-family-monospace {
            font-family: 'JetBrains Mono', monospace !important;
        }
        
        /* Avocado theme customizations */
        .has-background-avocado {
            background-color: var(--avocado-green) !important;
        }
        
        .has-text-avocado {
            color: var(--avocado-green) !important;
        }
        
        .button.is-avocado {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        
        .button.is-avocado:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        
        /* Enhanced Bulma components */
        .box {
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            background: white;
            border: 1px solid #e1e8ed;
        }
        
        .box:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        
        /* Hero customizations */
        .hero.is-avocado {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        
        .hero-pattern {
            position: relative;
            overflow: hidden;
        }
        
        .hero-pattern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        /* Status Indicators */
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-connected { background: var(--success-color); }
        .status-connecting { background: var(--warning-color); }
        .status-disconnected { background: var(--danger-color); }
        .status-authenticated { background: var(--info-color); }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* Simple animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Stats cards */
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary-color);
            border: 1px solid #e5e7eb;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        /* Message Styles */
        .message-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            border-left: 4px solid;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .message-success {
            border-color: var(--success-color);
            color: #047857;
        }
        
        .message-error {
            border-color: var(--danger-color);
            color: #b91c1c;
        }
        
        .message-info {
            border-color: var(--info-color);
            color: #0369a1;
        }
        
        .message-warning {
            border-color: var(--warning-color);
            color: #b45309;
        }
        
        .message-fill {
            border-color: var(--secondary-color);
            color: #6b21a8;
        }
        
        /* Navbar customizations */
        .navbar.is-avocado {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Button customizations */
        .button {
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Input customizations */
        .input, .textarea, .select select {
            border-radius: 8px;
            border: 2px solid #e1e8ed;
            transition: all 0.3s ease;
        }
        
        .input:focus, .textarea:focus, .select select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.125em rgba(37, 99, 235, 0.25);
        }
        
        /* Scrollbar customizations */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f2f6;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #b2bec3;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #636e72;
        }
        


        
        /* Status indicators */
        .status-indicator {
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 11px;
        }
        
        .status-disconnected { 
            background: rgba(220, 38, 38, 0.1); 
            border: 1px solid var(--danger-color); 
            color: #b91c1c;
        }
        .status-connected { 
            background: rgba(5, 150, 105, 0.1); 
            border: 1px solid var(--success-color); 
            color: #047857;
        }
        .status-authenticated { 
            background: rgba(2, 132, 199, 0.1); 
            border: 1px solid var(--info-color); 
            color: #0369a1;
        }
        
        /* Order book and trading specific styles */
        .order-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
        }
        
        .order-item.buy { border-left-color: var(--success-color); }
        .order-item.sell { border-left-color: var(--danger-color); }
        .order-item.filled { border-left-color: var(--secondary-color); }
        .order-item.pending { border-left-color: var(--warning-color); }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            font-weight: 600;
        }
        
        .order-details {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        /* Ticker items */
        .ticker-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
        }
        
        .price-bid { color: var(--success-color); font-weight: 600; }
        .price-ask { color: var(--danger-color); font-weight: 600; }
        .price-mid { color: var(--warning-color); font-weight: 600; }
        
        /* Team info and utility styles */
        .team-info {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid #e1e8ed;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .team-info p {
            margin: 8px 0;
            color: #636e72;
        }
        
        .team-info strong {
            color: #2d3436;
        }
        
        /* Order book styles */
        .order-book-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px;
        }
        
        .order-book-side {
            background: white;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #e1e8ed;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .order-book-side h5 {
            font-size: 14px;
            margin-bottom: 12px;
            text-align: center;
            font-weight: 600;
        }
        
        .order-book-side.buy h5 { color: var(--success-color); }
        .order-book-side.sell h5 { color: var(--danger-color); }
        
        .order-book-entry {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            background: #f8f9fa;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Utility classes */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .inventory-item {
            background: white;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid #e1e8ed;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Alert notifications */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1001;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            animation: slideInRight 0.3s ease;
        }

        .alert.success {
            background: #d1f2eb;
            color: #00a085;
            border: 1px solid #00b894;
        }

        .alert.error {
            background: #fdf2f2;
            color: #d63031;
            border: 1px solid #e17055;
        }

        .alert.warning {
            background: #fef9e7;
            color: #e17055;
            border: 1px solid #fdcb6e;
        }

        .alert.info {
            background: #e3f2fd;
            color: #0984e3;
            border: 1px solid #74b9ff;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        /* Enhanced input validation */
        .input.is-valid {
            border-color: #00b894;
            box-shadow: 0 0 0 0.125em rgba(0, 184, 148, 0.25);
        }
        
        .input.is-invalid {
            border-color: #e17055;
            box-shadow: 0 0 0 0.125em rgba(225, 112, 85, 0.25);
        }
        
        /* Pulse animation for important buttons */
        .button.pulse {
            animation: pulse-button 2s infinite;
        }
        
        @keyframes pulse-button {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Keyboard shortcuts styling */
        kbd {
            background: #f1f2f6;
            border: 1px solid #ddd;
            border-radius: 3px;
            box-shadow: 0 1px 0 rgba(0,0,0,0.2);
            color: #333;
            display: inline-block;
            font-size: 0.8em;
            font-weight: 700;
            line-height: 1;
            padding: 2px 4px;
            white-space: nowrap;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .columns {
                margin: 0;
            }
            
            .column {
                padding: 0.5rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .button {
                font-size: 0.875rem;
            }
            
            .tabs {
                font-size: 0.875rem;
            }
            
            .modal-card {
                margin: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar is-avocado" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <div class="navbar-item">
                <span class="icon is-large mr-2">
                    <i class="fas fa-seedling fa-2x"></i>
                </span>
                <div>
                    <h1 class="title is-4 has-text-white mb-1"> Intercambio de Aguacates</h1>
                    <p class="subtitle is-6 has-text-white-ter">Consola de Trading Profesional</p>
                </div>
            </div>
            
            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" onclick="toggleMobileMenu()">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        
        <div class="navbar-menu" id="navbarMenu">
            <div class="navbar-end">
                        <div class="navbar-item">
                            <div class="field is-grouped">
                                <div class="control">
                                    <div class="tags has-addons">
                                        <span class="tag is-dark">Estado</span>
                                        <span class="tag" id="status-tag">
                                            <span id="status-dot" class="status-dot status-disconnected"></span>
                                            <span id="status-text">Desconectado</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="control">
                                    <span class="tag is-info is-light" id="connection-time"></span>
                                </div>
                                <div class="control">
                                    <button class="button is-small is-outlined" onclick="showKeyboardShortcuts()" title="Atajos de teclado">
                                        <span class="icon">
                                            <i class="fas fa-keyboard"></i>
                                        </span>
                                    </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Connected Sessions Display -->
                            <div class="card">
                                <div class="card-content">
                                    <h3 class="title is-6">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-users"></i></span>
                                            <span>Sesiones Conectadas</span>
                                        </span>
                                    </h3>
                                    <div id="sessions-list" style="max-height: 300px; overflow-y: auto;">
                                        <div class="notification is-info is-light">
                                            <i class="fas fa-info-circle"></i> No hay sesiones conectadas
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero is-avocado is-medium hero-pattern">
        <div class="hero-body">
            <div class="container">
                <div class="columns is-vcentered">
                    <div class="column">
                        <h1 class="title is-1 has-text-white">
                            <span class="icon-text">
                                <span class="icon is-large">
                                    <i class="fas fa-chart-line"></i>
                                </span>
                                <span>Trading Dashboard</span>
                            </span>
                        </h1>
                        <h2 class="subtitle is-3 has-text-white-ter">
                            Plataforma avanzada de trading con simulaci贸n en tiempo real
                        </h2>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="section">
        <div class="container is-fluid">
            <div class="columns">
                <!-- Left Sidebar -->
                <div class="column is-3">
                    <div class="box">
                        <div class="tabs is-boxed">
                            <ul>
                                <li class="is-active">
                                    <a onclick="switchSidebarTab('auth')">
                                        <span class="icon is-small"><i class="fas fa-key"></i></span>
                                        <span>Autenticaci贸n</span>
                                    </a>
                                </li>
                                <li>
                                    <a onclick="switchSidebarTab('simulator')">
                                        <span class="icon is-small"><i class="fas fa-rocket"></i></span>
                                        <span>Simulador</span>
                                    </a>
                                </li>
                                <li>
                                    <a onclick="switchSidebarTab('debug')">
                                        <span class="icon is-small"><i class="fas fa-bug"></i></span>
                                        <span>Debug</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Auth Tab Content -->
                        <div id="auth-content" class="tab-content">
                            <div class="card">
                                <div class="card-content">
                                    <h3 class="title is-5">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-shield-alt"></i></span>
                                            <span>Autenticaci贸n</span>
                                        </span>
                                    </h3>
                                    
                                    <div class="field">
                                        <label class="label">Token del Equipo</label>
                                        <div class="control has-icons-left">
                                            <input class="input" type="text" id="token" placeholder="TK-XXXX" title="Ingrese su token de equipo proporcionado por el profesor">
                                            <span class="icon is-small is-left">
                                                <i class="fas fa-key"></i>
                                            </span>
                                        </div>
                                        <p class="help is-info">
                                            <i class="fas fa-info-circle"></i>
                                            El token debe tener el formato TK-XXXX (ejemplo: TK-1234)
                                        </p>
                                    </div>
                                    
                                    <div class="field is-grouped">
                                        <div class="control">
                                            <button class="button is-avocado" id="connect-btn" onclick="toggleConnection()">
                                                <span class="icon">
                                                    <i class="fas fa-plug"></i>
                                                </span>
                                                <span>Conectar</span>
                                            </button>
                                        </div>
                                        <div class="control">
                                            <button class="button is-primary" id="login-btn" onclick="login()" disabled>
                                                <span class="icon">
                                                    <i class="fas fa-sign-in-alt"></i>
                                                </span>
                                                <span>Login</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="team-info" class="notification is-success" style="display: none;">
                                        <div id="team-details"></div>
                                    </div>
                                    
                                    <!-- Quick Start Guide -->
                                    <div class="notification is-info is-light" id="quick-start-guide">
                                        <h4 class="title is-6">
                                            <i class="fas fa-rocket"></i> Gu铆a R谩pida
                                        </h4>
                                        <div class="content">
                                            <ol style="font-size: 0.875rem;">
                                                <li><strong>Conectar:</strong> Haga clic en "Conectar" para establecer conexi贸n</li>
                                                <li><strong>Autenticar:</strong> Ingrese su token y haga clic en "Login"</li>
                                                <li><strong>Comerciar:</strong> Use las pesta帽as "Simulador" o "Trading" para realizar 贸rdenes</li>
                                                <li><strong>Debug:</strong> Use la pesta帽a "Debug" para pruebas avanzadas</li>
                                            </ol>
                                        </div>
                                        <button class="button is-small" onclick="document.getElementById('quick-start-guide').style.display='none'">
                                            <i class="fas fa-times"></i> Cerrar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Inventory Card -->
                            <div class="card">
                                <div class="card-content">
                                    <h3 class="title is-5">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-boxes"></i></span>
                                            <span>Inventario</span>
                                        </span>
                                    </h3>
                                    <div id="inventory-grid" class="inventory-grid">
                                        <div class="inventory-item">
                                            <div class="has-text-grey">Sin datos</div>
                                        </div>
                                    </div>
                                    <div id="inventory-visualizer" class="inventory-grid" style="display: none;">
                                        <div class="inventory-item">Sin inventario</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Simulator Tab Content -->
                        <div id="simulator-content" class="tab-content" style="display: none;">
                            <div class="card">
                                <div class="card-content">
                                    <h3 class="title is-5">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-rocket"></i></span>
                                            <span>Simulador de Mercado</span>
                                        </span>
                                    </h3>
                                    
                                    <div class="field">
                                        <label class="label">Tipo de Orden</label>
                                        <div class="control has-icons-left">
                                            <div class="select is-fullwidth">
                                                <select id="sim-side">
                                                    <option value="BUY"> Comprar</option>
                                                    <option value="SELL"> Vender</option>
                                                </select>
                                            </div>
                                            <span class="icon is-small is-left">
                                                <i class="fas fa-exchange-alt"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <label class="label">Producto</label>
                                        <div class="control has-icons-left">
                                            <div class="select is-fullwidth">
                                                <select id="sim-product">
                                                    <option value="FOSFO">FOSFO</option>
                                                    <option value="PITA">PITA</option>
                                                    <option value="PALTA-OIL">PALTA-OIL</option>
                                                    <option value="GUACA">GUACA</option>
                                                    <option value="SEBO">SEBO</option>
                                                    <option value="H-GUACA">H-GUACA</option>
                                                </select>
                                            </div>
                                            <span class="icon is-small is-left">
                                                <i class="fas fa-leaf"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="columns">
                                        <div class="column">
                                            <div class="field">
                                                <label class="label">Cantidad</label>
                                                <div class="control has-icons-left">
                                                    <input class="input" type="number" id="sim-qty" placeholder="10" min="1" title="N煤mero de unidades a comercializar">
                                                    <span class="icon is-small is-left">
                                                        <i class="fas fa-hashtag"></i>
                                                    </span>
                                                </div>
                                                <p class="help">Unidades (n煤mero entero positivo)</p>
                                            </div>
                                        </div>
                                        <div class="column">
                                            <div class="field">
                                                <label class="label">Precio</label>
                                                <div class="control has-icons-left">
                                                    <input class="input" type="number" id="sim-price" placeholder="15.50" step="0.01" title="Precio por unidad en d贸lares">
                                                    <span class="icon is-small is-left">
                                                        <i class="fas fa-dollar-sign"></i>
                                                    </span>
                                                </div>
                                                <p class="help">Precio por unidad ($USD)</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <div class="control">
                                            <button class="button is-success is-fullwidth" onclick="createMarketOrder()" disabled id="create-order-btn">
                                                <span class="icon">
                                                    <i class="fas fa-chart-line"></i>
                                                </span>
                                                <span>Crear Orden de Mercado</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Advanced Market Making -->
                                    <div class="field" style="margin-top: 1rem;">
                                        <label class="label">Herramientas Avanzadas</label>
                                        <div class="columns">
                                            <div class="column">
                                                <button class="button is-warning is-fullwidth" onclick="toggleAutoMarketMaker()" disabled id="auto-mm-btn">
                                                    <span class="icon">
                                                        <i class="fas fa-robot"></i>
                                                    </span>
                                                    <span> Activar Auto-MM</span>
                                                </button>
                                            </div>
                                            <div class="column">
                                                <button class="button is-danger is-fullwidth" onclick="clearAllOrders()" disabled id="clear-all-btn">
                                                    <span class="icon">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </span>
                                                    <span>Limpiar rdenes</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Debug Tab Content -->
                        <div id="debug-content" class="tab-content" style="display: none;">
                            <div class="card">
                                <div class="card-content">
                                    <h3 class="title is-5">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-bug"></i></span>
                                            <span>Herramientas de Debug</span>
                                        </span>
                                    </h3>
                                    
                                    <div class="buttons">
                                        <button class="button is-danger" onclick="injectError('INSUFFICIENT_BALANCE')" disabled id="err-balance-btn">
                                            <span class="icon">
                                                <i class="fas fa-exclamation-triangle"></i>
                                            </span>
                                            <span>Saldo Insuficiente</span>
                                        </button>
                                        <button class="button is-warning" onclick="injectError('UNAUTHORIZED_PRODUCT')" disabled id="err-product-btn">
                                            <span class="icon">
                                                <i class="fas fa-ban"></i>
                                            </span>
                                            <span>Producto No Autorizado</span>
                                        </button>
                                        <button class="button is-warning" onclick="injectError('DISCONNECT_CLIENT')" disabled id="err-disconnect-btn">
                                            <span class="icon">
                                                <i class="fas fa-unlink"></i>
                                            </span>
                                            <span>Desconectar</span>
                                        </button>
                                        <button class="button is-info" onclick="injectError('OFFER_EXPIRED')" disabled id="err-expire-btn">
                                            <span class="icon">
                                                <i class="fas fa-clock"></i>
                                            </span>
                                            <span>Expirar Oferta</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Production Testing -->
                            <div class="card">
                                <div class="card-content">
                                    <h3 class="title is-6">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-industry"></i></span>
                                            <span>Prueba de Producci贸n</span>
                                        </span>
                                    </h3>
                                    
                                    <div class="field">
                                        <label class="label">Producto</label>
                                        <div class="control has-icons-left">
                                            <div class="select is-fullwidth">
                                                <select id="prod-product">
                                                    <option value="FOSFO">FOSFO</option>
                                                    <option value="PITA">PITA</option>
                                                    <option value="PALTA-OIL">PALTA-OIL</option>
                                                    <option value="GUACA">GUACA</option>
                                                    <option value="SEBO">SEBO</option>
                                                    <option value="H-GUACA">H-GUACA</option>
                                                </select>
                                            </div>
                                            <span class="icon is-small is-left">
                                                <i class="fas fa-leaf"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <label class="label">Cantidad</label>
                                        <div class="control has-icons-left">
                                            <input class="input" type="number" id="prod-qty" placeholder="Cantidad" min="1">
                                            <span class="icon is-small is-left">
                                                <i class="fas fa-hashtag"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <div class="control">
                                            <button class="button is-info is-fullwidth" onclick="testProduction()" disabled id="prod-btn">
                                                <span class="icon">
                                                    <i class="fas fa-flask"></i>
                                                </span>
                                                <span>Simular Producci贸n</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="production-result" class="notification is-info is-light" style="display: none;">
                                        <div><strong>Producci贸n Recibida:</strong> <span id="prod-received"></span></div>
                                        <div><strong>Esperado (algoritmo):</strong></div>
                                        <div id="prod-algorithm"></div>
                                        <div><strong>Resultado:</strong> <span id="prod-validation"></span></div>
                                        <div><strong>Bonus Premium:</strong> <span id="prod-premium"></span></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Offer Testing -->
                            <div class="card">
                                <div class="card-content">
                                    <h3 class="title is-6">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-handshake"></i></span>
                                            <span>Prueba de Ofertas</span>
                                        </span>
                                    </h3>
                                    
                                    <div class="field">
                                        <label class="label">Producto</label>
                                        <div class="control has-icons-left">
                                            <div class="select is-fullwidth">
                                                <select id="offer-product">
                                                    <option value="FOSFO">FOSFO</option>
                                                    <option value="PITA">PITA</option>
                                                    <option value="PALTA-OIL">PALTA-OIL</option>
                                                    <option value="GUACA">GUACA</option>
                                                    <option value="SEBO">SEBO</option>
                                                    <option value="H-GUACA">H-GUACA</option>
                                                </select>
                                            </div>
                                            <span class="icon is-small is-left">
                                                <i class="fas fa-leaf"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="columns">
                                        <div class="column">
                                            <div class="field">
                                                <label class="label">Cantidad</label>
                                                <div class="control has-icons-left">
                                                    <input class="input" type="number" id="offer-qty" placeholder="Cantidad" min="1">
                                                    <span class="icon is-small is-left">
                                                        <i class="fas fa-hashtag"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="column">
                                            <div class="field">
                                                <label class="label">Precio M谩ximo</label>
                                                <div class="control has-icons-left">
                                                    <input class="input" type="number" id="offer-max-price" placeholder="Precio M谩ximo" step="0.01">
                                                    <span class="icon is-small is-left">
                                                        <i class="fas fa-dollar-sign"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <label class="label">Mensaje</label>
                                        <div class="control">
                                            <textarea class="textarea" id="offer-message" placeholder="隆Urgente! Necesario para producci贸n premium" rows="2"></textarea>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <div class="control">
                                            <button class="button is-warning is-fullwidth" onclick="sendTestOffer()" disabled id="send-offer-btn">
                                                <span class="icon">
                                                    <i class="fas fa-paper-plane"></i>
                                                </span>
                                                <span>Enviar Oferta</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="offer-response" class="notification is-info is-light" style="display: none;">
                                        <div>憋 Tiempo de respuesta: <span id="response-timer">--</span></div>
                                        <div><strong>Estado:</strong> <span id="offer-status">Pendiente...</span></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Additional Tools -->
                            <div class="card">
                                <div class="card-content">
                                    <h3 class="title is-6">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-tools"></i></span>
                                            <span>Herramientas Adicionales</span>
                                        </span>
                                    </h3>
                                    
                                    <div class="buttons">
                                        <button class="button is-info is-small" onclick="requestAllOrders()" disabled id="all-orders-btn">
                                            <span class="icon">
                                                <i class="fas fa-list"></i>
                                            </span>
                                            <span>Todas las rdenes</span>
                                        </button>
                                        <button class="button is-info is-small" onclick="requestOrderBook()" disabled id="order-book-btn">
                                            <span class="icon">
                                                <i class="fas fa-book"></i>
                                            </span>
                                            <span>Libro de rdenes</span>
                                        </button>
                                        <button class="button is-info is-small" onclick="sendPing()" disabled id="ping-btn">
                                            <span class="icon">
                                                <i class="fas fa-satellite-dish"></i>
                                            </span>
                                            <span>Ping</span>
                                        </button>
                                        <button class="button is-info is-small" onclick="requestResync()" disabled id="resync-btn">
                                            <span class="icon">
                                                <i class="fas fa-sync"></i>
                                            </span>
                                            <span>Resync</span>
                                        </button>
                                        <button class="button is-info is-small" onclick="requestConnectedSessions()" disabled id="sessions-btn">
                                            <span class="icon">
                                                <i class="fas fa-users"></i>
                                            </span>
                                            <span>Sesiones</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Main Content Area -->
                <div class="column is-6">
                    <div class="tabs is-boxed">
                        <ul>
                            <li class="is-active">
                                <a onclick="switchMainTab('dashboard')">
                                    <span class="icon is-small"><i class="fas fa-tachometer-alt"></i></span>
                                    <span>Dashboard</span>
                                </a>
                            </li>
                            <li>
                                <a onclick="switchMainTab('ticker')">
                                    <span class="icon is-small"><i class="fas fa-chart-area"></i></span>
                                    <span>Ticker</span>
                                </a>
                            </li>
                            <li>
                                <a onclick="switchMainTab('orderbook')">
                                    <span class="icon is-small"><i class="fas fa-list-alt"></i></span>
                                    <span>Libro de rdenes</span>
                                </a>
                            </li>
                            <li>
                                <a onclick="switchMainTab('transactions')">
                                    <span class="icon is-small"><i class="fas fa-history"></i></span>
                                    <span>Transacciones</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div id="dashboard-content" class="content-tab">
                        <!-- Stats Cards -->
                        <div class="columns">
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value" id="dashboard-balance">$--</div>
                                    <div class="stat-label">Balance Total</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value" id="dashboard-profit">$--</div>
                                    <div class="stat-label">Ganancias/P茅rdidas</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value" id="dashboard-orders">--</div>
                                    <div class="stat-label">rdenes Activas</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value" id="dashboard-fills">--</div>
                                    <div class="stat-label">Ejecuciones</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Additional Dashboard Stats -->
                        <div class="columns">
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value" id="dashboard-volume">--</div>
                                    <div class="stat-label">Volumen 24h</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value" id="dashboard-connections">--</div>
                                    <div class="stat-label">Conexiones</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value">
                                        <span id="server-status"></span>
                                        <span id="last-update" style="font-size: 0.5em; display: block;">--</span>
                                    </div>
                                    <div class="stat-label">Estado del Servidor</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Market Activity -->
                        <div class="box">
                            <h3 class="title is-4">
                                <span class="icon-text">
                                    <span class="icon"><i class="fas fa-chart-line"></i></span>
                                    <span>Actividad del Mercado</span>
                                </span>
                            </h3>
                            <div id="market-activity">
                                <div class="notification is-info is-light">
                                    <i class="fas fa-info-circle"></i> Conecta para ver la actividad del mercado en tiempo real
                                </div>
                            </div>
                        </div>
                        
                        <!-- Top Products -->
                        <div class="box">
                            <h3 class="title is-5">
                                <span class="icon-text">
                                    <span class="icon"><i class="fas fa-trophy"></i></span>
                                    <span>Top Productos</span>
                                </span>
                            </h3>
                            <div id="top-products">
                                <p>Cargando datos...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ticker Content -->
                    <div id="ticker-content" class="content-tab" style="display: none;">
                        <div class="box">
                            <h3 class="title is-4">
                                <span class="icon-text">
                                    <span class="icon"><i class="fas fa-chart-area"></i></span>
                                    <span>Ticker de Mercado en Vivo</span>
                                </span>
                            </h3>
                            <div id="ticker-list" class="columns is-multiline">
                                <div class="column is-full">
                                    <div class="notification is-warning is-light">
                                        <i class="fas fa-exclamation-triangle"></i> No hay datos de mercado disponibles
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Book Content -->
                    <div id="orderbook-content" class="content-tab" style="display: none;">
                        <div class="box">
                            <div class="level">
                                <div class="level-left">
                                    <div class="level-item">
                                        <h3 class="title is-4">
                                            <span class="icon-text">
                                                <span class="icon"><i class="fas fa-list-alt"></i></span>
                                                <span>Libro de rdenes</span>
                                            </span>
                                        </h3>
                                    </div>
                                </div>
                                <div class="level-right">
                                    <div class="level-item">
                                        <div class="field">
                                            <div class="control has-icons-left">
                                                <div class="select">
                                                    <select id="product-selector" onchange="updateOrderBook()">
                                                        <option value="">Seleccionar Producto</option>
                                                        <option value="FOSFO">FOSFO</option>
                                                        <option value="PITA">PITA</option>
                                                        <option value="PALTA-OIL">PALTA-OIL</option>
                                                        <option value="GUACA">GUACA</option>
                                                        <option value="SEBO">SEBO</option>
                                                        <option value="H-GUACA">H-GUACA</option>
                                                    </select>
                                                </div>
                                                <span class="icon is-small is-left">
                                                    <i class="fas fa-leaf"></i>
                                                </span>
                            </div>
                            

                                    </div>
                                    
                                    <!-- Price Adjustment Tool -->
                                    <div class="field" style="margin-top: 1rem;">
                                        <label class="label">Ajuste de Precios de Mercado</label>
                                        <div class="notification is-info is-light">
                                            <p style="font-size: 0.875rem; margin-bottom: 0.5rem;">
                                                <i class="fas fa-info-circle"></i> 
                                                Ajusta los precios base para simular cambios de mercado
                                            </p>
                                        </div>
                                        <div class="columns is-multiline">
                                            <div class="column is-half" id="fosfo-price-control">
                                                <label class="label is-small">FOSFO: $<span id="fosfo-price">10.00</span></label>
                                                <input class="input is-small" type="range" min="5" max="50" step="0.5" value="10" onchange="updatePrice('FOSFO', this.value)">
                                            </div>
                                            <div class="column is-half" id="pita-price-control">
                                                <label class="label is-small">PITA: $<span id="pita-price">15.00</span></label>
                                                <input class="input is-small" type="range" min="10" max="75" step="0.5" value="15" onchange="updatePrice('PITA', this.value)">
                                            </div>
                                            <div class="column is-half" id="palta-oil-price-control">
                                                <label class="label is-small">PALTA-OIL: $<span id="palta-oil-price">25.00</span></label>
                                                <input class="input is-small" type="range" min="15" max="100" step="0.5" value="25" onchange="updatePrice('PALTA-OIL', this.value)">
                                            </div>
                                            <div class="column is-half" id="guaca-price-control">
                                                <label class="label is-small">GUACA: $<span id="guaca-price">35.00</span></label>
                                                <input class="input is-small" type="range" min="20" max="150" step="0.5" value="35" onchange="updatePrice('GUACA', this.value)">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                            
                            <div class="order-book-grid">
                                <div class="order-book-side buy">
                                    <h4 class="title is-5 has-text-success">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-arrow-up"></i></span>
                                            <span>rdenes de Compra</span>
                                        </span>
                                    </h4>
                                    <div id="buy-orders">
                                        <div class="notification is-success is-light">Selecciona un producto</div>
                                    </div>
                                </div>
                                <div class="order-book-side sell">
                                    <h4 class="title is-5 has-text-danger">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-arrow-down"></i></span>
                                            <span>rdenes de Venta</span>
                                        </span>
                                    </h4>
                                    <div id="sell-orders">
                                        <div class="notification is-danger is-light">Selecciona un producto</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- All Orders List -->
                            <div class="box" style="margin-top: 1rem;">
                                <h4 class="title is-6">
                                    <span class="icon-text">
                                        <span class="icon"><i class="fas fa-list-alt"></i></span>
                                        <span>Todas las rdenes</span>
                                    </span>
                                </h4>
                                <div id="all-orders-list">
                                    <div class="notification is-info is-light">
                                        <i class="fas fa-info-circle"></i> No hay 贸rdenes disponibles
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Transactions Content -->
                    <div id="transactions-content" class="content-tab" style="display: none;">
                        <div class="box">
                            <div class="level">
                                <div class="level-left">
                                    <div class="level-item">
                                        <h3 class="title is-4">
                                            <span class="icon-text">
                                                <span class="icon"><i class="fas fa-history"></i></span>
                                                <span>Registro de Transacciones</span>
                                            </span>
                                        </h3>
                                    </div>
                                </div>
                                <div class="level-right">
                                    <div class="level-item">
                                        <div class="buttons">
                                            <button class="button is-info is-small" onclick="filterTransactions('all')">Todas</button>
                                            <button class="button is-success is-small" onclick="filterTransactions('fills')">Ejecuciones</button>
                                            <button class="button is-danger is-small" onclick="clearTransactionLog()">Limpiar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="transaction-log" class="box is-family-monospace" style="height: 400px; overflow-y: auto; background: #f8f9fa;">
                                <div class="notification is-info is-light">
                                    <i class="fas fa-info-circle"></i> No hay transacciones registradas
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Sidebar -->
                <div class="column is-3">
                    <div class="box">
                        <div class="tabs is-boxed">
                            <ul>
                                <li class="is-active">
                                    <a onclick="switchRightTab('trading')">
                                        <span class="icon is-small"><i class="fas fa-exchange-alt"></i></span>
                                        <span>Trading</span>
                                    </a>
                                </li>
                                <li>
                                    <a onclick="switchRightTab('orders')">
                                        <span class="icon is-small"><i class="fas fa-list"></i></span>
                                        <span>rdenes</span>
                                    </a>
                                </li>
                                <li>
                                    <a onclick="switchRightTab('messages')">
                                        <span class="icon is-small"><i class="fas fa-comments"></i></span>
                                        <span>Mensajes</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Trading Tab -->
                        <div id="trading-content" class="tab-content">
                            <div class="card">
                                <div class="card-content">
                                    <h3 class="title is-5">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-plus-circle"></i></span>
                                            <span>Nueva Orden</span>
                                        </span>
                                    </h3>
                                    
                                    <div class="columns">
                                        <div class="column">
                                            <div class="field">
                                                <label class="label">Tipo</label>
                                                <div class="control has-icons-left">
                                                    <div class="select is-fullwidth">
                                                        <select id="side">
                                                            <option value="BUY"> Comprar</option>
                                                            <option value="SELL"> Vender</option>
                                                        </select>
                                                    </div>
                                                    <span class="icon is-small is-left">
                                                        <i class="fas fa-exchange-alt"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="column">
                                            <div class="field">
                                                <label class="label">Modo</label>
                                                <div class="control has-icons-left">
                                                    <div class="select is-fullwidth">
                                                        <select id="mode">
                                                            <option value="MARKET"> Mercado</option>
                                                            <option value="LIMIT"> L铆mite</option>
                                                        </select>
                                                    </div>
                                                    <span class="icon is-small is-left">
                                                        <i class="fas fa-cog"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <label class="label">Producto</label>
                                        <div class="control has-icons-left">
                                            <div class="select is-fullwidth">
                                                <select id="product">
                                                    <option value="FOSFO">FOSFO</option>
                                                    <option value="PITA">PITA</option>
                                                    <option value="PALTA-OIL">PALTA-OIL</option>
                                                    <option value="GUACA">GUACA</option>
                                                    <option value="SEBO">SEBO</option>
                                                    <option value="H-GUACA">H-GUACA</option>
                                                </select>
                                            </div>
                                            <span class="icon is-small is-left">
                                                <i class="fas fa-leaf"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="columns">
                                        <div class="column">
                                            <div class="field">
                                                <label class="label">Cantidad</label>
                                                <div class="control has-icons-left">
                                                    <input class="input" type="number" id="qty" placeholder="10" min="1">
                                                    <span class="icon is-small is-left">
                                                        <i class="fas fa-hashtag"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="column">
                                            <div class="field">
                                                <label class="label">Precio</label>
                                                <div class="control has-icons-left">
                                                    <input class="input" type="number" id="price" placeholder="15.50" step="0.01">
                                                    <span class="icon is-small is-left">
                                                        <i class="fas fa-dollar-sign"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <label class="label">Modo Debug</label>
                                        <div class="control has-icons-left">
                                            <div class="select is-fullwidth">
                                                <select id="debug-mode">
                                                    <option value="">Orden Normal</option>
                                                    <option value="AUTO_ACCEPT">Auto-Aceptar (Debug)</option>
                                                    <option value="TEAM_ONLY">Solo Equipo (Debug)</option>
                                                </select>
                                            </div>
                                            <span class="icon is-small is-left">
                                                <i class="fas fa-cog"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <label class="label">Mensaje (opcional)</label>
                                        <div class="control">
                                            <textarea class="textarea" id="message" placeholder="Mensaje opcional" rows="2"></textarea>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <div class="control">
                                            <button class="button is-primary is-fullwidth" id="place-order-btn" onclick="placeOrder()" disabled>
                                                <span class="icon">
                                                    <i class="fas fa-paper-plane"></i>
                                                </span>
                                                <span>Realizar Orden</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Quick Trade Buttons -->
                                    <div class="field">
                                        <label class="label">Trading R谩pido</label>
                                        <div class="columns">
                                            <div class="column">
                                                <button class="button is-success is-small is-fullwidth" onclick="quickTrade('BUY', 'FOSFO', 5)" disabled id="quick-buy-fosfo">
                                                    <span>Comprar 5 FOSFO</span>
                                                </button>
                                            </div>
                                            <div class="column">
                                                <button class="button is-danger is-small is-fullwidth" onclick="quickTrade('SELL', 'FOSFO', 5)" disabled id="quick-sell-fosfo">
                                                    <span>Vender 5 FOSFO</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="columns">
                                            <div class="column">
                                                <button class="button is-success is-small is-fullwidth" onclick="quickTrade('BUY', 'PITA', 3)" disabled id="quick-buy-pita">
                                                    <span>Comprar 3 PITA</span>
                                                </button>
                                            </div>
                                            <div class="column">
                                                <button class="button is-danger is-small is-fullwidth" onclick="quickTrade('SELL', 'PITA', 3)" disabled id="quick-sell-pita">
                                                    <span>Vender 3 PITA</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Orders Tab -->
                        <div id="orders-content" class="tab-content" style="display: none;">
                            <div class="card">
                                <div class="card-content">
                                    <h3 class="title is-5">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-list"></i></span>
                                            <span>Mis rdenes</span>
                                        </span>
                                    </h3>
                                    
                                    <div class="buttons">
                                        <button class="button is-info is-small" onclick="refreshMyOrders()" disabled id="refresh-orders-btn">
                                            <span class="icon">
                                                <i class="fas fa-sync"></i>
                                            </span>
                                            <span>Actualizar</span>
                                        </button>
                                        <button class="button is-danger is-small" onclick="cancelAllOrders()" disabled id="cancel-all-btn">
                                            <span class="icon">
                                                <i class="fas fa-times"></i>
                                            </span>
                                            <span>Cancelar Todas</span>
                                        </button>
                                    </div>
                                    
                                    <div id="my-orders-list">
                                        <div class="notification is-warning is-light">
                                            <i class="fas fa-info-circle"></i> No hay 贸rdenes activas
                                        </div>
                                    </div>
                                    
                                    <!-- Order Statistics -->
                                    <div class="box" style="margin-top: 1rem;">
                                        <h4 class="title is-6">
                                            <span class="icon-text">
                                                <span class="icon"><i class="fas fa-chart-bar"></i></span>
                                                <span>Estad铆sticas</span>
                                            </span>
                                        </h4>
                                        <div class="content">
                                            <p><strong>rdenes Hoy:</strong> <span id="orders-today">--</span></p>
                                            <p><strong>Ejecuciones Hoy:</strong> <span id="fills-today">--</span></p>
                                            <p><strong>Tasa de xito:</strong> <span id="success-rate">--%</span></p>
                                            <p><strong>Tiempo Promedio:</strong> <span id="avg-fill-time">--ms</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Messages Tab -->
                        <div id="messages-content" class="tab-content" style="display: none;">
                            <div class="card">
                                <div class="card-content">
                                    <div class="level">
                                        <div class="level-left">
                                            <div class="level-item">
                                                <h3 class="title is-5">
                                                    <span class="icon-text">
                                                        <span class="icon"><i class="fas fa-comments"></i></span>
                                                        <span>Mensajes del Sistema</span>
                                                    </span>
                                                </h3>
                                            </div>
                                        </div>
                                        <div class="level-right">
                                            <div class="level-item">
                                                <button class="button is-small" onclick="clearMessages()">
                                                    <span class="icon">
                                                        <i class="fas fa-trash"></i>
                                                    </span>
                                                    <span>Limpiar</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div id="message-list" class="box is-family-monospace" style="height: 400px; overflow-y: auto; background: #f8f9fa;">
                                        <div class="notification is-info is-light">
                                            <i class="fas fa-info-circle"></i> No hay mensajes del sistema
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Keyboard Shortcuts Modal -->
    <div class="modal" id="shortcuts-modal">
        <div class="modal-background" onclick="closeShortcutsModal()"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">
                    <i class="fas fa-keyboard"></i> Atajos de Teclado
                </p>
                <button class="delete" onclick="closeShortcutsModal()"></button>
            </header>
            <section class="modal-card-body">
                <div class="content">
                    <h4>Navegaci贸n General</h4>
                    <ul>
                        <li><kbd>Enter</kbd> en el campo Token: Conectar/Login autom谩tico</li>
                        <li><kbd>Enter</kbd> en campos de Trading: Realizar orden</li>
                        <li><kbd>Enter</kbd> en cantidad de producci贸n: Simular producci贸n</li>
                    </ul>
                    
                    <h4>Trading R谩pido</h4>
                    <ul>
                        <li><kbd>Ctrl</kbd> + <kbd>B</kbd>: Compra r谩pida FOSFO</li>
                        <li><kbd>Ctrl</kbd> + <kbd>S</kbd>: Venta r谩pida FOSFO</li>
                        <li><kbd>Ctrl</kbd> + <kbd>P</kbd>: Ping al servidor</li>
                        <li><kbd>Ctrl</kbd> + <kbd>R</kbd>: Actualizar 贸rdenes</li>
                    </ul>
                    
                    <h4>Funciones de Debug</h4>
                    <ul>
                        <li><kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>D</kbd>: Cambiar a pesta帽a Debug</li>
                        <li><kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>S</kbd>: Cambiar a pesta帽a Simulador</li>
                        <li><kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>T</kbd>: Cambiar a pesta帽a Trading</li>
                    </ul>
                </div>
            </section>
            <footer class="modal-card-foot">
                <button class="button" onclick="closeShortcutsModal()">Cerrar</button>
            </footer>
        </div>
    </div>

    <script>
        let ws = null;
        let connected = false;
        let authenticated = false;
        let teamInfo = null;
        let reconnectAttempts = 0;
        let maxReconnectAttempts = 5;
        let reconnectDelay = 1000;
        let pingInterval = null;
        let myOrders = new Map();
        let allOrders = [];
        let orderBook = { buy: [], sell: [] };
        let currentProduct = '';
        let connectedSessions = [];
        let serverStats = {};
        let autoMarketMaker = false;
        let transactionLog = [];
        let currentFilter = 'all';
        let orderStats = {
            ordersToday: 0,
            fillsToday: 0,
            totalOrders: 0,
            totalFills: 0,
            avgFillTime: 0
        };
        let productPrices = {
            'FOSFO': 10.00,
            'PITA': 15.00,
            'PALTA-OIL': 25.00,
            'GUACA': 35.00,
            'SEBO': 20.00,
            'H-GUACA': 50.00
        };
        
        // UI Elements
        const statusIndicator = document.getElementById('status-indicator');
        const connectBtn = document.getElementById('connect-btn');
        const loginBtn = document.getElementById('login-btn');
        const placeOrderBtn = document.getElementById('place-order-btn');
        const messageList = document.getElementById('message-list');
        const tickerList = document.getElementById('ticker-list');
        const connectionTime = document.getElementById('connection-time');
        const serverTime = document.getElementById('server-time');
        
        // Tab Management for new Bulma layout
        function switchSidebarTab(tabName) {
            // Remove active class from all sidebar tabs
            document.querySelectorAll('.column.is-3 .tabs li').forEach(tab => tab.classList.remove('is-active'));
            document.querySelectorAll('.column.is-3 .tab-content').forEach(content => content.style.display = 'none');
            
            // Activate clicked tab and corresponding content
            event.target.closest('li').classList.add('is-active');
            document.getElementById(`${tabName}-content`).style.display = 'block';
        }
        
        function switchMainTab(tabName) {
            // Remove active class from all main tabs
            document.querySelectorAll('.column.is-6 .tabs li').forEach(tab => tab.classList.remove('is-active'));
            document.querySelectorAll('.column.is-6 .content-tab').forEach(content => content.style.display = 'none');
            
            // Activate clicked tab and corresponding content
            event.target.closest('li').classList.add('is-active');
            document.getElementById(`${tabName}-content`).style.display = 'block';
        }
        
        function switchRightTab(tabName) {
            // Remove active class from all right panel tabs
            document.querySelectorAll('.column.is-3:last-child .tabs li').forEach(tab => tab.classList.remove('is-active'));
            document.querySelectorAll('.column.is-3:last-child .tab-content').forEach(content => content.style.display = 'none');
            
            // Activate clicked tab and corresponding content
            event.target.closest('li').classList.add('is-active');
            document.getElementById(`${tabName}-content`).style.display = 'block';
        }
        
        // Mobile menu toggle
        function toggleMobileMenu() {
            const navbarMenu = document.getElementById('navbarMenu');
            navbarMenu.classList.toggle('is-active');
        }
        
        // Panel Toggle Functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const backdrop = document.getElementById('backdrop');
            
            if (window.innerWidth <= 1200) {
                sidebar.classList.toggle('open');
                backdrop.classList.toggle('active');
            }
        }
        
        function toggleRightPanel() {
            const rightPanel = document.getElementById('right-panel');
            const backdrop = document.getElementById('backdrop');
            
            if (window.innerWidth <= 1200) {
                rightPanel.classList.toggle('open');
                backdrop.classList.toggle('active');
            }
        }
        
        function closeAllPanels() {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('right-panel').classList.remove('open');
            document.getElementById('backdrop').classList.remove('active');
        }
        

        
        // Connection Management
        function toggleConnection() {
            if (connected) {
                disconnect();
            } else {
                connect();
            }
        }
        
        function connect() {
            if (ws) {
                ws.close();
            }
            
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            
            updateStatus('connecting', 'Connecting...');
            addMessage('info', 'Connecting to WebSocket...');
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                connected = true;
                reconnectAttempts = 0;
                updateStatus('connected', 'Connected');
                addMessage('success', 'WebSocket connected');
                connectBtn.textContent = 'Disconnect';
                loginBtn.disabled = false;
                connectionTime.textContent = `Connected: ${new Date().toLocaleTimeString()}`;
                startPing();
            };
            
            ws.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    handleMessage(data);
                } catch (e) {
                    addMessage('error', `Failed to parse message: ${e.message}`);
                }
            };
            
            ws.onclose = function(event) {
                connected = false;
                authenticated = false;
                stopPing();
                
                if (event.wasClean) {
                    updateStatus('disconnected', 'Disconnected');
                    addMessage('info', 'WebSocket disconnected cleanly');
                } else {
                    updateStatus('disconnected', 'Connection lost');
                    addMessage('error', `WebSocket disconnected unexpectedly: ${event.code}`);
                    
                    if (reconnectAttempts < maxReconnectAttempts) {
                        attemptReconnect();
                    } else {
                        addMessage('error', 'Max reconnection attempts reached');
                    }
                }
                
                connectBtn.textContent = 'Connect';
                loginBtn.disabled = true;
                disableDebugButtons();
                document.getElementById('team-info').style.display = 'none';
            };
            
            ws.onerror = function(error) {
                addMessage('error', `WebSocket error: ${error}`);
            };
        }
        
        function disconnect() {
            if (ws) {
                ws.close();
            }
        }
        
        function attemptReconnect() {
            reconnectAttempts++;
            const delay = reconnectDelay * Math.pow(2, reconnectAttempts - 1);
            
            updateStatus('connecting', `Reconnecting... (${reconnectAttempts}/${maxReconnectAttempts})`);
            addMessage('info', `Attempting reconnection ${reconnectAttempts}/${maxReconnectAttempts} in ${delay}ms`);
            
            setTimeout(() => {
                if (!connected) {
                    connect();
                }
            }, delay);
        }
        
        function startPing() {
            pingInterval = setInterval(() => {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({type: 'PING'}));
                }
            }, 25000);
        }
        
        function stopPing() {
            if (pingInterval) {
                clearInterval(pingInterval);
                pingInterval = null;
            }
        }
        
        // Status Management
        function updateStatus(status, message) {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            const statusTag = document.getElementById('status-tag');
            
            // Remove all status classes
            statusDot.className = 'status-dot';
            statusTag.className = 'tag';
            
            switch(status) {
                case 'connecting':
                    statusDot.classList.add('status-connecting');
                    statusText.textContent = 'Conectando...';
                    statusTag.classList.add('is-warning');
                    break;
                case 'connected':
                    statusDot.classList.add('status-connected');
                    statusText.textContent = 'Conectado';
                    statusTag.classList.add('is-success');
                    break;
                case 'authenticated':
                    statusDot.classList.add('status-authenticated');
                    statusText.textContent = `Autenticado: ${message}`;
                    statusTag.classList.add('is-info');
                    break;
                default:
                    statusDot.classList.add('status-disconnected');
                    statusText.textContent = 'Desconectado';
                    statusTag.classList.add('is-danger');
            }
            
            updateButtonStates();
        }
        
        function addMessage(type, message) {
            const messageContainer = document.getElementById('message-list');
            const msg = document.createElement('div');
            
            let bulmaClass = 'is-info';
            let icon = 'fas fa-info-circle';
            
            switch(type) {
                case 'success':
                case 'fill':
                    bulmaClass = 'is-success';
                    icon = 'fas fa-check-circle';
                    break;
                case 'error':
                    bulmaClass = 'is-danger';
                    icon = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    bulmaClass = 'is-warning';
                    icon = 'fas fa-exclamation-triangle';
                    break;
            }
            
            msg.className = `message-item message-${type}`;
            msg.innerHTML = `
                <span class="icon">
                    <i class="${icon}"></i>
                </span>
                <span>[${new Date().toLocaleTimeString()}] ${message}</span>
            `;
            
            messageContainer.appendChild(msg);
            messageContainer.scrollTop = messageContainer.scrollHeight;
            
            // Remove old messages if too many
            const messages = messageContainer.children;
            if (messages.length > 100) {
                messageContainer.removeChild(messages[0]);
            }
        }
        
        // Authentication
        function login() {
            if (!handleUserAction('login', 'connected')) return;
            
            if (!validateForm('login')) return;
            
            const token = document.getElementById('token').value.trim();
            
            const loginMsg = {
                type: 'LOGIN',
                token: token
            };
            
            addMessage('info', `Intentando autenticaci贸n con token: ${token}`);
            showAlert('Enviando credenciales de autenticaci贸n...', 'info');
            ws.send(JSON.stringify(loginMsg));
        }
        
        // Message Handling
        function handleMessage(data) {
            switch (data.type) {
                case 'LOGIN_OK':
                    authenticated = true;
                    teamInfo = data;
                    updateStatus('authenticated', `Autenticado como ${data.team}`);
                    addMessage('success', `Conectado como ${data.team} (${data.species})`);
                    enableDebugButtons();
                    displayTeamInfo(data);
                    updateInventoryVisualizer(data.inventory);
                    updateDashboard();
                    requestAllOrders();
                    requestConnectedSessions();
                    addToTransactionLog('LOGIN', `Conectado como ${data.team}`, 'success');
                    break;
                    
                case 'ERROR':
                    addMessage('error', `${data.code}: ${data.reason}`);
                    if (data.clOrdID) {
                        updateMyOrderStatus(data.clOrdID, 'error', data.reason);
                    }
                    break;
                    
                case 'ORDER_ACK':
                    addMessage('success', `Order acknowledged: ${data.clOrdID}`);
                    updateMyOrderStatus(data.clOrdID, 'pending', 'Order acknowledged');
                    break;
                    
                case 'FILL':
                    addMessage('fill', `EJECUCIN: ${data.fillQty} ${data.product} @ $${data.fillPrice} (${data.side}) - Contraparte: ${data.counterparty}`);
                    updateMyOrderStatus(data.clOrdID, 'filled', `Ejecutado ${data.fillQty}/${data.totalQty} @ $${data.fillPrice}`);
                    addToTransactionLog('FILL', `${data.side} ${data.fillQty} ${data.product} @ $${data.fillPrice}`, 'fill');
                    updateOrderStats('fill');
                    updateDashboard();
                    break;
                    
                case 'TICKER':
                    updateTicker(data);
                    if (data.serverTime) {
                        serverTime.textContent = `Server: ${new Date(data.serverTime).toLocaleTimeString()}`;
                    }
                    break;
                    
                case 'OFFER':
                    addMessage('info', `OFERTA: ${data.buyer} quiere ${data.quantityRequested} ${data.product} @ m谩x $${data.maxPrice}`);
                    displayOffer(data);
                    addToTransactionLog('OFFER', `${data.buyer} solicita ${data.quantityRequested} ${data.product} @ m谩x $${data.maxPrice}`, 'offer');
                    break;
                    
                case 'INVENTORY_UPDATE':
                    updateInventoryDisplay(data.inventory);
                    addMessage('success', ` Inventario actualizado: ${Object.entries(data.inventory).map(([p,q]) => `${p}:${q}`).join(', ')}`);
                    showAlert('Inventario actualizado exitosamente', 'success');
                    break;
                    
                case 'ALL_ORDERS':
                    allOrders = data.orders;
                    updateAllOrdersDisplay();
                    addMessage('success', ` ${data.orders.length} 贸rdenes cargadas`);
                    showAlert(`${data.orders.length} 贸rdenes del mercado cargadas`, 'success');
                    break;
                    
                case 'ORDER_BOOK_UPDATE':
                    if (data.product === currentProduct) {
                        updateOrderBookDisplay(data);
                    }
                    break;
                    
                case 'CONNECTED_SESSIONS':
                    connectedSessions = data.sessions;
                    updateSessionsDisplay();
                    addMessage('success', ` ${data.sessions.length} sesiones conectadas`);
                    showAlert(`${data.sessions.length} sesiones activas encontradas`, 'success');
                    break;
                    
                case 'SERVER_STATS':
                    serverStats = data.stats;
                    updateServerStatsDisplay();
                    break;
                    
                case 'PONG':
                    if (window.lastPingTime) {
                        const responseTime = Date.now() - window.lastPingTime;
                        addMessage('success', ` Pong recibido en ${responseTime}ms`);
                        showAlert(`Pong: ${responseTime}ms`, 'success');
                        delete window.lastPingTime;
                    } else {
                        addMessage('success', ' Pong recibido');
                    }
                    break;
                    
                case 'ECHO':
                    addMessage('info', `Echo: ${JSON.stringify(data.original)}`);
                    break;
                    
                default:
                    addMessage('info', `${data.type}: ${JSON.stringify(data)}`);
            }
        }
        
        // Display Functions
        function displayTeamInfo(data) {
            const teamInfoEl = document.getElementById('team-info');
            const teamDetailsEl = document.getElementById('team-details');
            
            const inventoryHtml = data.inventory ? 
                Object.entries(data.inventory)
                    .filter(([product, qty]) => qty > 0)
                    .map(([product, qty]) => `${product}: ${qty}`)
                    .join(', ') || 'Sin inventario' 
                : 'Sin inventario';
            
            teamDetailsEl.innerHTML = `
                <p><strong>Equipo:</strong> ${data.team}</p>
                <p><strong>Especie:</strong> ${data.species}</p>
                <p><strong>Balance:</strong> $${data.currentBalance || data.initialBalance}</p>
                <p><strong>Inventario:</strong> ${inventoryHtml}</p>
                <p><strong>Autorizados:</strong> ${data.authorizedProducts.join(', ')}</p>
            `;
            teamInfoEl.style.display = 'block';
        }
        
        function updateInventoryDisplay(inventory) {
            if (!teamInfo) return;
            teamInfo.inventory = inventory;
            displayTeamInfo(teamInfo);
            updateInventoryVisualizer(inventory);
        }
        
        function updateTicker(ticker) {
            let tickerItem = document.querySelector(`[data-product="${ticker.product}"]`);
            
            if (!tickerItem) {
                tickerItem = document.createElement('div');
                tickerItem.className = 'ticker-item';
                tickerItem.setAttribute('data-product', ticker.product);
                tickerList.appendChild(tickerItem);
            }
            
            tickerItem.innerHTML = `
                <div class="order-header">
                    <span class="product">${ticker.product}</span>
                    <span class="price">
                        <span class="price-bid">$${ticker.bestBid || 'N/A'}</span> | 
                        <span class="price-ask">$${ticker.bestAsk || 'N/A'}</span> | 
                        <span class="price-mid">$${ticker.mid || 'N/A'}</span>
                    </span>
                </div>
                <div class="order-details">Vol: ${ticker.volume24h || 0}</div>
            `;
        }
        
        function updateAllOrdersDisplay() {
            const container = document.getElementById('all-orders-list');
            
            if (allOrders.length === 0) {
                container.innerHTML = '<p>No hay 贸rdenes disponibles</p>';
                return;
            }
            
            container.innerHTML = allOrders.map(order => {
                const priceText = order.mode === 'LIMIT' && order.price ? `@ $${order.price}` : '@ Market';
                const progress = order.filledQty > 0 ? ` (${order.filledQty}/${order.quantity} filled)` : '';
                
                return `
                    <div class="order-item ${order.side.toLowerCase()}">
                        <div class="order-header">
                            <strong>${order.teamName}</strong>
                            <span>${order.side} ${order.quantity} ${order.product}</span>
                        </div>
                        <div class="order-details">
                            ${order.mode} ${priceText}${progress}
                            ${order.message ? `| "${order.message}"` : ''}
                        </div>
                        ${teamInfo && teamInfo.team !== order.teamName ? `
                            <div style="margin-top: 6px;">
                                <button class="btn-small" onclick="respondToOrder('${order.clOrdID}', true)">Aceptar</button>
                                <button class="btn-small" onclick="respondToOrder('${order.clOrdID}', false)">Rechazar</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        function updateOrderBookDisplay(data) {
            const buyContainer = document.getElementById('buy-orders');
            const sellContainer = document.getElementById('sell-orders');
            
            buyContainer.innerHTML = data.buyOrders.map(order => `
                <div class="order-book-entry">
                    <span>${order.quantity}@${order.price || 'MKT'}</span>
                    <span>${order.teamName}</span>
                </div>
            `).join('') || '<p>No buy orders</p>';
            
            sellContainer.innerHTML = data.sellOrders.map(order => `
                <div class="order-book-entry">
                    <span>${order.quantity}@${order.price || 'MKT'}</span>
                    <span>${order.teamName}</span>
                </div>
            `).join('') || '<p>No sell orders</p>';
        }
        
        function displayOffer(offer) {
            const container = document.getElementById('all-orders-list');
            
            const offerElement = document.createElement('div');
            offerElement.className = 'order-item pending';
            offerElement.innerHTML = `
                <div class="order-header">
                    <strong>OFFER: ${offer.buyer}</strong>
                    <span>${offer.quantityRequested} ${offer.product} @ max $${offer.maxPrice}</span>
                </div>
                <div class="order-details">
                    Offer ID: ${offer.offerId} | Expires in: ${offer.expiresIn}ms
                </div>
                <div style="margin-top: 6px;" id="offer-actions-${offer.offerId}">
                    <button class="btn-small" onclick="respondToOffer('${offer.offerId}', true)">Approve</button>
                    <button class="btn-small" onclick="respondToOffer('${offer.offerId}', false)">Deny</button>
                </div>
            `;
            
            container.insertBefore(offerElement, container.firstChild);
            
            if (offer.expiresIn) {
                setTimeout(() => {
                    if (offerElement.parentNode) {
                        offerElement.remove();
                    }
                }, offer.expiresIn);
            }
        }
        
        // Order Management
        function placeOrder() {
            if (!authenticated) {
                addMessage('error', 'Must be authenticated to place orders');
                return;
            }
            
            const side = document.getElementById('side').value;
            const mode = document.getElementById('mode').value;
            const product = document.getElementById('product').value;
            const qty = parseInt(document.getElementById('qty').value);
            const price = parseFloat(document.getElementById('price').value);
            const message = document.getElementById('message').value;
            const debugMode = document.getElementById('debug-mode').value;
            
            if (!qty || qty <= 0) {
                addMessage('error', 'Please enter a valid quantity');
                return;
            }
            
            if (mode === 'LIMIT' && (!price || price <= 0)) {
                addMessage('error', 'Please enter a valid price for limit orders');
                return;
            }
            
            const clOrdID = `ORD-${teamInfo.team}-${Date.now()}-${Math.random().toString(36).substr(2, 8)}`;
            
            const orderMsg = {
                type: 'ORDER',
                clOrdID: clOrdID,
                side: side,
                mode: mode,
                product: product,
                qty: qty,
                message: message || undefined,
                debugMode: debugMode || undefined
            };
            
            if (mode === 'LIMIT') {
                orderMsg.limitPrice = price;
            }
            
            addMessage('info', `Placing ${side} order: ${qty} ${product} @ ${mode}${debugMode ? ` (${debugMode})` : ''}`);
            ws.send(JSON.stringify(orderMsg));
            
            addMyOrder(clOrdID, side, mode, product, qty, price, message, debugMode);
            
            // Clear form
            document.getElementById('qty').value = '';
            document.getElementById('price').value = '';
            document.getElementById('message').value = '';
        }
        
        function addMyOrder(clOrdID, side, mode, product, qty, price, message, debugMode) {
            const order = {
                clOrdID, side, mode, product, qty, price, message, debugMode,
                status: 'submitted',
                timestamp: new Date(),
                statusText: 'Submitted to server'
            };
            
            myOrders.set(clOrdID, order);
            updateMyOrdersDisplay();
        }
        
        function updateMyOrderStatus(clOrdID, status, statusText) {
            const order = myOrders.get(clOrdID);
            if (order) {
                order.status = status;
                order.statusText = statusText;
                order.lastUpdate = new Date();
                updateMyOrdersDisplay();
            }
        }
        
        function updateMyOrdersDisplay() {
            const container = document.getElementById('my-orders-list');
            
            if (myOrders.size === 0) {
                container.innerHTML = '<p>No active orders</p>';
                return;
            }
            
            const orderArray = Array.from(myOrders.values()).sort((a, b) => b.timestamp - a.timestamp);
            
            container.innerHTML = orderArray.map(order => {
                const priceText = order.mode === 'LIMIT' && order.price ? `@ $${order.price}` : '@ Market';
                const timeText = order.timestamp.toLocaleTimeString();
                const debugText = order.debugMode ? ` [${order.debugMode}]` : '';
                
                return `
                    <div class="order-item ${order.side.toLowerCase()} ${order.status}">
                        <div class="order-header">
                            <strong>${order.side} ${order.qty} ${order.product}</strong>
                            <span>${timeText}</span>
                        </div>
                        <div class="order-details">
                            ${order.mode} ${priceText}${debugText} | ${order.statusText}
                            ${order.message ? `| "${order.message}"` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Debug Functions
        function enableDebugButtons() {
            document.getElementById('prod-btn').disabled = false;
            document.getElementById('all-orders-btn').disabled = false;
            document.getElementById('order-book-btn').disabled = false;
            document.getElementById('ping-btn').disabled = false;
            document.getElementById('resync-btn').disabled = false;
            document.getElementById('sessions-btn').disabled = false;
            document.getElementById('place-order-btn').disabled = false;
        }
        
        function disableDebugButtons() {
            document.getElementById('prod-btn').disabled = true;
            document.getElementById('all-orders-btn').disabled = true;
            document.getElementById('order-book-btn').disabled = true;
            document.getElementById('ping-btn').disabled = true;
            document.getElementById('resync-btn').disabled = true;
            document.getElementById('sessions-btn').disabled = true;
            document.getElementById('place-order-btn').disabled = true;
        }
        
        function testProduction() {
            const product = document.getElementById('prod-product').value;
            const qty = parseInt(document.getElementById('prod-qty').value);
            
            if (!qty || qty <= 0) {
                addMessage('error', 'Please enter a valid quantity');
                return;
            }
            
            const prodMsg = {
                type: 'PRODUCTION_UPDATE',
                product: product,
                quantity: qty
            };
            
            addMessage('info', `Testing production: ${qty} ${product}`);
            ws.send(JSON.stringify(prodMsg));
            
            document.getElementById('prod-qty').value = '';
        }
        
        function requestAllOrders() {
            const msg = { type: 'REQUEST_ALL_ORDERS' };
            ws.send(JSON.stringify(msg));
            addMessage('info', ' Solicitando todas las 贸rdenes...');
            showAlert('Cargando 贸rdenes del mercado...', 'info');
        }
        
        function requestOrderBook() {
            const product = document.getElementById('product-selector').value;
            if (!product) {
                addMessage('error', 'Please select a product first');
                return;
            }
            
            const msg = { type: 'REQUEST_ORDER_BOOK', product: product };
            ws.send(JSON.stringify(msg));
        }
        
        function updateOrderBook() {
            const product = document.getElementById('product-selector').value;
            currentProduct = product;
            
            if (product) {
                requestOrderBook();
            } else {
                document.getElementById('buy-orders').innerHTML = '<p>Select a product</p>';
                document.getElementById('sell-orders').innerHTML = '<p>Select a product</p>';
            }
        }
        
        function sendPing() {
            const startTime = Date.now();
            const msg = { type: 'PING' };
            ws.send(JSON.stringify(msg));
            addMessage('info', ' Ping enviado...');
            showAlert('Ping enviado, esperando respuesta...', 'info');
            
            // Store ping time for response calculation
            window.lastPingTime = startTime;
        }
        
        function requestResync() {
            const msg = { type: 'RESYNC', lastSync: '' };
            ws.send(JSON.stringify(msg));
            addMessage('info', ' Solicitando resincronizaci贸n...');
            showAlert('Resincronizaci贸n iniciada...', 'info');
        }
        
        function respondToOffer(offerId, accept) {
            if (!authenticated) {
                addMessage('error', 'Must be authenticated to respond to offers');
                return;
            }
            
            const response = {
                type: 'ACCEPT_OFFER',
                offerId: offerId,
                accept: accept
            };
            
            ws.send(JSON.stringify(response));
            
            const actionsEl = document.getElementById(`offer-actions-${offerId}`);
            if (actionsEl) {
                actionsEl.innerHTML = `<span style="color: ${accept ? '#2ecc71' : '#e74c3c'};">${accept ? 'APPROVED' : 'DENIED'}</span>`;
            }
            
            addMessage('info', `Offer ${offerId} ${accept ? 'approved' : 'denied'}`);
        }
        
        function respondToOrder(clOrdID, accept) {
            addMessage('info', `Order response not implemented yet: ${clOrdID} ${accept ? 'accepted' : 'rejected'}`);
        }
        
        function requestConnectedSessions() {
            const msg = { type: 'REQUEST_CONNECTED_SESSIONS' };
            ws.send(JSON.stringify(msg));
            addMessage('info', ' Solicitando sesiones conectadas...');
            showAlert('Cargando informaci贸n de sesiones...', 'info');
        }
        
        function updateSessionsDisplay() {
            const container = document.getElementById('sessions-list');
            
            if (connectedSessions.length === 0) {
                container.innerHTML = '<div class="notification is-warning is-light"><i class="fas fa-info-circle"></i> No hay sesiones conectadas</div>';
                return;
            }
            
            container.innerHTML = connectedSessions.map(session => {
                const connectionTime = new Date(session.connectedAt).toLocaleTimeString();
                
                // Determine display based on user agent or client type
                let clientIcon = '';
                let clientText = 'Navegador Web';
                let statusClass = session.authenticated ? 'authenticated' : 'connected';
                let clientClass = 'web-client';
                
                // Check if it's actually a Java client based on user agent or other indicators
                if (session.userAgent && session.userAgent.includes('Java')) {
                    clientIcon = '';
                    clientText = 'Java Client';
                    clientClass = 'java-client';
                } else if (session.clientType === 'Multiple Clients') {
                    clientIcon = '';
                    clientText = 'Multiple Clients';
                    statusClass = 'authenticated';
                    clientClass = 'multiple-clients';
                } else if (session.clientType && session.clientType.includes('Java')) {
                    clientIcon = '';
                    clientText = 'Java Client';
                    clientClass = 'java-client';
                }
                
                return `
                    <div class="order-item ${statusClass}">
                        <div class="order-header">
                            <strong>${session.teamName || 'An贸nimo'}</strong>
                            <span>${clientIcon} ${clientText}</span>
                        </div>
                        <div class="order-details">
                            Conectado: ${connectionTime} | 
                            Estado: ${session.authenticated ? 'Autenticado' : 'Conectado'} | 
                            IP: ${session.remoteAddr || 'N/A'}
                            ${session.lastActivity ? `<br>ltima actividad: ${new Date(session.lastActivity).toLocaleTimeString()}` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateServerStatsDisplay() {
            if (serverStats.totalConnections !== undefined) {
                document.getElementById('total-connections').textContent = `Total Connections: ${serverStats.totalConnections}`;
            }
            if (serverStats.totalOrders !== undefined) {
                document.getElementById('total-orders').textContent = `Total Orders: ${serverStats.totalOrders}`;
            }
            if (serverStats.totalFills !== undefined) {
                document.getElementById('total-fills').textContent = `Total Fills: ${serverStats.totalFills}`;
            }
            if (serverStats.uptime !== undefined) {
                document.getElementById('server-uptime').textContent = `Server Uptime: ${serverStats.uptime}`;
            }
        }
        
        // Initialize tooltips and enhanced features
        function initializeEnhancements() {
            addFormTooltips();
            updateButtonStates();
            
            // Test docs tab visibility
            const docsTab = document.getElementById('docs-tab');
            if (docsTab) {
                console.log('Docs tab found, content length:', docsTab.innerHTML.length);
            } else {
                console.error('Docs tab not found!');
            }
            
            // Add helpful hints to the interface
            setTimeout(() => {
                if (!connected) {
                    showAlert('隆Bienvenido! Comience haciendo clic en "Conectar" para establecer conexi贸n con el servidor.', 'info', 5000);
                }
            }, 1000);
        }
        
        // Auto-connect on page load
        window.onload = function() {
            initializeEnhancements();
            // Clean up old orders periodically
            setInterval(() => {
                const cutoff = new Date(Date.now() - 300000); // 5 minutes ago
                for (const [clOrdID, order] of myOrders.entries()) {
                    if (order.status === 'filled' || order.status === 'error') {
                        if (order.timestamp < cutoff) {
                            myOrders.delete(clOrdID);
                        }
                    }
                }
                updateMyOrdersDisplay();
            }, 60000);
            
            // Auto-refresh sessions every 10 seconds if authenticated
            setInterval(() => {
                if (authenticated && ws && ws.readyState === WebSocket.OPEN) {
                    requestConnectedSessions();
                }
            }, 10000);
        };
        
        // Handle Enter key in forms
        document.getElementById('token').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (!connected) {
                    connect();
                } else {
                    login();
                }
            }
        });
        
        ['qty', 'price'].forEach(id => {
            document.getElementById(id).addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    placeOrder();
                }
            });
        });
        
        document.getElementById('prod-qty').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testProduction();
            }
        });

        // New Features Implementation
        
        // Market Simulator Functions
        function createMarketOrder() {
            if (!handleUserAction('createMarketOrder', 'authenticated')) return;
            
            if (!validateForm('market-order')) return;
            
            const side = document.getElementById('sim-side').value;
            const product = document.getElementById('sim-product').value;
            const qty = parseInt(document.getElementById('sim-qty').value);
            const price = parseFloat(document.getElementById('sim-price').value);
            
            const clOrdID = `SIM-${teamInfo.team}-${Date.now()}-${Math.random().toString(36).substr(2, 8)}`;
            
            const orderMsg = {
                type: 'ORDER',
                clOrdID: clOrdID,
                side: side,
                mode: 'LIMIT',
                product: product,
                qty: qty,
                limitPrice: price,
                message: ' Orden del Simulador de Mercado',
                debugMode: 'MARKET_SIMULATOR'
            };
            
            addMessage('info', `Creando orden de mercado: ${side} ${qty} ${product} @ $${price}`);
            showAlert(`Orden creada: ${side} ${qty} ${product} @ $${price}`, 'success');
            ws.send(JSON.stringify(orderMsg));
            addToTransactionLog('MARKET_ORDER', `${side} ${qty} ${product} @ $${price}`, 'order');
            
            // Clear form
            document.getElementById('sim-qty').value = '';
            document.getElementById('sim-price').value = '';
        }
        
        function updatePrice(product, value) {
            productPrices[product] = parseFloat(value);
            document.getElementById(`${product.toLowerCase().replace('-', '-')}-price`).textContent = parseFloat(value).toFixed(2);
            
            // Auto-create counter orders if auto market maker is enabled
            if (autoMarketMaker && authenticated) {
                createCounterOrders(product, parseFloat(value));
            }
        }
        
        function toggleAutoMarketMaker() {
            autoMarketMaker = !autoMarketMaker;
            const btn = document.getElementById('auto-mm-btn');
            
            if (autoMarketMaker) {
                btn.textContent = ' Desactivar Auto-MM';
                btn.style.background = 'rgba(231, 76, 60, 0.3)';
                addMessage('success', 'Auto Market Maker activado');
            } else {
                btn.textContent = ' Activar Auto-MM';
                btn.style.background = 'rgba(46, 204, 113, 0.3)';
                addMessage('info', 'Auto Market Maker desactivado');
            }
        }
        
        function createCounterOrders(product, basePrice) {
            if (!authenticated) return;
            
            // Create buy order 5% below
            const buyPrice = (basePrice * 0.95).toFixed(2);
            const buyOrderMsg = {
                type: 'ORDER',
                clOrdID: `AMM-BUY-${Date.now()}`,
                side: 'BUY',
                mode: 'LIMIT',
                product: product,
                qty: 5,
                limitPrice: parseFloat(buyPrice),
                message: ' Auto Market Maker - Compra',
                debugMode: 'AUTO_MARKET_MAKER'
            };
            
            // Create sell order 5% above
            const sellPrice = (basePrice * 1.05).toFixed(2);
            const sellOrderMsg = {
                type: 'ORDER',
                clOrdID: `AMM-SELL-${Date.now()}`,
                side: 'SELL',
                mode: 'LIMIT',
                product: product,
                qty: 5,
                limitPrice: parseFloat(sellPrice),
                message: ' Auto Market Maker - Venta',
                debugMode: 'AUTO_MARKET_MAKER'
            };
            
            setTimeout(() => ws.send(JSON.stringify(buyOrderMsg)), 100);
            setTimeout(() => ws.send(JSON.stringify(sellOrderMsg)), 200);
        }
        
        function clearAllOrders() {
            if (!authenticated) {
                addMessage('error', 'Debe estar autenticado para limpiar 贸rdenes');
                return;
            }
            
            const clearMsg = { type: 'CLEAR_ALL_ORDERS' };
            ws.send(JSON.stringify(clearMsg));
            addMessage('info', 'Solicitando limpieza de todas las 贸rdenes');
        }
        
        // Error Injection Functions
        function injectError(errorType) {
            if (!authenticated) {
                addMessage('error', 'Debe estar autenticado para inyectar errores');
                return;
            }
            
            const errorMsg = {
                type: 'INJECT_ERROR',
                errorType: errorType
            };
            
            ws.send(JSON.stringify(errorMsg));
            
            const errorNames = {
                'INSUFFICIENT_BALANCE': 'Saldo Insuficiente',
                'UNAUTHORIZED_PRODUCT': 'Producto No Autorizado',
                'DISCONNECT_CLIENT': 'Desconectar Cliente',
                'OFFER_EXPIRED': 'Expirar Oferta'
            };
            
            addMessage('error', `Inyectando error: ${errorNames[errorType]}`);
            addToTransactionLog('ERROR_INJECTION', errorNames[errorType], 'error');
        }
        
        // Production Validator Functions
        function testProduction() {
            const product = document.getElementById('prod-product').value;
            const qty = parseInt(document.getElementById('prod-qty').value);
            
            if (!qty || qty <= 0) {
                addMessage('error', 'Por favor ingrese una cantidad v谩lida');
                showAlert('Cantidad inv谩lida', 'error');
                return;
            }
            
            // Simulate algorithm calculation
            const algorithmResult = calculateProductionAlgorithm(product, qty);
            
            const prodMsg = {
                type: 'PRODUCTION_UPDATE',
                product: product,
                quantity: qty
            };
            
            addMessage('info', ` Simulando producci贸n: ${qty} ${product}`);
            showAlert(`Simulando producci贸n de ${qty} ${product}...`, 'info');
            ws.send(JSON.stringify(prodMsg));
            
            // Simulate inventory update for testing (since server might not respond)
            if (teamInfo && teamInfo.inventory) {
                teamInfo.inventory[product] = (teamInfo.inventory[product] || 0) + qty;
                updateInventoryDisplay(teamInfo.inventory);
            }
            
            // Display production validation
            displayProductionValidation(product, qty, algorithmResult);
            addToTransactionLog('PRODUCTION', `${qty} ${product}`, 'production');
            
            document.getElementById('prod-qty').value = '';
        }
        
        function calculateProductionAlgorithm(product, quantity) {
            // Simulate production algorithm
            const branches = 2;
            const maxDepth = 4;
            const decay = 0.7651;
            const baseEnergy = 3.0;
            const levelEnergy = 2.0;
            
            // Simple calculation (this would be more complex in real implementation)
            const expectedQty = Math.floor(baseEnergy * levelEnergy * decay * branches);
            
            return {
                branches,
                maxDepth,
                decay,
                baseEnergy,
                levelEnergy,
                expectedQty,
                actualQty: quantity,
                isCorrect: Math.abs(expectedQty - quantity) <= 2,
                premiumBonus: quantity > expectedQty
            };
        }
        
        function displayProductionValidation(product, quantity, algorithm) {
            const resultEl = document.getElementById('production-result');
            const receivedEl = document.getElementById('prod-received');
            const algorithmEl = document.getElementById('prod-algorithm');
            const validationEl = document.getElementById('prod-validation');
            const premiumEl = document.getElementById('prod-premium');
            
            receivedEl.textContent = `${quantity} ${product} (b谩sico)`;
            algorithmEl.innerHTML = `
                branches=${algorithm.branches}, maxDepth=${algorithm.maxDepth}, decay=${algorithm.decay}<br>
                baseEnergy=${algorithm.baseEnergy}, levelEnergy=${algorithm.levelEnergy}<br>
                 Resultado: ${algorithm.expectedQty} unidades
            `;
            validationEl.innerHTML = algorithm.isCorrect ? 
                ' CORRECTO' : 
                ` INCORRECTO (esperado: ${algorithm.expectedQty})`;
            validationEl.style.color = algorithm.isCorrect ? '#2ecc71' : '#e74c3c';
            premiumEl.textContent = algorithm.premiumBonus ? 'S' : 'NO';
            premiumEl.style.color = algorithm.premiumBonus ? '#f39c12' : '#95a5a6';
            
            resultEl.style.display = 'block';
        }
        
        // Offer Tester Functions
        function sendTestOffer() {
            if (!authenticated) {
                addMessage('error', 'Debe estar autenticado para enviar ofertas');
                return;
            }
            
            const product = document.getElementById('offer-product').value;
            const qty = parseInt(document.getElementById('offer-qty').value);
            const maxPrice = parseFloat(document.getElementById('offer-max-price').value);
            const message = document.getElementById('offer-message').value;
            
            if (!qty || qty <= 0) {
                addMessage('error', 'Por favor ingrese una cantidad v谩lida');
                return;
            }
            
            if (!maxPrice || maxPrice <= 0) {
                addMessage('error', 'Por favor ingrese un precio m谩ximo v谩lido');
                return;
            }
            
            const offerId = `OFFER-${Date.now()}`;
            const offerMsg = {
                type: 'SEND_OFFER',
                offerId: offerId,
                product: product,
                quantityRequested: qty,
                maxPrice: maxPrice,
                message: message || '隆Urgente! Necesario para producci贸n premium'
            };
            
            ws.send(JSON.stringify(offerMsg));
            addMessage('info', `Enviando oferta: ${qty} ${product} @ m谩x $${maxPrice}`);
            
            // Start response timer
            startOfferTimer(offerId);
            addToTransactionLog('OFFER_SENT', `${qty} ${product} @ m谩x $${maxPrice}`, 'offer');
        }
        
        function startOfferTimer(offerId) {
            const responseEl = document.getElementById('offer-response');
            const timerEl = document.getElementById('response-timer');
            const statusEl = document.getElementById('offer-status');
            
            responseEl.style.display = 'block';
            statusEl.textContent = 'Pendiente...';
            
            let startTime = Date.now();
            const timer = setInterval(() => {
                const elapsed = Date.now() - startTime;
                timerEl.textContent = `${elapsed}ms`;
                
                if (elapsed > 30000) { // 30 second timeout
                    clearInterval(timer);
                    statusEl.textContent = 'Tiempo agotado';
                    statusEl.style.color = '#e74c3c';
                }
            }, 100);
            
            // Store timer to clear it if response comes
            window.currentOfferTimer = timer;
        }
        
        // Transaction Log Functions
        function addToTransactionLog(type, description, category) {
            const transaction = {
                id: Date.now(),
                timestamp: new Date(),
                type: type,
                description: description,
                category: category
            };
            
            transactionLog.unshift(transaction);
            
            // Keep only last 1000 transactions
            if (transactionLog.length > 1000) {
                transactionLog = transactionLog.slice(0, 1000);
            }
            
            updateTransactionLogDisplay();
        }
        
        function updateTransactionLogDisplay() {
            const container = document.getElementById('transaction-log');
            
            const filteredLog = transactionLog.filter(tx => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'fills') return tx.category === 'fill';
                if (currentFilter === 'orders') return tx.category === 'order';
                if (currentFilter === 'offers') return tx.category === 'offer';
                return true;
            });
            
            if (filteredLog.length === 0) {
                container.innerHTML = '<p>No hay transacciones registradas</p>';
                return;
            }
            
            container.innerHTML = filteredLog.slice(0, 50).map(tx => {
                const timeStr = tx.timestamp.toLocaleTimeString();
                const categoryIcon = {
                    'fill': '',
                    'order': '',
                    'offer': '',
                    'error': '',
                    'success': '',
                    'production': ''
                }[tx.category] || '';
                
                return `
                    <div class="message ${tx.category}" style="margin-bottom: 4px;">
                        <strong>[${timeStr}] ${categoryIcon} ${tx.type}:</strong> ${tx.description}
                    </div>
                `;
            }).join('');
        }
        
        function filterTransactions(filter) {
            currentFilter = filter;
            
            // Update button states
            document.querySelectorAll('#transactions-tab .btn-group button').forEach(btn => {
                btn.style.background = 'rgba(52, 152, 219, 0.3)';
            });
            document.getElementById(`filter-${filter}`).style.background = 'rgba(52, 152, 219, 0.5)';
            
            updateTransactionLogDisplay();
        }
        
        function clearTransactionLog() {
            transactionLog = [];
            updateTransactionLogDisplay();
            addMessage('info', 'Registro de transacciones limpiado');
        }
        
        // Dashboard Functions
        function updateDashboard() {
            if (!teamInfo) return;
            
            document.getElementById('dashboard-balance').textContent = 
                `Balance: $${teamInfo.currentBalance || teamInfo.initialBalance || '--'}`;
            
            const profit = teamInfo.currentBalance ? 
                (teamInfo.currentBalance - teamInfo.initialBalance).toFixed(2) : '--';
            document.getElementById('dashboard-profit').textContent = `P&L: $${profit}`;
            
            document.getElementById('dashboard-volume').textContent = 
                `Volumen 24h: ${calculateVolume24h()}`;
            
            document.getElementById('dashboard-orders').textContent = 
                `rdenes Activas: ${myOrders.size}`;
            
            document.getElementById('dashboard-fills').textContent = 
                `Ejecuciones Hoy: ${orderStats.fillsToday}`;
            
            document.getElementById('dashboard-connections').textContent = 
                `Conexiones: ${connectedSessions.length}`;
            
            // Update server status indicators
            const serverStatusEl = document.getElementById('server-status');
            const lastUpdateEl = document.getElementById('last-update');
            
            if (serverStatusEl) {
                if (authenticated) {
                    serverStatusEl.textContent = '';
                    serverStatusEl.style.color = '#2ecc71';
                } else if (connected) {
                    serverStatusEl.textContent = '';
                    serverStatusEl.style.color = '#f39c12';
                } else {
                    serverStatusEl.textContent = '';
                    serverStatusEl.style.color = '#e74c3c';
                }
            }
            
            if (lastUpdateEl) {
                lastUpdateEl.textContent = new Date().toLocaleTimeString();
            }
            
            updateTopProducts();
        }
        
        function calculateVolume24h() {
            // Calculate from transaction log
            const now = new Date();
            const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
            
            return transactionLog
                .filter(tx => tx.timestamp > yesterday && tx.category === 'fill')
                .length;
        }
        
        function updateTopProducts() {
            const productVolumes = {};
            
            transactionLog
                .filter(tx => tx.category === 'fill')
                .forEach(tx => {
                    const match = tx.description.match(/(\w+)/);
                    if (match) {
                        const product = match[1];
                        productVolumes[product] = (productVolumes[product] || 0) + 1;
                    }
                });
            
            const sorted = Object.entries(productVolumes)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3);
            
            const container = document.getElementById('top-products');
            
            if (sorted.length === 0) {
                container.innerHTML = '<p>No hay datos de volumen</p>';
                return;
            }
            
            container.innerHTML = sorted.map(([product, volume], index) => {
                const medal = ['', '', ''][index];
                return `<p>${medal} ${product}: ${volume} ejecuciones</p>`;
            }).join('');
        }
        
        // Inventory Visualizer
        function updateInventoryVisualizer(inventory) {
            const container = document.getElementById('inventory-visualizer');
            const gridContainer = document.getElementById('inventory-grid');
            
            if (!inventory || Object.keys(inventory).length === 0) {
                if (container) container.innerHTML = '<div class="inventory-item">Sin inventario</div>';
                if (gridContainer) gridContainer.innerHTML = '<div class="inventory-item"><div class="has-text-grey">Sin datos</div></div>';
                return;
            }
            
            const inventoryHTML = Object.entries(inventory)
                .map(([product, qty]) => `
                    <div class="inventory-item">
                        <strong>${product}</strong><br>
                        <span style="font-size: 16px; color: var(--success-color); font-weight: 600;">${qty}</span>
                    </div>
                `).join('');
            
            if (container) {
                container.innerHTML = inventoryHTML;
                container.style.display = 'grid';
            }
            if (gridContainer) {
                gridContainer.innerHTML = inventoryHTML;
            }
        }
        
        // Quick Trade Functions
        function quickTrade(side, product, qty) {
            if (!authenticated) {
                addMessage('error', 'Debe estar autenticado para realizar trading r谩pido');
                return;
            }
            
            const clOrdID = `QUICK-${side}-${Date.now()}`;
            const orderMsg = {
                type: 'ORDER',
                clOrdID: clOrdID,
                side: side,
                mode: 'MARKET',
                product: product,
                qty: qty,
                message: ` Trading R谩pido`,
                debugMode: 'QUICK_TRADE'
            };
            
            ws.send(JSON.stringify(orderMsg));
            addMessage('info', `Trading r谩pido: ${side} ${qty} ${product}`);
            addToTransactionLog('QUICK_TRADE', `${side} ${qty} ${product}`, 'order');
        }
        
        // Order Management Functions
        function refreshMyOrders() {
            updateMyOrdersDisplay();
            addMessage('info', 'rdenes actualizadas');
        }
        
        function cancelAllOrders() {
            if (!authenticated) {
                addMessage('error', 'Debe estar autenticado para cancelar 贸rdenes');
                return;
            }
            
            const cancelMsg = { type: 'CANCEL_ALL_ORDERS' };
            ws.send(JSON.stringify(cancelMsg));
            addMessage('info', 'Solicitando cancelaci贸n de todas las 贸rdenes');
        }
        
        function updateOrderStats(action) {
            if (action === 'order') {
                orderStats.ordersToday++;
                orderStats.totalOrders++;
            } else if (action === 'fill') {
                orderStats.fillsToday++;
                orderStats.totalFills++;
            }
            
            // Update display
            document.getElementById('orders-today').textContent = `rdenes Hoy: ${orderStats.ordersToday}`;
            document.getElementById('fills-today').textContent = `Ejecuciones Hoy: ${orderStats.fillsToday}`;
            
            const successRate = orderStats.totalOrders > 0 ? 
                ((orderStats.totalFills / orderStats.totalOrders) * 100).toFixed(1) : 0;
            document.getElementById('success-rate').textContent = `Tasa de xito: ${successRate}%`;
        }
        
        // Message Management
        function clearMessages() {
            messageList.innerHTML = '';
            addMessage('info', 'Mensajes limpiados');
        }
        
        function exportMessages() {
            const messages = Array.from(messageList.children).map(msg => msg.textContent);
            const blob = new Blob([messages.join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `messages-${new Date().toISOString().slice(0, 19)}.txt`;
            a.click();
            
            URL.revokeObjectURL(url);
            addMessage('info', 'Mensajes exportados');
        }
        
        // Alert and notification system
        function showAlert(message, type = 'info', duration = 3000) {
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            
            // Add appropriate icon based on type
            const icons = {
                'success': '',
                'error': '',
                'warning': '锔',
                'info': '癸'
            };
            
            alert.innerHTML = `${icons[type] || ''} ${message}`;
            document.body.appendChild(alert);
            
            // Auto remove after duration
            setTimeout(() => {
                alert.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 300);
            }, duration);
        }
        
        // Enhanced error handling with better user feedback
        function handleUserAction(action, requiredState = 'authenticated') {
            if (requiredState === 'connected' && !connected) {
                showAlert('Debe conectarse al servidor primero. Haga clic en "Conectar".', 'warning');
                return false;
            }
            
            if (requiredState === 'authenticated' && !authenticated) {
                showAlert('Debe autenticarse primero. Ingrese su token y haga clic en "Iniciar Sesi贸n".', 'warning');
                return false;
            }
            
            return true;
        }
        
        // Add helpful tooltips to form elements
        function addFormTooltips() {
            // Add tooltips to input fields
            document.getElementById('token').setAttribute('data-tooltip', 'Ingrese su token de equipo proporcionado por el profesor (formato: TK-XXXX)');
            document.getElementById('sim-qty').setAttribute('data-tooltip', 'Cantidad de unidades para la orden (n煤mero entero positivo)');
            document.getElementById('sim-price').setAttribute('data-tooltip', 'Precio por unidad en d贸lares (ejemplo: 10.50)');
            document.getElementById('prod-qty').setAttribute('data-tooltip', 'Cantidad a producir para simulaci贸n (n煤mero entero positivo)');
            document.getElementById('offer-qty').setAttribute('data-tooltip', 'Cantidad solicitada en la oferta');
            document.getElementById('offer-max-price').setAttribute('data-tooltip', 'Precio m谩ximo que est谩 dispuesto a pagar');
            
            // Make form elements use tooltip class
            ['token', 'sim-qty', 'sim-price', 'prod-qty', 'offer-qty', 'offer-max-price'].forEach(id => {
                document.getElementById(id).className += ' tooltip';
            });
        }
        
        // Enhanced connection status updates
        function updateConnectionStatus(status, details = '') {
            const statusEl = document.getElementById('status-indicator');
            const connectionTimeEl = document.getElementById('connection-time');
            
            switch(status) {
                case 'connecting':
                    statusEl.textContent = 'Conectando...';
                    statusEl.className = 'status-indicator status-connecting';
                    showAlert('Estableciendo conexi贸n con el servidor...', 'info');
                    break;
                case 'connected':
                    statusEl.textContent = 'Conectado';
                    statusEl.className = 'status-indicator status-connected';
                    connectionTimeEl.textContent = `Conectado: ${new Date().toLocaleTimeString()}`;
                    showAlert('Conexi贸n establecida exitosamente. Ahora puede iniciar sesi贸n.', 'success');
                    break;
                case 'authenticated':
                    statusEl.textContent = `Autenticado: ${details}`;
                    statusEl.className = 'status-indicator status-authenticated';
                    showAlert(`Autenticaci贸n exitosa como ${details}. Todas las funciones est谩n disponibles.`, 'success');
                    break;
                case 'disconnected':
                    statusEl.textContent = 'Desconectado';
                    statusEl.className = 'status-indicator status-disconnected';
                    connectionTimeEl.textContent = '';
                    showAlert('Conexi贸n perdida. Intente reconectar.', 'error');
                    break;
            }
        }
        
        // Button state management with better feedback
        function updateButtonStates() {
            const buttons = [
                { id: 'login-btn', requires: 'connected', reason: 'Debe conectarse al servidor primero' },
                { id: 'create-order-btn', requires: 'authenticated', reason: 'Debe autenticarse para crear 贸rdenes' },
                { id: 'prod-btn', requires: 'authenticated', reason: 'Debe autenticarse para simular producci贸n' },
                { id: 'send-offer-btn', requires: 'authenticated', reason: 'Debe autenticarse para enviar ofertas' },
                { id: 'place-order-btn', requires: 'authenticated', reason: 'Debe autenticarse para realizar 贸rdenes' },
                { id: 'ping-btn', requires: 'connected', reason: 'Debe estar conectado para enviar ping' },
                { id: 'resync-btn', requires: 'authenticated', reason: 'Debe autenticarse para solicitar resincronizaci贸n' }
            ];
            
            buttons.forEach(btn => {
                const element = document.getElementById(btn.id);
                if (element) {
                    const shouldEnable = (btn.requires === 'connected' && connected) || 
                                       (btn.requires === 'authenticated' && authenticated);
                    
                    element.disabled = !shouldEnable;
                    element.setAttribute('data-disabled-reason', shouldEnable ? '' : btn.reason);
                }
            });
        }
        
        // Enhanced message display with categories
        function addMessage(type, message, showAlert = false) {
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            messageList.appendChild(msg);
            messageList.scrollTop = messageList.scrollHeight;
            
            // Show alert for important messages
            if (showAlert || type === 'error') {
                showAlert(message, type === 'error' ? 'error' : type === 'success' ? 'success' : 'info');
            }
            
            // Auto-scroll to messages tab for errors
            if (type === 'error') {
                const messagesTab = document.querySelector('[onclick="switchRightTab(\'messages\')"]');
                if (messagesTab && !messagesTab.classList.contains('active')) {
                    messagesTab.style.background = 'rgba(231, 76, 60, 0.5)';
                    setTimeout(() => {
                        messagesTab.style.background = '';
                    }, 2000);
                }
            }
        }
        
        // Enhanced form validation with user feedback
        function validateForm(formType) {
            let isValid = true;
            let errors = [];
            
            switch(formType) {
                case 'login':
                    const token = document.getElementById('token').value.trim();
                    if (!token) {
                        errors.push('El token es requerido');
                        isValid = false;
                    } else if (!token.startsWith('TK-')) {
                        errors.push('El token debe comenzar con "TK-"');
                        isValid = false;
                    }
                    break;
                    
                case 'order':
                    const qty = parseInt(document.getElementById('qty').value);
                    const price = parseFloat(document.getElementById('price').value);
                    const mode = document.getElementById('mode').value;
                    
                    if (!qty || qty <= 0) {
                        errors.push('La cantidad debe ser un n煤mero positivo');
                        isValid = false;
                    }
                    
                    if (mode === 'LIMIT' && (!price || price <= 0)) {
                        errors.push('El precio debe ser un n煤mero positivo para 贸rdenes l铆mite');
                        isValid = false;
                    }
                    break;
                    
                case 'market-order':
                    const simQty = parseInt(document.getElementById('sim-qty').value);
                    const simPrice = parseFloat(document.getElementById('sim-price').value);
                    
                    if (!simQty || simQty <= 0) {
                        errors.push('La cantidad debe ser un n煤mero positivo');
                        isValid = false;
                    }
                    
                    if (!simPrice || simPrice <= 0) {
                        errors.push('El precio debe ser un n煤mero positivo');
                        isValid = false;
                    }
                    break;
            }
            
            if (!isValid) {
                showAlert(`Errores de validaci贸n: ${errors.join(', ')}`, 'error');
            }
            
            return isValid;
        }
        
        // Enhanced button enabling
        function enableDebugButtons() {
            document.getElementById('prod-btn').disabled = false;
            document.getElementById('all-orders-btn').disabled = false;
            document.getElementById('order-book-btn').disabled = false;
            document.getElementById('ping-btn').disabled = false;
            document.getElementById('resync-btn').disabled = false;
            document.getElementById('sessions-btn').disabled = false;
            document.getElementById('place-order-btn').disabled = false;
            document.getElementById('create-order-btn').disabled = false;
            document.getElementById('send-offer-btn').disabled = false;
            document.getElementById('auto-mm-btn').disabled = false;
            document.getElementById('clear-all-btn').disabled = false;
            
            // Quick trade buttons
            const quickBuyFosfo = document.getElementById('quick-buy-fosfo');
            const quickSellFosfo = document.getElementById('quick-sell-fosfo');
            const quickBuyPita = document.getElementById('quick-buy-pita');
            const quickSellPita = document.getElementById('quick-sell-pita');
            if (quickBuyFosfo) quickBuyFosfo.disabled = false;
            if (quickSellFosfo) quickSellFosfo.disabled = false;
            if (quickBuyPita) quickBuyPita.disabled = false;
            if (quickSellPita) quickSellPita.disabled = false;
            
            document.getElementById('refresh-orders-btn').disabled = false;
            document.getElementById('cancel-all-btn').disabled = false;
            
            // Error injection buttons
            document.getElementById('err-balance-btn').disabled = false;
            document.getElementById('err-product-btn').disabled = false;
            document.getElementById('err-disconnect-btn').disabled = false;
            document.getElementById('err-expire-btn').disabled = false;
        }
        
        // Keyboard shortcuts modal
        function showKeyboardShortcuts() {
            document.getElementById('shortcuts-modal').classList.add('is-active');
        }
        
        function closeShortcutsModal() {
            document.getElementById('shortcuts-modal').classList.remove('is-active');
        }
        
        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+B: Quick buy FOSFO
            if (e.ctrlKey && e.key === 'b' && authenticated) {
                e.preventDefault();
                quickTrade('BUY', 'FOSFO', 5);
            }
            // Ctrl+S: Quick sell FOSFO
            if (e.ctrlKey && e.key === 's' && authenticated) {
                e.preventDefault();
                quickTrade('SELL', 'FOSFO', 5);
            }
            // Ctrl+P: Ping
            if (e.ctrlKey && e.key === 'p' && connected) {
                e.preventDefault();
                sendPing();
            }
            // Ctrl+R: Refresh orders
            if (e.ctrlKey && e.key === 'r' && authenticated) {
                e.preventDefault();
                refreshMyOrders();
            }
            // Ctrl+Alt+D: Switch to debug tab
            if (e.ctrlKey && e.altKey && e.key === 'd') {
                e.preventDefault();
                switchSidebarTab('debug');
            }
            // Ctrl+Alt+S: Switch to simulator tab
            if (e.ctrlKey && e.altKey && e.key === 's') {
                e.preventDefault();
                switchSidebarTab('simulator');
            }
            // Ctrl+Alt+T: Switch to trading tab
            if (e.ctrlKey && e.altKey && e.key === 't') {
                e.preventDefault();
                switchRightTab('trading');
            }
            // ESC: Close modal
            if (e.key === 'Escape') {
                closeShortcutsModal();
            }
        });
    </script>
</body>
</html>