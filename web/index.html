<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ¥‘ Intercambio de Aguacates - Consola de Trading</title>
    
    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%);
            --danger-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }
        
        html, body {
            font-family: 'Inter', sans-serif !important;
            background: var(--primary-gradient);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .is-family-monospace {
            font-family: 'JetBrains Mono', monospace !important;
        }
        
        /* Glass Morphism Effects */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 16px 64px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Custom Hero */
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            position: relative;
            overflow: hidden;
        }
        
        .hero-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        /* Animated Gradients */
        .gradient-primary {
            background: var(--primary-gradient);
        }
        
        .gradient-success {
            background: var(--success-gradient);
        }
        
        .gradient-warning {
            background: var(--warning-gradient);
        }
        
        .gradient-danger {
            background: var(--danger-gradient);
        }
        
        /* Status Indicators */
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-connected { background: #00d1b2; }
        .status-connecting { background: #ffdd57; }
        .status-disconnected { background: #ff3860; }
        .status-authenticated { background: #3273dc; }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* Custom Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in-left {
            animation: slideInLeft 0.3s ease-out;
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        .slide-in-right {
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        /* Enhanced Cards */
        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-gradient);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--success-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        /* Trading Cards */
        .trading-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .trading-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        /* Message Styles */
        .message-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            border-left: 4px solid;
            animation: slideIn 0.3s ease;
        }
        
        .message-success {
            background: rgba(72, 187, 120, 0.1);
            border-color: #48bb78;
            color: #68d391;
        }
        
        .message-error {
            background: rgba(245, 101, 101, 0.1);
            border-color: #f56565;
            color: #fc8181;
        }
        
        .message-info {
            background: rgba(66, 153, 225, 0.1);
            border-color: #4299e1;
            color: #63b3ed;
        }
        
        .message-warning {
            background: rgba(237, 137, 54, 0.1);
            border-color: #ed8936;
            color: #f6ad55;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Custom Bulma Overrides */
        .navbar {
            background: var(--glass-bg) !important;
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
        }
        
        .navbar-brand .navbar-item {
            color: white !important;
        }
        
        .navbar-item, .navbar-link {
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        .navbar-item:hover, .navbar-link:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            color: white !important;
        }
        
        .button.is-primary {
            background: var(--primary-gradient) !important;
            border: none;
            transition: all 0.3s ease;
        }
        
        .button.is-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .button.is-success {
            background: var(--success-gradient) !important;
            border: none;
        }
        
        .button.is-warning {
            background: var(--warning-gradient) !important;
            border: none;
        }
        
        .button.is-danger {
            background: var(--danger-gradient) !important;
            border: none;
        }
        
        .input, .textarea, .select select {
            background: rgba(255, 255, 255, 0.1) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            color: white !important;
        }
        
        .input:focus, .textarea:focus, .select select:focus {
            border-color: #3273dc !important;
            box-shadow: 0 0 0 0.125em rgba(50, 115, 220, 0.25) !important;
        }
        
        .input::placeholder, .textarea::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }
        
        .label {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 500;
        }
        
        /* Panel Styles */
        .panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .panel-heading {
            background: rgba(255, 255, 255, 0.1) !important;
            color: white !important;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .panel-block {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }
        
        .panel-block:last-child {
            border-bottom: none;
        }
        
        /* Tab Styles */
        .tabs ul {
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .tabs li a {
            color: rgba(255, 255, 255, 0.7) !important;
            border-bottom: 1px solid transparent;
        }
        
        .tabs li.is-active a {
            color: white !important;
            border-bottom-color: #3273dc !important;
        }
        
        .tabs li a:hover {
            color: white !important;
            border-bottom-color: rgba(255, 255, 255, 0.3) !important;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: rgba(0, 0, 0, 0.1);
        }
        
        .top-bar {
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        
        .main-layout {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .sidebar {
            width: 320px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .sidebar.collapsed {
            transform: translateX(-100%);
        }
        
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 0;
        }
        
        .content-header {
            height: 60px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            padding: 0 24px;
        }
        
        .content-body {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .right-panel {
            width: 350px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .right-panel.collapsed {
            transform: translateX(100%);
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .brand h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .brand p {
            font-size: 14px;
            opacity: 0.8;
            margin: 0;
        }
        
        .top-status {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.connected { background: #10b981; }
        .status-dot.connecting { background: #f59e0b; }
        .status-dot.disconnected { background: #ef4444; }
        .status-dot.authenticated { background: #3b82f6; }
        
        .panel-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }
        
        .panel-actions {
            display: flex;
            gap: 8px;
        }
        
        .panel-content {
            flex: 1;
            overflow-y: auto;
        }
        



        
        .status-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 12px;
        }
        
        .status-indicator {
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 11px;
        }
        
        .status-disconnected { background: rgba(231, 76, 60, 0.3); border: 1px solid #e74c3c; }
        .status-connected { background: rgba(46, 204, 113, 0.3); border: 1px solid #2ecc71; }
        .status-authenticated { background: rgba(52, 152, 219, 0.3); border: 1px solid #3498db; }
        
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .nav-tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .nav-tab.active {
            color: #fff;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content {
            display: none !important;
            flex: 1;
            overflow-y: auto;
            min-height: 0; /* Important for flexbox scrolling */
        }
        
        .tab-content.active {
            display: flex !important;
            flex-direction: column;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.08);
            color: white;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            min-height: 48px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.5);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        button {
            background: rgba(52, 152, 219, 0.3);
            cursor: pointer;
            transition: background 0.3s;
            font-weight: bold;
        }
        
        button:hover:not(:disabled) {
            background: rgba(52, 152, 219, 0.5);
        }
        
        button:disabled {
            background: rgba(127, 140, 141, 0.3);
            cursor: not-allowed;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 10px;
            margin: 2px;
            width: auto;
        }
        
        .form-row {
            display: flex;
            gap: 8px;
        }
        
        .form-row input, .form-row select {
            margin-bottom: 8px;
        }
        
        .ticker-item, .order-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 6px;
            border-left: 3px solid;
            font-size: 11px;
        }
        
        .order-item.buy { border-left-color: #2ecc71; }
        .order-item.sell { border-left-color: #e74c3c; }
        .order-item.filled { border-left-color: #9b59b6; }
        .order-item.pending { border-left-color: #f39c12; }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            font-weight: bold;
        }
        
        .order-details {
            font-size: 10px;
            opacity: 0.8;
        }
        
        .messages {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 8px;
            height: 150px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 10px;
        }
        
        .message {
            margin-bottom: 3px;
            padding: 3px;
            border-radius: 3px;
            word-wrap: break-word;
        }
        
        .message.info { background: rgba(52, 152, 219, 0.2); }
        .message.success { background: rgba(46, 204, 113, 0.2); }
        .message.error { background: rgba(231, 76, 60, 0.2); }
        .message.fill { background: rgba(155, 89, 182, 0.2); }
        
        .price-bid { color: #2ecc71; }
        .price-ask { color: #e74c3c; }
        .price-mid { color: #f39c12; }
        
        h2 {
            font-size: 16px;
            margin-bottom: 12px;
            font-weight: 400;
        }
        
        h3 {
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 400;
        }
        
        .team-info {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 11px;
        }
        
        .team-info p {
            margin: 2px 0;
        }
        
        .debug-section {
            margin-bottom: 12px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }
        
        .debug-section h4 {
            font-size: 12px;
            margin-bottom: 8px;
            color: #f39c12;
        }
        
        .order-book-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }
        
        .order-book-side {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            padding: 8px;
        }
        
        .order-book-side h5 {
            font-size: 11px;
            margin-bottom: 6px;
            text-align: center;
        }
        
        .order-book-side.buy h5 { color: #2ecc71; }
        .order-book-side.sell h5 { color: #e74c3c; }
        
        .order-book-entry {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            padding: 2px 4px;
            margin: 1px 0;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .debug-warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 10px;
            color: #ffc107;
        }
        
        .session-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 6px;
            border-left: 3px solid;
            font-size: 11px;
        }
        
        .session-item.authenticated { border-left-color: #2ecc71; }
        .session-item.connected { border-left-color: #f39c12; }
        .session-item.web-client { border-left-color: #3498db; }
        .session-item.java-client { border-left-color: #e67e22; }
        
        .multiple-clients {
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.1) 50%, rgba(230, 126, 34, 0.1) 50%);
        }

        .price-slider {
            width: 100%;
            margin: 8px 0;
        }

        .market-simulator {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid #2ecc71;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .error-injection {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid #e74c3c;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .production-validator {
            background: rgba(155, 89, 182, 0.1);
            border: 1px solid #9b59b6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .offer-tester {
            background: rgba(241, 196, 15, 0.1);
            border: 1px solid #f1c40f;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .transaction-log {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid #3498db;
            border-radius: 8px;
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.18);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-1px);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .feature-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-group {
            display: flex;
            gap: 4px;
            margin: 8px 0;
            flex-wrap: wrap;
        }

        .btn-group button {
            flex: 1;
            min-width: 80px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }

        .inventory-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            font-size: 11px;
        }

        .algorithm-result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 8px;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-size: 10px;
        }

        .timer-display {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            border-radius: 4px;
            padding: 4px 8px;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            margin: 4px 0;
        }

        /* Tooltip Styles */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        .tooltip:hover::after {
            content: '';
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top: 5px solid rgba(0, 0, 0, 0.9);
            z-index: 1000;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Disabled button styles with better feedback */
        button:disabled {
            background: rgba(127, 140, 141, 0.3) !important;
            cursor: not-allowed;
            position: relative;
        }

        button:disabled:hover::before {
            content: attr(data-disabled-reason);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            z-index: 1000;
            animation: fadeIn 0.3s ease forwards;
        }

        /* Alert styles */
        .alert {
            position: fixed;
            top: 90px;
            right: 20px;
            background: rgba(52, 152, 219, 0.95);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1001;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            animation: slideIn 0.3s ease forwards;
        }

        .alert.success {
            background: rgba(46, 204, 113, 0.95);
        }

        .alert.error {
            background: rgba(231, 76, 60, 0.95);
        }

        .alert.warning {
            background: rgba(241, 196, 15, 0.95);
            color: #333;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        @keyframes slideOut {
            from { transform: translateX(0); }
            to { transform: translateX(400px); }
        }

        /* Connection status indicator enhancements */
        .status-indicator {
            position: relative;
        }

        .status-indicator::after {
            content: '';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-connected::after {
            background: #2ecc71;
        }

        .status-connecting::after {
            background: #f39c12;
        }

        .status-disconnected::after {
            background: #e74c3c;
        }

        .status-authenticated::after {
            background: #3498db;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: translateY(-50%) scale(1); }
            50% { opacity: 0.6; transform: translateY(-50%) scale(1.2); }
            100% { opacity: 1; transform: translateY(-50%) scale(1); }
        }

        .toggle-btn {
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .sidebar {
                position: absolute;
                left: 0;
                top: 80px;
                bottom: 0;
                z-index: 50;
                transform: translateX(-100%);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .right-panel {
                position: absolute;
                right: 0;
                top: 80px;
                bottom: 0;
                z-index: 50;
                transform: translateX(100%);
            }
            
            .right-panel.open {
                transform: translateX(0);
            }
            
            .content-area {
                margin: 0;
            }
        }
        
        @media (max-width: 768px) {
            .top-bar {
                padding: 0 16px;
            }
            
            .brand h1 {
                font-size: 20px;
            }
            
            .brand p {
                display: none;
            }
            
            .sidebar, .right-panel {
                width: 280px;
            }
            
            .content-body {
                padding: 16px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        /* Improve form layouts */
        .form-row {
            display: flex;
            gap: 12px;
            align-items: stretch;
        }
        
        .form-row input, .form-row select {
            flex: 1;
            margin-bottom: 12px;
        }

        /* Enhanced input and button focus states */
        input:focus, select:focus, textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.5);
        }

        button:hover:not(:disabled) {
            background: rgba(52, 152, 219, 0.6);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <section class="hero is-primary is-medium hero-gradient">
        <div class="hero-head">
            <nav class="navbar glass">
                <div class="container">
                    <div class="navbar-brand">
                        <div class="navbar-item">
                            <span class="icon is-large mr-3">
                                <i class="fas fa-seedling fa-2x" style="color: #4ade80;"></i>
                            </span>
                            <div>
                                <h1 class="title is-4 has-text-white mb-1">Intercambio de Aguacates</h1>
                                <p class="subtitle is-6 has-text-white-ter">Consola de Trading Profesional</p>
                            </div>
                        </div>
                        
                        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" onclick="toggleMobileMenu()">
                            <span aria-hidden="true"></span>
                            <span aria-hidden="true"></span>
                            <span aria-hidden="true"></span>
                        </a>
                    </div>
                    
                    <div class="navbar-menu" id="navbarMenu">
                        <div class="navbar-end">
                            <div class="navbar-item">
                                <div class="field is-grouped">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">Estado</span>
                                            <span class="tag" id="status-tag">
                                                <span id="status-dot" class="status-dot status-disconnected"></span>
                                                <span id="status-text">Desconectado</span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="control">
                                        <span class="tag is-info is-light" id="connection-time"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
        
        <div class="hero-body">
            <div class="container">
                <div class="columns is-vcentered">
                    <div class="col">
                        <h1 class="title is-1 has-text-white">
                            <span class="icon-text">
                                <span class="icon is-large">
                                    <i class="fas fa-chart-line"></i>
                                </span>
                                <span>Trading Dashboard</span>
                            </span>
                        </h1>
                        <h2 class="subtitle is-3 has-text-white-ter">
                            Plataforma avanzada de trading con simulaciÃ³n en tiempo real
                        </h2>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
                <div class="column is-3">
                    <div class="panel glass-card">
                        <p class="panel-heading">
                            <span class="icon-text">
                                <span class="icon">
                                    <i class="fas fa-tools"></i>
                                </span>
                                <span>Herramientas de Trading</span>
                            </span>
                        </p>
                        
                        <div class="panel-block">
                            <div class="tabs is-boxed is-fullwidth">
                                <ul>
                                    <li class="is-active">
                                        <a onclick="switchSidebarTab('auth')">
                                            <span class="icon is-small"><i class="fas fa-key"></i></span>
                                            <span>Auth</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a onclick="switchSidebarTab('simulator')">
                                            <span class="icon is-small"><i class="fas fa-rocket"></i></span>
                                            <span>Simulador</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a onclick="switchSidebarTab('debug')">
                                            <span class="icon is-small"><i class="fas fa-bug"></i></span>
                                            <span>Debug</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Auth Tab Content -->
                        <div id="auth-content" class="panel-block is-block">
                            <div class="box glass-card">
                                <h3 class="title is-5 has-text-white">
                                    <span class="icon-text">
                                        <span class="icon"><i class="fas fa-shield-alt"></i></span>
                                        <span>AutenticaciÃ³n</span>
                                    </span>
                                </h3>
                                
                                <div class="field">
                                    <label class="label">Token del Equipo</label>
                                    <div class="control has-icons-left">
                                        <input class="input" type="text" id="token" placeholder="TK-XXXX">
                                        <span class="icon is-small is-left">
                                            <i class="fas fa-key"></i>
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="field is-grouped">
                                    <div class="control">
                                        <button class="button is-primary" id="connect-btn" onclick="toggleConnection()">
                                            <span class="icon">
                                                <i class="fas fa-plug"></i>
                                            </span>
                                            <span>Conectar</span>
                                        </button>
                                    </div>
                                    <div class="control">
                                        <button class="button is-success" id="login-btn" onclick="login()" disabled>
                                            <span class="icon">
                                                <i class="fas fa-sign-in-alt"></i>
                                            </span>
                                            <span>Login</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="team-info" class="notification is-success is-light" style="display: none;">
                                    <div id="team-details"></div>
                                </div>
                            </div>
                            
                            <!-- Inventory Card -->
                            <div class="box glass-card">
                                <h3 class="title is-5 has-text-white">
                                    <span class="icon-text">
                                        <span class="icon"><i class="fas fa-boxes"></i></span>
                                        <span>Inventario</span>
                                    </span>
                                </h3>
                                <div id="inventory-grid" class="columns is-multiline">
                                    <div class="column is-half">
                                        <div class="stat-card">
                                            <div class="stat-label">Sin datos</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Simulator Tab Content -->
                        <div id="simulator-content" class="panel-block is-block" style="display: none;">
                            <div class="box glass-card">
                                <h3 class="title is-5 has-text-white">
                                    <span class="icon-text">
                                        <span class="icon"><i class="fas fa-rocket"></i></span>
                                        <span>Simulador de Mercado</span>
                                    </span>
                                </h3>
                                
                                <div class="field">
                                    <label class="label">Tipo de Orden</label>
                                    <div class="control has-icons-left">
                                        <div class="select is-fullwidth">
                                            <select id="sim-side">
                                                <option value="BUY">ðŸŸ¢ Comprar</option>
                                                <option value="SELL">ðŸ”´ Vender</option>
                                            </select>
                                        </div>
                                        <span class="icon is-small is-left">
                                            <i class="fas fa-exchange-alt"></i>
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="field">
                                    <label class="label">Producto</label>
                                    <div class="control has-icons-left">
                                        <div class="select is-fullwidth">
                                            <select id="sim-product">
                                                <option value="FOSFO">FOSFO</option>
                                                <option value="PITA">PITA</option>
                                                <option value="PALTA-OIL">PALTA-OIL</option>
                                                <option value="GUACA">GUACA</option>
                                                <option value="SEBO">SEBO</option>
                                                <option value="H-GUACA">H-GUACA</option>
                                            </select>
                                        </div>
                                        <span class="icon is-small is-left">
                                            <i class="fas fa-leaf"></i>
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="columns">
                                    <div class="column">
                                        <div class="field">
                                            <label class="label">Cantidad</label>
                                            <div class="control has-icons-left">
                                                <input class="input" type="number" id="sim-qty" placeholder="10" min="1">
                                                <span class="icon is-small is-left">
                                                    <i class="fas fa-hashtag"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="column">
                                        <div class="field">
                                            <label class="label">Precio</label>
                                            <div class="control has-icons-left">
                                                <input class="input" type="number" id="sim-price" placeholder="15.50" step="0.01">
                                                <span class="icon is-small is-left">
                                                    <i class="fas fa-dollar-sign"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="field">
                                    <div class="control">
                                        <button class="button is-success is-fullwidth" onclick="createMarketOrder()" disabled id="create-order-btn">
                                            <span class="icon">
                                                <i class="fas fa-chart-line"></i>
                                            </span>
                                            <span>Crear Orden de Mercado</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Debug Tab Content -->
                        <div id="debug-content" class="panel-block is-block" style="display: none;">
                            <div class="box glass-card">
                                <h3 class="title is-5 has-text-white">
                                    <span class="icon-text">
                                        <span class="icon"><i class="fas fa-bug"></i></span>
                                        <span>Herramientas de Debug</span>
                                    </span>
                                </h3>
                                
                                <div class="buttons">
                                    <button class="button is-danger" onclick="injectError('INSUFFICIENT_BALANCE')" disabled id="err-balance-btn">
                                        <span class="icon">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </span>
                                        <span>Saldo Insuficiente</span>
                                    </button>
                                    <button class="button is-warning" onclick="injectError('DISCONNECT_CLIENT')" disabled id="err-disconnect-btn">
                                        <span class="icon">
                                            <i class="fas fa-unlink"></i>
                                        </span>
                                        <span>Desconectar</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <!-- Left Sidebar -->
            <div class="sidebar" id="sidebar">
        let ws = null;
                    </div>
                    
                    <div class="nav-tabs">
                        <button class="nav-tab active" onclick="switchSidebarTab('auth')">ðŸ” Auth</button>
                        <button class="nav-tab" onclick="switchSidebarTab('simulator')">ðŸŽ¯ Simulador</button>
                        <button class="nav-tab" onclick="switchSidebarTab('debug')">ðŸ§ª Debug</button>
                    </div>
                    
                    <div class="panel-content">
                        <!-- Auth Tab -->
                        <div id="auth-content" class="tab-content active">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-icon">ðŸ”</div>
                                    <h3 class="card-title">AutenticaciÃ³n</h3>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Token del Equipo</label>
                                    <input type="text" id="token" class="form-input" placeholder="TK-XXXX" />
                                </div>
                                
                                <div style="display: flex; gap: 12px;">
                                    <button id="connect-btn" class="btn btn-primary" onclick="toggleConnection()">
                                        <span>ðŸ”Œ</span> Conectar
                                    </button>
                                    <button id="login-btn" class="btn btn-secondary" onclick="login()" disabled>
                                        <span>ðŸš€</span> Iniciar SesiÃ³n
                                    </button>
                                </div>
                                
                                <div id="team-info" style="display: none; margin-top: 16px;">
                                    <div class="card" style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3);">
                                        <div id="team-details"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-icon">ðŸ“¦</div>
                                    <h3 class="card-title">Inventario</h3>
                                </div>
                                <div id="inventory-visualizer" class="stats-grid">
                                    <div class="stat-card">
                                        <div class="stat-label">Sin datos</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Simulator Tab -->
                        <div id="simulator-content" class="tab-content">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-icon">ðŸŽ¯</div>
                                    <h3 class="card-title">Simulador de Mercado</h3>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Tipo de Orden</label>
                                    <select id="sim-side" class="form-select">
                                        <option value="BUY">ðŸŸ¢ Comprar</option>
                                        <option value="SELL">ðŸ”´ Vender</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Producto</label>
                                    <select id="sim-product" class="form-select">
                                        <option value="FOSFO">FOSFO</option>
                                        <option value="PITA">PITA</option>
                                        <option value="PALTA-OIL">PALTA-OIL</option>
                                        <option value="GUACA">GUACA</option>
                                        <option value="SEBO">SEBO</option>
                                        <option value="H-GUACA">H-GUACA</option>
                                    </select>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <div class="form-group">
                                        <label class="form-label">Cantidad</label>
                                        <input type="number" id="sim-qty" class="form-input" placeholder="10" min="1" />
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Precio</label>
                                        <input type="number" id="sim-price" class="form-input" placeholder="15.50" step="0.01" />
                                    </div>
                                </div>
                                
                                <button onclick="createMarketOrder()" class="btn btn-success" disabled id="create-order-btn">
                                    <span>ðŸ“ˆ</span> Crear Orden
                                </button>
                            </div>
                        </div>
                        
                        <!-- Debug Tab -->
                        <div id="debug-content" class="tab-content">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-icon">âš ï¸</div>
                                    <h3 class="card-title">InyecciÃ³n de Errores</h3>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <button onclick="injectError('INSUFFICIENT_BALANCE')" class="btn btn-danger" disabled id="err-balance-btn">
                                        âŒ Saldo Insuficiente
                                    </button>
                                    <button onclick="injectError('DISCONNECT_CLIENT')" class="btn btn-danger" disabled id="err-disconnect-btn">
                                        ðŸ”Œ Desconectar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Center Content Area -->
            <div class="content-area">
                <div class="content-header">
                    <div class="nav-tabs">
                        <button class="nav-tab active" onclick="switchMainTab('dashboard')">ðŸ“Š Dashboard</button>
                        <button class="nav-tab" onclick="switchMainTab('ticker')">ðŸ“ˆ Ticker</button>
                        <button class="nav-tab" onclick="switchMainTab('orderbook')">ðŸ“‹ Ã“rdenes</button>
                        <button class="nav-tab" onclick="switchMainTab('transactions')">ðŸ“‘ Transacciones</button>
                    </div>
                </div>
                
                <div class="content-body">
                    <!-- Dashboard Tab -->
                    <div id="dashboard-content" class="tab-content active">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="dashboard-balance">$--</div>
                                <div class="stat-label">Balance</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="dashboard-profit">$--</div>
                                <div class="stat-label">P&L</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="dashboard-orders">--</div>
                                <div class="stat-label">Ã“rdenes Activas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="dashboard-fills">--</div>
                                <div class="stat-label">Ejecuciones</div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">ðŸ†</div>
                                <h3 class="card-title">Top Productos</h3>
                            </div>
                            <div id="top-products">
                                <p>Cargando datos...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ticker Tab -->
                    <div id="ticker-content" class="tab-content">
                        <div id="ticker-list" class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">No hay datos disponibles</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Book Tab -->
                    <div id="orderbook-content" class="tab-content">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">ðŸ“‹</div>
                                <h3 class="card-title">Libro de Ã“rdenes</h3>
                                <select id="product-selector" class="form-select" style="width: auto;" onchange="updateOrderBook()">
                                    <option value="">Seleccionar Producto</option>
                                    <option value="FOSFO">FOSFO</option>
                                    <option value="PITA">PITA</option>
                                    <option value="PALTA-OIL">PALTA-OIL</option>
                                    <option value="GUACA">GUACA</option>
                                    <option value="SEBO">SEBO</option>
                                    <option value="H-GUACA">H-GUACA</option>
                                </select>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <h4 style="color: #10b981; text-align: center; margin-bottom: 12px;">ðŸŸ¢ COMPRAS</h4>
                                    <div id="buy-orders"></div>
                                </div>
                                <div>
                                    <h4 style="color: #ef4444; text-align: center; margin-bottom: 12px;">ðŸ”´ VENTAS</h4>
                                    <div id="sell-orders"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Transactions Tab -->
                    <div id="transactions-content" class="tab-content">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">ðŸ“‘</div>
                                <h3 class="card-title">Registro de Transacciones</h3>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="filterTransactions('all')" class="btn btn-secondary" style="padding: 8px 12px; min-height: auto;">Todas</button>
                                    <button onclick="filterTransactions('fills')" class="btn btn-secondary" style="padding: 8px 12px; min-height: auto;">Ejecuciones</button>
                                    <button onclick="clearTransactionLog()" class="btn btn-danger" style="padding: 8px 12px; min-height: auto;">Limpiar</button>
                                </div>
                            </div>
                            
                            <div id="transaction-log" style="height: 400px; overflow-y: auto; background: rgba(0, 0, 0, 0.2); border-radius: 8px; padding: 16px;">
                                <p>No hay transacciones registradas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel -->
            <div class="right-panel" id="right-panel">
                <div class="panel-container">
                    <div class="panel-header">
                        <h2 class="panel-title">ðŸ’¼ Trading</h2>
                    </div>
                    
                    <div class="nav-tabs">
                        <button class="nav-tab active" onclick="switchRightTab('trading')">ðŸ’¼ Trading</button>
                        <button class="nav-tab" onclick="switchRightTab('messages')">ðŸ’¬ Mensajes</button>
                    </div>
                    
                    <div class="panel-content">
                        <!-- Trading Tab -->
                        <div id="trading-content" class="tab-content active">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-icon">ðŸ’¼</div>
                                    <h3 class="card-title">Nueva Orden</h3>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <div class="form-group">
                                        <label class="form-label">Tipo</label>
                                        <select id="side" class="form-select">
                                            <option value="BUY">ðŸŸ¢ Comprar</option>
                                            <option value="SELL">ðŸ”´ Vender</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Modo</label>
                                        <select id="mode" class="form-select">
                                            <option value="MARKET">ðŸ“ˆ Mercado</option>
                                            <option value="LIMIT">ðŸŽ¯ LÃ­mite</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Producto</label>
                                    <select id="product" class="form-select">
                                        <option value="FOSFO">FOSFO</option>
                                        <option value="PITA">PITA</option>
                                        <option value="PALTA-OIL">PALTA-OIL</option>
                                        <option value="GUACA">GUACA</option>
                                        <option value="SEBO">SEBO</option>
                                        <option value="H-GUACA">H-GUACA</option>
                                    </select>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <div class="form-group">
                                        <label class="form-label">Cantidad</label>
                                        <input type="number" id="qty" class="form-input" placeholder="10" min="1" />
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Precio</label>
                                        <input type="number" id="price" class="form-input" placeholder="15.50" step="0.01" />
                                    </div>
                                </div>
                                
                                <button id="place-order-btn" class="btn btn-primary" onclick="placeOrder()" disabled>
                                    <span>ðŸ“¤</span> Realizar Orden
                                </button>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-icon">ðŸ“‹</div>
                                    <h3 class="card-title">Mis Ã“rdenes</h3>
                                </div>
                                <div id="my-orders-list">
                                    <p>No hay Ã³rdenes activas</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Messages Tab -->
                        <div id="messages-content" class="tab-content">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-icon">ðŸ’¬</div>
                                    <h3 class="card-title">Mensajes del Sistema</h3>
                                    <button onclick="clearMessages()" class="btn btn-secondary" style="padding: 8px 12px; min-height: auto;">Limpiar</button>
                                </div>
                                
                                <div id="message-list" style="height: 400px; overflow-y: auto; background: rgba(0, 0, 0, 0.2); border-radius: 8px; padding: 16px; font-family: 'Courier New', monospace; font-size: 12px;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Backdrop -->
        <div class="backdrop" id="backdrop" onclick="closeAllPanels()"></div>
    </div>
            
            <div id="auth-tab" class="tab-content active">
                <div class="debug-warning">
                    <strong>ðŸš¨ CONSOLA DE DEPURACIÃ“N</strong><br>
                    Â¡Esta es una herramienta de depuraciÃ³n, no un cliente de trading! 
                    Tus clientes Java deben conectarse independientemente y comportarse como clientes de trading reales.
                </div>
                
                <h3>ðŸ” AutenticaciÃ³n</h3>
                <input type="text" id="token" placeholder="Token del equipo (TK-...)" />
                <button id="connect-btn" onclick="toggleConnection()">Conectar</button>
                <button id="login-btn" onclick="login()" disabled data-disabled-reason="Primero debe conectarse al servidor">Iniciar SesiÃ³n</button>
                
                <div id="team-info" class="team-info" style="display: none;">
                    <div id="team-details"></div>
                </div>

                <!-- Inventory Visualizer -->
                <div class="feature-section">
                    <div class="feature-title">
                        <span>ðŸ“¦</span>
                        <span>Visualizador de Inventario</span>
                    </div>
                    <div id="inventory-visualizer" class="inventory-grid">
                        <div class="inventory-item">No hay datos</div>
                    </div>
                </div>
            </div>

            <!-- Market Simulator Tab -->
            <div id="simulator-tab" class="tab-content">
                <div class="feature-section market-simulator">
                    <div class="feature-title">
                        <span>ðŸŽ¯</span>
                        <span>Simulador de Mercado</span>
                    </div>
                    
                    <h4>ðŸ“ˆ CreaciÃ³n Manual de Ã“rdenes</h4>
                    <select id="sim-side">
                        <option value="BUY">ðŸŸ¢ Comprar</option>
                        <option value="SELL">ðŸ”´ Vender</option>
                    </select>
                    <select id="sim-product">
                        <option value="FOSFO">FOSFO</option>
                        <option value="PITA">PITA</option>
                        <option value="PALTA-OIL">PALTA-OIL</option>
                        <option value="GUACA">GUACA</option>
                        <option value="SEBO">SEBO</option>
                        <option value="H-GUACA">H-GUACA</option>
                    </select>
                    <input type="number" id="sim-qty" placeholder="Cantidad" min="1" />
                    <input type="number" id="sim-price" placeholder="Precio" step="0.01" />
                    <button onclick="createMarketOrder()" disabled id="create-order-btn" data-disabled-reason="Debe autenticarse para crear Ã³rdenes de mercado">Crear Orden de Mercado</button>

                    <h4>ðŸŽšï¸ Control de Precios</h4>
                    <div id="price-controls">
                        <div>
                            <label>FOSFO: $<span id="fosfo-price">10.00</span></label>
                            <input type="range" class="price-slider" id="fosfo-slider" min="5" max="50" value="10" step="0.1" onchange="updatePrice('FOSFO', this.value)">
                        </div>
                        <div>
                            <label>PITA: $<span id="pita-price">15.00</span></label>
                            <input type="range" class="price-slider" id="pita-slider" min="10" max="60" value="15" step="0.1" onchange="updatePrice('PITA', this.value)">
                        </div>
                        <div>
                            <label>PALTA-OIL: $<span id="palta-oil-price">25.00</span></label>
                            <input type="range" class="price-slider" id="palta-oil-slider" min="20" max="80" value="25" step="0.1" onchange="updatePrice('PALTA-OIL', this.value)">
                        </div>
                    </div>

                    <h4>ðŸ¤– Auto-Market Maker</h4>
                    <div class="btn-group">
                        <button onclick="toggleAutoMarketMaker()" id="auto-mm-btn">ðŸŸ¢ Activar Auto-MM</button>
                        <button onclick="clearAllOrders()" id="clear-orders-btn">ðŸ—‘ï¸ Limpiar Ã“rdenes</button>
                    </div>
                </div>
            </div>
            
            <div id="debug-tab" class="tab-content">
                <!-- Error Injection Panel -->
                <div class="feature-section error-injection">
                    <div class="feature-title">
                        <span>âš ï¸</span>
                        <span>Panel de InyecciÃ³n de Errores</span>
                    </div>
                    <div class="btn-group">
                        <button onclick="injectError('INSUFFICIENT_BALANCE')" disabled id="err-balance-btn" data-disabled-reason="Debe autenticarse para inyectar errores de prueba">âŒ Saldo Insuficiente</button>
                        <button onclick="injectError('UNAUTHORIZED_PRODUCT')" disabled id="err-product-btn" data-disabled-reason="Debe autenticarse para inyectar errores de prueba">âŒ Producto No Autorizado</button>
                    </div>
                    <div class="btn-group">
                        <button onclick="injectError('DISCONNECT_CLIENT')" disabled id="err-disconnect-btn" data-disabled-reason="Debe autenticarse para inyectar errores de prueba">ðŸ”Œ Desconectar Cliente</button>
                        <button onclick="injectError('OFFER_EXPIRED')" disabled id="err-expire-btn" data-disabled-reason="Debe autenticarse para inyectar errores de prueba">â° Expirar Oferta</button>
                    </div>
                </div>

                <!-- Production Validator -->
                <div class="feature-section production-validator">
                    <div class="feature-title">
                        <span>ðŸ­</span>
                        <span>Validador de ProducciÃ³n</span>
                    </div>
                    <select id="prod-product">
                        <option value="FOSFO">FOSFO</option>
                        <option value="PITA">PITA</option>
                        <option value="PALTA-OIL">PALTA-OIL</option>
                        <option value="GUACA">GUACA</option>
                        <option value="SEBO">SEBO</option>
                        <option value="H-GUACA">H-GUACA</option>
                    </select>
                    <input type="number" id="prod-qty" placeholder="Cantidad" min="1" />
                    <button onclick="testProduction()" disabled id="prod-btn" data-disabled-reason="Debe autenticarse para simular producciÃ³n">ðŸ§ª Simular ProducciÃ³n</button>
                    
                    <div id="production-result" class="algorithm-result" style="display: none;">
                        <div><strong>ProducciÃ³n Recibida:</strong> <span id="prod-received"></span></div>
                        <div><strong>Esperado (algoritmo):</strong></div>
                        <div id="prod-algorithm"></div>
                        <div><strong>Resultado:</strong> <span id="prod-validation"></span></div>
                        <div><strong>Bonus Premium:</strong> <span id="prod-premium"></span></div>
                    </div>
                </div>

                <!-- Offer Tester -->
                <div class="feature-section offer-tester">
                    <div class="feature-title">
                        <span>ðŸŽ¯</span>
                        <span>Probador de Ofertas</span>
                    </div>
                    <select id="offer-product">
                        <option value="FOSFO">FOSFO</option>
                        <option value="PITA">PITA</option>
                        <option value="PALTA-OIL">PALTA-OIL</option>
                        <option value="GUACA">GUACA</option>
                        <option value="SEBO">SEBO</option>
                        <option value="H-GUACA">H-GUACA</option>
                    </select>
                    <input type="number" id="offer-qty" placeholder="Cantidad" min="1" />
                    <input type="number" id="offer-max-price" placeholder="Precio MÃ¡ximo" step="0.01" />
                    <textarea id="offer-message" placeholder="Â¡Urgente! Necesario para producciÃ³n premium" rows="2"></textarea>
                    <button onclick="sendTestOffer()" disabled id="send-offer-btn" data-disabled-reason="Debe autenticarse para enviar ofertas de prueba">ðŸ“¤ Enviar Oferta</button>
                    
                    <div id="offer-response" style="display: none;">
                        <div class="timer-display">â±ï¸ Tiempo de respuesta: <span id="response-timer">--</span></div>
                        <div><strong>Estado:</strong> <span id="offer-status">Pendiente...</span></div>
                    </div>
                </div>
                
                <div class="debug-section">
                    <h4>ðŸ“Š Datos de Mercado</h4>
                    <button onclick="requestAllOrders()" disabled id="all-orders-btn" data-disabled-reason="Debe autenticarse para obtener datos del mercado">Obtener Todas las Ã“rdenes</button>
                    <button onclick="requestOrderBook()" disabled id="order-book-btn" data-disabled-reason="Debe autenticarse para obtener datos del mercado">Actualizar Libro de Ã“rdenes</button>
                </div>
                
                <div class="debug-section">
                    <h4>ðŸ”„ Prueba de ConexiÃ³n</h4>
                    <button onclick="sendPing()" disabled id="ping-btn" data-disabled-reason="Debe estar conectado para enviar ping">Enviar Ping</button>
                    <button onclick="requestResync()" disabled id="resync-btn" data-disabled-reason="Debe autenticarse para solicitar resincronizaciÃ³n">Solicitar ResincronizaciÃ³n</button>
                </div>
            </div>
            
            <div id="sessions-tab" class="tab-content">
                <div class="debug-warning">
                    <strong>ðŸ“‹ Monitor de Sesiones</strong><br>
                    Muestra equipos conectados con el mismo token. Si ves "MÃºltiples Clientes" significa que tanto 
                    tu consola de depuraciÃ³n como el cliente Java estÃ¡n conectados con el mismo token. âœ…
                </div>
                
                <div class="debug-section">
                    <h4>ðŸ‘¥ Sesiones Conectadas</h4>
                    <p style="font-size: 10px; opacity: 0.7; margin-bottom: 8px;">
                        Monitorea conexiones activas de clientes (se actualiza automÃ¡ticamente cada 10s)
                    </p>
                    <button onclick="requestConnectedSessions()" disabled id="sessions-btn" data-disabled-reason="Debe autenticarse para ver sesiones conectadas">Actualizar Sesiones</button>
                    <div id="sessions-list" style="margin-top: 8px;">
                        <p>No hay datos de sesiÃ³n disponibles</p>
                    </div>
                </div>
                
                <div class="debug-section">
                    <h4>ðŸ“ˆ EstadÃ­sticas del Servidor</h4>
                    <div id="server-stats">
                        <div class="team-info">
                            <p id="total-connections">Conexiones Totales: -</p>
                            <p id="total-orders">Ã“rdenes Totales: -</p>
                            <p id="total-fills">Ejecuciones Totales: -</p>
                            <p id="server-uptime">Tiempo de Actividad del Servidor: -</p>
                    </div>
                </div>
            </div>
            
            <div id="docs-tab" class="tab-content">
                <div style="max-height: 100%; overflow-y: auto; padding-right: 8px;">
                    <h3>ðŸ“š DocumentaciÃ³n / Documentation</h3>
                    
                    <div class="debug-section">
                        <h4>ðŸŽ¯ PropÃ³sito de esta Consola</h4>
                        <p style="font-size: 11px; line-height: 1.4; margin-bottom: 8px;">
                            Esta es una <strong>consola de depuraciÃ³n</strong>, NO un cliente de trading. 
                            Tu cliente Java debe conectarse independientemente como un cliente normal.
                        </p>
                        <p style="font-size: 11px; line-height: 1.4; color: #f39c12;">
                            <strong>Importante:</strong> Usa el mismo token en tu cliente Java y en esta consola 
                            para monitorear las conexiones y depurar problemas.
                        </p>
                    </div>
                    
                    <div class="debug-section">
                        <h4>ðŸ” AutenticaciÃ³n</h4>
                        <p style="font-size: 11px; line-height: 1.4; margin-bottom: 4px;">
                            â€¢ <strong>Token:</strong> Usa tu token TK-XXXX proporcionado por el profesor<br>
                            â€¢ <strong>Conectar:</strong> Establece conexiÃ³n WebSocket con el servidor<br>
                            â€¢ <strong>Login:</strong> Autentica usando tu token de equipo
                        </p>
                    </div>
                    
                    <div class="debug-section">
                        <h4>ðŸ‘¥ Sesiones Conectadas</h4>
                        <p style="font-size: 11px; line-height: 1.4; margin-bottom: 4px;">
                            â€¢ <strong>ðŸŒ Web Browser:</strong> Esta consola de depuraciÃ³n<br>
                            â€¢ <strong>â˜• Java Client:</strong> Tu cliente de trading Java<br>
                            â€¢ <strong>Estado:</strong> Connected (conectado) vs Authenticated (autenticado)<br>
                            â€¢ <strong>Mismo Equipo:</strong> MÃºltiples conexiones del mismo token aparecerÃ¡n aquÃ­
                        </p>
                    </div>
                    
                    <div class="debug-section">
                        <h4>ðŸ“Š Datos de Mercado</h4>
                        <p style="font-size: 11px; line-height: 1.4; margin-bottom: 4px;">
                            â€¢ <strong>Ticker:</strong> Precios en tiempo real (Bid/Ask/Mid)<br>
                            â€¢ <strong>Order Book:</strong> Ã“rdenes de compra y venta por producto<br>
                            â€¢ <strong>All Orders:</strong> Todas las Ã³rdenes del mercado<br>
                            â€¢ <strong>ActualizaciÃ³n:</strong> Los datos se actualizan automÃ¡ticamente
                        </p>
                    </div>
                    
                    <div class="debug-section">
                        <h4>ðŸ§ª Herramientas de Prueba</h4>
                        <p style="font-size: 11px; line-height: 1.4; margin-bottom: 4px;">
                            â€¢ <strong>ProducciÃ³n:</strong> Simula producciÃ³n para aÃ±adir inventario<br>
                            â€¢ <strong>Ã“rdenes Debug:</strong> Tipos especiales para pruebas:<br>
                            &nbsp;&nbsp;- <strong>Normal:</strong> Orden regular de mercado<br>
                            &nbsp;&nbsp;- <strong>Auto-Accept:</strong> El servidor acepta automÃ¡ticamente<br>
                            &nbsp;&nbsp;- <strong>Team Only:</strong> Solo visible para tu equipo<br>
                            â€¢ <strong>Ping:</strong> Prueba conectividad con el servidor<br>
                            â€¢ <strong>Resync:</strong> Solicita resincronizaciÃ³n de datos
                        </p>
                    </div>
                    
                    <div class="debug-section">
                        <h4>ðŸ’¼ Trading de Prueba</h4>
                        <p style="font-size: 11px; line-height: 1.4; margin-bottom: 4px;">
                            â€¢ <strong>Buy/Sell:</strong> Tipo de orden (compra/venta)<br>
                            â€¢ <strong>Market/Limit:</strong> Orden a mercado o con precio lÃ­mite<br>
                            â€¢ <strong>Productos:</strong> FOSFO, PITA, PALTA-OIL, GUACA, SEBO, H-GUACA<br>
                            â€¢ <strong>Cantidad:</strong> NÃºmero de unidades a comerciar<br>
                            â€¢ <strong>Precio:</strong> Solo para Ã³rdenes lÃ­mite<br>
                            â€¢ <strong>Mensaje:</strong> InformaciÃ³n adicional opcional
                        </p>
                    </div>
                    
                    <div class="debug-section">
                        <h4>ðŸ“‹ Tipos de Mensajes</h4>
                        <p style="font-size: 11px; line-height: 1.4; margin-bottom: 4px;">
                            â€¢ <strong>FILL:</strong> Orden ejecutada exitosamente<br>
                            â€¢ <strong>OFFER:</strong> Propuesta de venta dirigida<br>
                            â€¢ <strong>TICKER:</strong> ActualizaciÃ³n de precios<br>
                            â€¢ <strong>ERROR:</strong> Mensaje de error del servidor<br>
                            â€¢ <strong>ORDER_ACK:</strong> ConfirmaciÃ³n de orden recibida<br>
                            â€¢ <strong>INVENTORY_UPDATE:</strong> ActualizaciÃ³n de inventario
                        </p>
                    </div>
                    
                    <div class="debug-section">
                        <h4>ðŸ” DepuraciÃ³n de Cliente Java</h4>
                        <p style="font-size: 11px; line-height: 1.4; margin-bottom: 4px;">
                            1. <strong>Verificar ConexiÃ³n:</strong> Tu cliente debe aparecer como "â˜• Java Client"<br>
                            2. <strong>Confirmar AutenticaciÃ³n:</strong> Estado debe cambiar a "Authenticated"<br>
                            3. <strong>Probar Ã“rdenes:</strong> Usa Auto-Accept para probar recepciÃ³n de FILL<br>
                            4. <strong>Monitorear Mensajes:</strong> Observa todos los tipos de mensaje<br>
                            5. <strong>Verificar Inventario:</strong> Confirma que se actualiza correctamente<br>
                            6. <strong>Probar Ofertas:</strong> Acepta/rechaza ofertas para probar lÃ³gica
                        </p>
                    </div>
                    
                    <div class="debug-section">
                        <h4>âš ï¸ Problemas Comunes</h4>
                        <p style="font-size: 11px; line-height: 1.4; margin-bottom: 4px;">
                            â€¢ <strong>No aparece Java Client:</strong> Verificar URL y token<br>
                            â€¢ <strong>Connected pero no Authenticated:</strong> Revisar formato del token<br>
                            â€¢ <strong>Ã“rdenes no funcionan:</strong> Verificar inventario suficiente<br>
                            â€¢ <strong>Desconexiones frecuentes:</strong> Implementar reconexiÃ³n automÃ¡tica<br>
                            â€¢ <strong>Mensajes perdidos:</strong> Verificar manejo de JSON en cliente
                        </p>
                    </div>
                    
                    <div class="debug-warning">
                        <strong>ðŸ’¡ Consejo:</strong> MantÃ©n esta consola abierta mientras desarrollas tu cliente Java 
                        para monitorear conexiones, Ã³rdenes y mensajes en tiempo real.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Center Panel: Live Dashboard -->
        <div class="panel center-panel">
            <div class="tabs">
                <button class="tab active" onclick="switchMainTab('dashboard')">ðŸ“Š Dashboard</button>
                <button class="tab" onclick="switchMainTab('ticker')">ðŸ“ˆ Ticker</button>
                <button class="tab" onclick="switchMainTab('orderbook')">ðŸ“‹ Libro de Ã“rdenes</button>
                <button class="tab" onclick="switchMainTab('transactions')">ðŸ“‘ Transacciones</button>
            </div>
            
            <!-- Live Dashboard -->
            <div id="dashboard-tab" class="tab-content active">
                <div class="feature-section">
                    <div class="feature-title">
                        <span>ðŸ“Š</span>
                        <span>Dashboard en Vivo</span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="team-info">
                            <h4>ðŸ’° Estado Financiero</h4>
                            <p id="dashboard-balance">Balance: $--</p>
                            <p id="dashboard-profit">P&L: $--</p>
                            <p id="dashboard-volume">Volumen 24h: --</p>
                        </div>
                        <div class="team-info">
                            <h4>ðŸ“ˆ Actividad del Mercado</h4>
                            <p id="dashboard-orders">Ã“rdenes Activas: --</p>
                            <p id="dashboard-fills">Ejecuciones Hoy: --</p>
                            <p id="dashboard-connections">Conexiones: --</p>
                        </div>
                        <div class="team-info">
                            <h4>âš¡ Acciones RÃ¡pidas</h4>
                            <p>Estado del Servidor: <span id="server-status">â—</span></p>
                            <p>Ãšltima ActualizaciÃ³n: <span id="last-update">--</span></p>
                            <p>Latencia: <span id="ping-latency">--ms</span></p>
                        </div>
                    </div>
                    
                    <div class="team-info">
                        <h4>ðŸ† Top Productos por Volumen</h4>
                        <div id="top-products">
                            <p>Cargando datos...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="ticker-tab" class="tab-content">
                <h3>ðŸ“ˆ Ticker de Mercado en Vivo</h3>
                <div id="ticker-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px;">
                    <p style="grid-column: 1 / -1;">No hay datos de mercado disponibles</p>
                </div>
            </div>
            
            <div id="orderbook-tab" class="tab-content">
                <h3>ðŸ“‹ Libro de Ã“rdenes</h3>
                <select id="product-selector" onchange="updateOrderBook()">
                    <option value="">Seleccionar Producto</option>
                    <option value="FOSFO">FOSFO</option>
                    <option value="PITA">PITA</option>
                    <option value="PALTA-OIL">PALTA-OIL</option>
                    <option value="GUACA">GUACA</option>
                    <option value="SEBO">SEBO</option>
                    <option value="H-GUACA">H-GUACA</option>
                </select>
                <div class="order-book-grid">
                    <div class="order-book-side buy">
                        <h5>ðŸŸ¢ Ã“RDENES DE COMPRA</h5>
                        <div id="buy-orders"></div>
                    </div>
                    <div class="order-book-side sell">
                        <h5>ðŸ”´ Ã“RDENES DE VENTA</h5>
                        <div id="sell-orders"></div>
                    </div>
                </div>
            </div>
            
            <!-- Transaction Log -->
            <div id="transactions-tab" class="tab-content">
                <div class="feature-section">
                    <div class="feature-title">
                        <span>ðŸ“‘</span>
                        <span>Registro de Transacciones</span>
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <div class="btn-group">
                            <button onclick="filterTransactions('all')" id="filter-all">Todas</button>
                            <button onclick="filterTransactions('fills')" id="filter-fills">Ejecuciones</button>
                            <button onclick="filterTransactions('orders')" id="filter-orders">Ã“rdenes</button>
                            <button onclick="filterTransactions('offers')" id="filter-offers">Ofertas</button>
                            <button onclick="clearTransactionLog()" style="background: rgba(231, 76, 60, 0.3);">ðŸ—‘ï¸ Limpiar</button>
                        </div>
                    </div>
                    
                    <div class="transaction-log" id="transaction-log">
                        <p>No hay transacciones registradas</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Panel: Trading & Messages -->
        <div class="panel">
            <div class="tabs">
                <button class="tab active" onclick="switchRightTab('trading')">ðŸ’¼ Trading</button>
                <button class="tab" onclick="switchRightTab('orders')">ðŸ“‹ Mis Ã“rdenes</button>
                <button class="tab" onclick="switchRightTab('messages')">ðŸ’¬ Mensajes</button>
            </div>
            
            <div id="trading-tab" class="tab-content active">
                <h3>ðŸ’¼ Realizar Orden</h3>
                <p style="font-size: 10px; opacity: 0.7; margin-bottom: 8px;">
                    ðŸŽ¯ TRADING DE DEPURACIÃ“N - Usar para probar respuestas del mercado
                </p>
                <div class="form-row">
                    <select id="side">
                        <option value="BUY">ðŸŸ¢ Comprar</option>
                        <option value="SELL">ðŸ”´ Vender</option>
                    </select>
                    <select id="mode">
                        <option value="MARKET">ðŸ“ˆ Mercado</option>
                        <option value="LIMIT">ðŸŽ¯ LÃ­mite</option>
                    </select>
                </div>
                
                <select id="product">
                    <option value="FOSFO">FOSFO</option>
                    <option value="PITA">PITA</option>
                    <option value="PALTA-OIL">PALTA-OIL</option>
                    <option value="GUACA">GUACA</option>
                    <option value="SEBO">SEBO</option>
                    <option value="H-GUACA">H-GUACA</option>
                </select>
                
                <div class="form-row">
                    <input type="number" id="qty" placeholder="Cantidad" min="1" />
                    <input type="number" id="price" placeholder="Precio" step="0.01" />
                </div>
                
                <select id="debug-mode">
                    <option value="">Orden Normal</option>
                    <option value="AUTO_ACCEPT">Auto-Aceptar (Debug)</option>
                    <option value="TEAM_ONLY">Solo Equipo (Debug)</option>
                </select>
                
                <textarea id="message" placeholder="Mensaje opcional" rows="2"></textarea>
                <button id="place-order-btn" onclick="placeOrder()" disabled data-disabled-reason="Debe autenticarse para realizar Ã³rdenes">ðŸ“¤ Realizar Orden</button>
                
                <!-- Quick Trade Buttons -->
                <div class="feature-section" style="margin-top: 12px;">
                    <div class="feature-title">
                        <span>âš¡</span>
                        <span>Trading RÃ¡pido</span>
                    </div>
                    <div class="btn-group">
                        <button onclick="quickTrade('BUY', 'FOSFO', 10)" disabled id="quick-buy-fosfo" data-disabled-reason="Debe autenticarse para usar trading rÃ¡pido">ðŸŸ¢ Comprar 10 FOSFO</button>
                        <button onclick="quickTrade('SELL', 'FOSFO', 10)" disabled id="quick-sell-fosfo" data-disabled-reason="Debe autenticarse para usar trading rÃ¡pido">ðŸ”´ Vender 10 FOSFO</button>
                    </div>
                    <div class="btn-group">
                        <button onclick="quickTrade('BUY', 'PITA', 5)" disabled id="quick-buy-pita" data-disabled-reason="Debe autenticarse para usar trading rÃ¡pido">ðŸŸ¢ Comprar 5 PITA</button>
                        <button onclick="quickTrade('SELL', 'PITA', 5)" disabled id="quick-sell-pita" data-disabled-reason="Debe autenticarse para usar trading rÃ¡pido">ðŸ”´ Vender 5 PITA</button>
                    </div>
                </div>
            </div>
            
            <div id="orders-tab" class="tab-content">
                <h3>ðŸ“‹ Mis Ã“rdenes</h3>
                <div class="btn-group">
                    <button onclick="refreshMyOrders()" disabled id="refresh-orders-btn" data-disabled-reason="Debe autenticarse para ver sus Ã³rdenes">ðŸ”„ Actualizar</button>
                    <button onclick="cancelAllOrders()" disabled id="cancel-all-btn" style="background: rgba(231, 76, 60, 0.3);" data-disabled-reason="Debe autenticarse para cancelar Ã³rdenes">âŒ Cancelar Todas</button>
                </div>
                <div id="my-orders-list">
                    <p>No hay Ã³rdenes activas</p>
                </div>
                
                <!-- Order Statistics -->
                <div class="feature-section" style="margin-top: 12px;">
                    <div class="feature-title">
                        <span>ðŸ“Š</span>
                        <span>EstadÃ­sticas de Ã“rdenes</span>
                    </div>
                    <div class="team-info">
                        <p id="orders-today">Ã“rdenes Hoy: --</p>
                        <p id="fills-today">Ejecuciones Hoy: --</p>
                        <p id="success-rate">Tasa de Ã‰xito: --%</p>
                        <p id="avg-fill-time">Tiempo Promedio de EjecuciÃ³n: --ms</p>
                    </div>
                </div>
            </div>
            
            <div id="messages-tab" class="tab-content">
                <h3>ðŸ’¬ Mensajes del Sistema</h3>
                <div class="btn-group">
                    <button onclick="clearMessages()">ðŸ—‘ï¸ Limpiar Mensajes</button>
                    <button onclick="exportMessages()">ðŸ“¥ Exportar</button>
                </div>
                <div class="messages" id="message-list"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Center Content Area -->
                <div class="column">
                    <div class="tabs is-boxed">
                        <ul>
                            <li class="is-active">
                                <a onclick="switchMainTab('dashboard')">
                                    <span class="icon is-small"><i class="fas fa-tachometer-alt"></i></span>
                                    <span>Dashboard</span>
                                </a>
                            </li>
                            <li>
                                <a onclick="switchMainTab('ticker')">
                                    <span class="icon is-small"><i class="fas fa-chart-area"></i></span>
                                    <span>Ticker</span>
                                </a>
                            </li>
                            <li>
                                <a onclick="switchMainTab('orderbook')">
                                    <span class="icon is-small"><i class="fas fa-list-alt"></i></span>
                                    <span>Libro de Ã“rdenes</span>
                                </a>
                            </li>
                            <li>
                                <a onclick="switchMainTab('transactions')">
                                    <span class="icon is-small"><i class="fas fa-history"></i></span>
                                    <span>Transacciones</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div id="dashboard-content" class="content-tab">
                        <!-- Stats Cards -->
                        <div class="columns">
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value" id="dashboard-balance">$--</div>
                                    <div class="stat-label">Balance Total</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value" id="dashboard-profit" style="background: var(--warning-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">$--</div>
                                    <div class="stat-label">Ganancias/PÃ©rdidas</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value" id="dashboard-orders" style="background: var(--dark-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">--</div>
                                    <div class="stat-label">Ã“rdenes Activas</div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="stat-card">
                                    <div class="stat-value" id="dashboard-fills" style="background: var(--danger-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">--</div>
                                    <div class="stat-label">Ejecuciones</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Charts and Analysis -->
                        <div class="columns">
                            <div class="column is-8">
                                <div class="box glass-card">
                                    <h3 class="title is-4 has-text-white">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-chart-line"></i></span>
                                            <span>Actividad del Mercado</span>
                                        </span>
                                    </h3>
                                    <div class="content has-text-white-ter">
                                        <div id="market-activity" class="is-family-monospace">
                                            <div class="notification is-info is-light">
                                                <i class="fas fa-info-circle"></i> Conecta para ver la actividad del mercado en tiempo real
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="box glass-card">
                                    <h3 class="title is-5 has-text-white">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-trophy"></i></span>
                                            <span>Top Productos</span>
                                        </span>
                                    </h3>
                                    <div id="top-products" class="content has-text-white-ter">
                                        <p>Cargando datos...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ticker Content -->
                    <div id="ticker-content" class="content-tab" style="display: none;">
                        <div class="box glass-card">
                            <h3 class="title is-4 has-text-white">
                                <span class="icon-text">
                                    <span class="icon"><i class="fas fa-chart-area"></i></span>
                                    <span>Ticker de Mercado en Vivo</span>
                                </span>
                            </h3>
                            <div id="ticker-list" class="columns is-multiline">
                                <div class="column is-full">
                                    <div class="notification is-warning is-light">
                                        <i class="fas fa-exclamation-triangle"></i> No hay datos de mercado disponibles
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Book Content -->
                    <div id="orderbook-content" class="content-tab" style="display: none;">
                        <div class="box glass-card">
                            <div class="level">
                                <div class="level-left">
                                    <div class="level-item">
                                        <h3 class="title is-4 has-text-white">
                                            <span class="icon-text">
                                                <span class="icon"><i class="fas fa-list-alt"></i></span>
                                                <span>Libro de Ã“rdenes</span>
                                            </span>
                                        </h3>
                                    </div>
                                </div>
                                <div class="level-right">
                                    <div class="level-item">
                                        <div class="field">
                                            <div class="control has-icons-left">
                                                <div class="select">
                                                    <select id="product-selector" onchange="updateOrderBook()">
                                                        <option value="">Seleccionar Producto</option>
                                                        <option value="FOSFO">FOSFO</option>
                                                        <option value="PITA">PITA</option>
                                                        <option value="PALTA-OIL">PALTA-OIL</option>
                                                        <option value="GUACA">GUACA</option>
                                                        <option value="SEBO">SEBO</option>
                                                        <option value="H-GUACA">H-GUACA</option>
                                                    </select>
                </div>
                
                <!-- Right Sidebar -->
                <div class="column is-3">
                    <div class="panel glass-card">
                        <p class="panel-heading">
                            <span class="icon-text">
                                <span class="icon">
                                    <i class="fas fa-chart-line"></i>
                                </span>
                                <span>Centro de Trading</span>
                            </span>
                        </p>
                        
                        <div class="panel-block">
                            <div class="tabs is-boxed is-fullwidth">
                                <ul>
                                    <li class="is-active">
                                        <a onclick="switchRightTab('trading')">
                                            <span class="icon is-small"><i class="fas fa-exchange-alt"></i></span>
                                            <span>Trading</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a onclick="switchRightTab('orders')">
                                            <span class="icon is-small"><i class="fas fa-list"></i></span>
                                            <span>Ã“rdenes</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a onclick="switchRightTab('messages')">
                                            <span class="icon is-small"><i class="fas fa-comments"></i></span>
                                            <span>Mensajes</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Trading Tab -->
                        <div id="trading-content" class="panel-block is-block">
                            <div class="box glass-card">
                                <h3 class="title is-5 has-text-white">
                                    <span class="icon-text">
                                        <span class="icon"><i class="fas fa-plus-circle"></i></span>
                                        <span>Nueva Orden</span>
                                    </span>
                                </h3>
                                
                                <div class="columns">
                                    <div class="column">
                                        <div class="field">
                                            <label class="label">Tipo</label>
                                            <div class="control has-icons-left">
                                                <div class="select is-fullwidth">
                                                    <select id="side">
                                                        <option value="BUY">ðŸŸ¢ Comprar</option>
                                                        <option value="SELL">ðŸ”´ Vender</option>
                                                    </select>
                                                </div>
                                                <span class="icon is-small is-left">
                                                    <i class="fas fa-exchange-alt"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="column">
                                        <div class="field">
                                            <label class="label">Modo</label>
                                            <div class="control has-icons-left">
                                                <div class="select is-fullwidth">
                                                    <select id="mode">
                                                        <option value="MARKET">ðŸ“ˆ Mercado</option>
                                                        <option value="LIMIT">ðŸŽ¯ LÃ­mite</option>
                                                    </select>
                                                </div>
                                                <span class="icon is-small is-left">
                                                    <i class="fas fa-cog"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="field">
                                    <label class="label">Producto</label>
                                    <div class="control has-icons-left">
                                        <div class="select is-fullwidth">
                                            <select id="product">
                                                <option value="FOSFO">FOSFO</option>
                                                <option value="PITA">PITA</option>
                                                <option value="PALTA-OIL">PALTA-OIL</option>
                                                <option value="GUACA">GUACA</option>
                                                <option value="SEBO">SEBO</option>
                                                <option value="H-GUACA">H-GUACA</option>
                                            </select>
                                        </div>
                                        <span class="icon is-small is-left">
                                            <i class="fas fa-leaf"></i>
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="columns">
                                    <div class="column">
                                        <div class="field">
                                            <label class="label">Cantidad</label>
                                            <div class="control has-icons-left">
                                                <input class="input" type="number" id="qty" placeholder="10" min="1">
                                                <span class="icon is-small is-left">
                                                    <i class="fas fa-hashtag"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="column">
                                        <div class="field">
                                            <label class="label">Precio</label>
                                            <div class="control has-icons-left">
                                                <input class="input" type="number" id="price" placeholder="15.50" step="0.01">
                                                <span class="icon is-small is-left">
                                                    <i class="fas fa-dollar-sign"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="field">
                                    <div class="control">
                                        <button class="button is-primary is-fullwidth" id="place-order-btn" onclick="placeOrder()" disabled>
                                            <span class="icon">
                                                <i class="fas fa-paper-plane"></i>
                                            </span>
                                            <span>Realizar Orden</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Orders Tab -->
                        <div id="orders-content" class="panel-block is-block" style="display: none;">
                            <div class="box glass-card">
                                <h3 class="title is-5 has-text-white">
                                    <span class="icon-text">
                                        <span class="icon"><i class="fas fa-list"></i></span>
                                        <span>Mis Ã“rdenes</span>
                                    </span>
                                </h3>
                                
                                <div class="buttons">
                                    <button class="button is-info is-small" onclick="refreshMyOrders()">
                                        <span class="icon">
                                            <i class="fas fa-sync"></i>
                                        </span>
                                        <span>Actualizar</span>
                                    </button>
                                    <button class="button is-danger is-small" onclick="cancelAllOrders()">
                                        <span class="icon">
                                            <i class="fas fa-times"></i>
                                        </span>
                                        <span>Cancelar Todas</span>
                                    </button>
                                </div>
                                
                                <div id="my-orders-list" class="content is-family-monospace">
                                    <div class="notification is-warning is-light">
                                        <i class="fas fa-info-circle"></i> No hay Ã³rdenes activas
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Messages Tab -->
                        <div id="messages-content" class="panel-block is-block" style="display: none;">
                            <div class="box glass-card">
                                <div class="level">
                                    <div class="level-left">
                                        <div class="level-item">
                                            <h3 class="title is-5 has-text-white">
                                                <span class="icon-text">
                                                    <span class="icon"><i class="fas fa-comments"></i></span>
                                                    <span>Mensajes del Sistema</span>
                                                </span>
                                            </h3>
                                        </div>
                                    </div>
                                    <div class="level-right">
                                        <div class="level-item">
                                            <button class="button is-small" onclick="clearMessages()">
                                                <span class="icon">
                                                    <i class="fas fa-trash"></i>
                                                </span>
                                                <span>Limpiar</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="message-list" class="content is-family-monospace" style="height: 400px; overflow-y: auto; background: rgba(0, 0, 0, 0.2); border-radius: 8px; padding: 1rem;">
                                    <div class="notification is-info is-light">
                                        <i class="fas fa-info-circle"></i> No hay mensajes del sistema
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
                                                <span class="icon is-small is-left">
                                                    <i class="fas fa-leaf"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="columns">
                                <div class="column">
                                    <h4 class="title is-5 has-text-success">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-arrow-up"></i></span>
                                            <span>Ã“rdenes de Compra</span>
                                        </span>
                                    </h4>
                                    <div id="buy-orders" class="is-family-monospace">
                                        <div class="notification is-success is-light">Selecciona un producto</div>
                                    </div>
                                </div>
                                <div class="column">
                                    <h4 class="title is-5 has-text-danger">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-arrow-down"></i></span>
                                            <span>Ã“rdenes de Venta</span>
                                        </span>
                                    </h4>
                                    <div id="sell-orders" class="is-family-monospace">
                                        <div class="notification is-danger is-light">Selecciona un producto</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Transactions Content -->
                    <div id="transactions-content" class="content-tab" style="display: none;">
                        <div class="box glass-card">
                            <div class="level">
                                <div class="level-left">
                                    <div class="level-item">
                                        <h3 class="title is-4 has-text-white">
                                            <span class="icon-text">
                                                <span class="icon"><i class="fas fa-history"></i></span>
                                                <span>Registro de Transacciones</span>
                                            </span>
                                        </h3>
                                    </div>
                                </div>
                                <div class="level-right">
                                    <div class="level-item">
                                        <div class="buttons">
                                            <button class="button is-info is-small" onclick="filterTransactions('all')">Todas</button>
                                            <button class="button is-success is-small" onclick="filterTransactions('fills')">Ejecuciones</button>
                                            <button class="button is-danger is-small" onclick="clearTransactionLog()">Limpiar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="transaction-log" class="content is-family-monospace" style="height: 400px; overflow-y: auto; background: rgba(0, 0, 0, 0.2); border-radius: 8px; padding: 1rem;">
                                <div class="notification is-info is-light">
                                    <i class="fas fa-info-circle"></i> No hay transacciones registradas
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

    <script>
        let ws = null;
        let connected = false;
        let authenticated = false;
        let teamInfo = null;
        let reconnectAttempts = 0;
        let maxReconnectAttempts = 5;
        let reconnectDelay = 1000;
        let pingInterval = null;
        let myOrders = new Map();
        let allOrders = [];
        let orderBook = { buy: [], sell: [] };
        let currentProduct = '';
        let connectedSessions = [];
        let serverStats = {};
        let autoMarketMaker = false;
        let transactionLog = [];
        let currentFilter = 'all';
        let orderStats = {
            ordersToday: 0,
            fillsToday: 0,
            totalOrders: 0,
            totalFills: 0,
            avgFillTime: 0
        };
        let productPrices = {
            'FOSFO': 10.00,
            'PITA': 15.00,
            'PALTA-OIL': 25.00,
            'GUACA': 35.00,
            'SEBO': 20.00,
            'H-GUACA': 50.00
        };
        
        // UI Elements
        const statusIndicator = document.getElementById('status-indicator');
        const connectBtn = document.getElementById('connect-btn');
        const loginBtn = document.getElementById('login-btn');
        const placeOrderBtn = document.getElementById('place-order-btn');
        const messageList = document.getElementById('message-list');
        const tickerList = document.getElementById('ticker-list');
        const connectionTime = document.getElementById('connection-time');
        const serverTime = document.getElementById('server-time');
        
        // Bulma Tab Management
        function switchSidebarTab(tabName) {
            // Remove active class from all sidebar tabs
            document.querySelectorAll('.column.is-3 .tabs li').forEach(tab => tab.classList.remove('is-active'));
            document.querySelectorAll('.column.is-3 .panel-block.is-block').forEach(content => content.style.display = 'none');
            
            // Activate clicked tab and corresponding content
            event.target.closest('li').classList.add('is-active');
            document.getElementById(`${tabName}-content`).style.display = 'block';
        }
        
        function switchMainTab(tabName) {
            // Remove active class from all main tabs
            document.querySelectorAll('.column:not(.is-3) .tabs li').forEach(tab => tab.classList.remove('is-active'));
            document.querySelectorAll('.content-tab').forEach(content => content.style.display = 'none');
            
            // Activate clicked tab and corresponding content
            event.target.closest('li').classList.add('is-active');
            document.getElementById(`${tabName}-content`).style.display = 'block';
        }
        
        function switchRightTab(tabName) {
            // Remove active class from all right panel tabs
            document.querySelectorAll('.column.is-3:last-child .tabs li').forEach(tab => tab.classList.remove('is-active'));
            document.querySelectorAll('.column.is-3:last-child .panel-block.is-block').forEach(content => content.style.display = 'none');
            
            // Activate clicked tab and corresponding content
            event.target.closest('li').classList.add('is-active');
            document.getElementById(`${tabName}-content`).style.display = 'block';
        }
        
        // Mobile menu toggle
        function toggleMobileMenu() {
            const navbarMenu = document.getElementById('navbarMenu');
            navbarMenu.classList.toggle('is-active');
        }
        
        // Panel Toggle Functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const backdrop = document.getElementById('backdrop');
            
            if (window.innerWidth <= 1200) {
                sidebar.classList.toggle('open');
                backdrop.classList.toggle('active');
            }
        }
        
        function toggleRightPanel() {
            const rightPanel = document.getElementById('right-panel');
            const backdrop = document.getElementById('backdrop');
            
            if (window.innerWidth <= 1200) {
                rightPanel.classList.toggle('open');
                backdrop.classList.toggle('active');
            }
        }
        
        function closeAllPanels() {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('right-panel').classList.remove('open');
            document.getElementById('backdrop').classList.remove('active');
        }
        

        
        // Connection Management
        function toggleConnection() {
            if (connected) {
                disconnect();
            } else {
                connect();
            }
        }
        
        function connect() {
            if (ws) {
                ws.close();
            }
            
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            
            updateStatus('connecting', 'Connecting...');
            addMessage('info', 'Connecting to WebSocket...');
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                connected = true;
                reconnectAttempts = 0;
                updateStatus('connected', 'Connected');
                addMessage('success', 'WebSocket connected');
                connectBtn.textContent = 'Disconnect';
                loginBtn.disabled = false;
                connectionTime.textContent = `Connected: ${new Date().toLocaleTimeString()}`;
                startPing();
            };
            
            ws.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    handleMessage(data);
                } catch (e) {
                    addMessage('error', `Failed to parse message: ${e.message}`);
                }
            };
            
            ws.onclose = function(event) {
                connected = false;
                authenticated = false;
                stopPing();
                
                if (event.wasClean) {
                    updateStatus('disconnected', 'Disconnected');
                    addMessage('info', 'WebSocket disconnected cleanly');
                } else {
                    updateStatus('disconnected', 'Connection lost');
                    addMessage('error', `WebSocket disconnected unexpectedly: ${event.code}`);
                    
                    if (reconnectAttempts < maxReconnectAttempts) {
                        attemptReconnect();
                    } else {
                        addMessage('error', 'Max reconnection attempts reached');
                    }
                }
                
                connectBtn.textContent = 'Connect';
                loginBtn.disabled = true;
                disableDebugButtons();
                document.getElementById('team-info').style.display = 'none';
            };
            
            ws.onerror = function(error) {
                addMessage('error', `WebSocket error: ${error}`);
            };
        }
        
        function disconnect() {
            if (ws) {
                ws.close();
            }
        }
        
        function attemptReconnect() {
            reconnectAttempts++;
            const delay = reconnectDelay * Math.pow(2, reconnectAttempts - 1);
            
            updateStatus('connecting', `Reconnecting... (${reconnectAttempts}/${maxReconnectAttempts})`);
            addMessage('info', `Attempting reconnection ${reconnectAttempts}/${maxReconnectAttempts} in ${delay}ms`);
            
            setTimeout(() => {
                if (!connected) {
                    connect();
                }
            }, delay);
        }
        
        function startPing() {
            pingInterval = setInterval(() => {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({type: 'PING'}));
                }
            }, 25000);
        }
        
        function stopPing() {
            if (pingInterval) {
                clearInterval(pingInterval);
                pingInterval = null;
            }
        }
        
        // Status Management
        function updateStatus(status, message) {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            const statusTag = document.getElementById('status-tag');
            
            // Remove all status classes
            statusDot.className = 'status-dot';
            statusTag.className = 'tag';
            
            switch(status) {
                case 'connecting':
                    statusDot.classList.add('status-connecting');
                    statusText.textContent = 'Conectando...';
                    statusTag.classList.add('is-warning');
                    break;
                case 'connected':
                    statusDot.classList.add('status-connected');
                    statusText.textContent = 'Conectado';
                    statusTag.classList.add('is-success');
                    break;
                case 'authenticated':
                    statusDot.classList.add('status-authenticated');
                    statusText.textContent = `Autenticado: ${message}`;
                    statusTag.classList.add('is-info');
                    break;
                default:
                    statusDot.classList.add('status-disconnected');
                    statusText.textContent = 'Desconectado';
                    statusTag.classList.add('is-danger');
            }
            
            updateButtonStates();
        }
        
        function addMessage(type, message) {
            const messageContainer = document.getElementById('message-list');
            const msg = document.createElement('div');
            
            let bulmaClass = 'is-info';
            let icon = 'fas fa-info-circle';
            
            switch(type) {
                case 'success':
                case 'fill':
                    bulmaClass = 'is-success';
                    icon = 'fas fa-check-circle';
                    break;
                case 'error':
                    bulmaClass = 'is-danger';
                    icon = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    bulmaClass = 'is-warning';
                    icon = 'fas fa-exclamation-triangle';
                    break;
            }
            
            msg.className = `message-item message-${type}`;
            msg.innerHTML = `
                <span class="icon">
                    <i class="${icon}"></i>
                </span>
                <span>[${new Date().toLocaleTimeString()}] ${message}</span>
            `;
            
            messageContainer.appendChild(msg);
            messageContainer.scrollTop = messageContainer.scrollHeight;
            
            // Remove old messages if too many
            const messages = messageContainer.children;
            if (messages.length > 100) {
                messageContainer.removeChild(messages[0]);
            }
        }
        
        // Authentication
        function login() {
            if (!handleUserAction('login', 'connected')) return;
            
            if (!validateForm('login')) return;
            
            const token = document.getElementById('token').value.trim();
            
            const loginMsg = {
                type: 'LOGIN',
                token: token
            };
            
            addMessage('info', `Intentando autenticaciÃ³n con token: ${token}`);
            showAlert('Enviando credenciales de autenticaciÃ³n...', 'info');
            ws.send(JSON.stringify(loginMsg));
        }
        
        // Message Handling
        function handleMessage(data) {
            switch (data.type) {
                case 'LOGIN_OK':
                    authenticated = true;
                    teamInfo = data;
                    updateStatus('authenticated', `Autenticado como ${data.team}`);
                    addMessage('success', `Conectado como ${data.team} (${data.species})`);
                    enableDebugButtons();
                    displayTeamInfo(data);
                    updateInventoryVisualizer(data.inventory);
                    updateDashboard();
                    requestAllOrders();
                    requestConnectedSessions();
                    addToTransactionLog('LOGIN', `Conectado como ${data.team}`, 'success');
                    break;
                    
                case 'ERROR':
                    addMessage('error', `${data.code}: ${data.reason}`);
                    if (data.clOrdID) {
                        updateMyOrderStatus(data.clOrdID, 'error', data.reason);
                    }
                    break;
                    
                case 'ORDER_ACK':
                    addMessage('success', `Order acknowledged: ${data.clOrdID}`);
                    updateMyOrderStatus(data.clOrdID, 'pending', 'Order acknowledged');
                    break;
                    
                case 'FILL':
                    addMessage('fill', `EJECUCIÃ“N: ${data.fillQty} ${data.product} @ $${data.fillPrice} (${data.side}) - Contraparte: ${data.counterparty}`);
                    updateMyOrderStatus(data.clOrdID, 'filled', `Ejecutado ${data.fillQty}/${data.totalQty} @ $${data.fillPrice}`);
                    addToTransactionLog('FILL', `${data.side} ${data.fillQty} ${data.product} @ $${data.fillPrice}`, 'fill');
                    updateOrderStats('fill');
                    updateDashboard();
                    break;
                    
                case 'TICKER':
                    updateTicker(data);
                    if (data.serverTime) {
                        serverTime.textContent = `Server: ${new Date(data.serverTime).toLocaleTimeString()}`;
                    }
                    break;
                    
                case 'OFFER':
                    addMessage('info', `OFERTA: ${data.buyer} quiere ${data.quantityRequested} ${data.product} @ mÃ¡x $${data.maxPrice}`);
                    displayOffer(data);
                    addToTransactionLog('OFFER', `${data.buyer} solicita ${data.quantityRequested} ${data.product} @ mÃ¡x $${data.maxPrice}`, 'offer');
                    break;
                    
                case 'INVENTORY_UPDATE':
                    updateInventoryDisplay(data.inventory);
                    addMessage('info', 'Inventory updated');
                    break;
                    
                case 'ALL_ORDERS':
                    allOrders = data.orders;
                    updateAllOrdersDisplay();
                    break;
                    
                case 'ORDER_BOOK_UPDATE':
                    if (data.product === currentProduct) {
                        updateOrderBookDisplay(data);
                    }
                    break;
                    
                case 'CONNECTED_SESSIONS':
                    connectedSessions = data.sessions;
                    updateSessionsDisplay();
                    break;
                    
                case 'SERVER_STATS':
                    serverStats = data.stats;
                    updateServerStatsDisplay();
                    break;
                    
                case 'PONG':
                    break;
                    
                case 'ECHO':
                    addMessage('info', `Echo: ${JSON.stringify(data.original)}`);
                    break;
                    
                default:
                    addMessage('info', `${data.type}: ${JSON.stringify(data)}`);
            }
        }
        
        // Display Functions
        function displayTeamInfo(data) {
            const teamInfoEl = document.getElementById('team-info');
            const teamDetailsEl = document.getElementById('team-details');
            
            const inventoryHtml = data.inventory ? 
                Object.entries(data.inventory)
                    .filter(([product, qty]) => qty > 0)
                    .map(([product, qty]) => `${product}: ${qty}`)
                    .join(', ') || 'Sin inventario' 
                : 'Sin inventario';
            
            teamDetailsEl.innerHTML = `
                <p><strong>Equipo:</strong> ${data.team}</p>
                <p><strong>Especie:</strong> ${data.species}</p>
                <p><strong>Balance:</strong> $${data.currentBalance || data.initialBalance}</p>
                <p><strong>Inventario:</strong> ${inventoryHtml}</p>
                <p><strong>Autorizados:</strong> ${data.authorizedProducts.join(', ')}</p>
            `;
            teamInfoEl.style.display = 'block';
        }
        
        function updateInventoryDisplay(inventory) {
            if (!teamInfo) return;
            teamInfo.inventory = inventory;
            displayTeamInfo(teamInfo);
        }
        
        function updateTicker(ticker) {
            let tickerItem = document.querySelector(`[data-product="${ticker.product}"]`);
            
            if (!tickerItem) {
                tickerItem = document.createElement('div');
                tickerItem.className = 'ticker-item';
                tickerItem.setAttribute('data-product', ticker.product);
                tickerList.appendChild(tickerItem);
            }
            
            tickerItem.innerHTML = `
                <div class="order-header">
                    <span class="product">${ticker.product}</span>
                    <span class="price">
                        <span class="price-bid">$${ticker.bestBid || 'N/A'}</span> | 
                        <span class="price-ask">$${ticker.bestAsk || 'N/A'}</span> | 
                        <span class="price-mid">$${ticker.mid || 'N/A'}</span>
                    </span>
                </div>
                <div class="order-details">Vol: ${ticker.volume24h || 0}</div>
            `;
        }
        
        function updateAllOrdersDisplay() {
            const container = document.getElementById('all-orders-list');
            
            if (allOrders.length === 0) {
                container.innerHTML = '<p>No hay Ã³rdenes disponibles</p>';
                return;
            }
            
            container.innerHTML = allOrders.map(order => {
                const priceText = order.mode === 'LIMIT' && order.price ? `@ $${order.price}` : '@ Market';
                const progress = order.filledQty > 0 ? ` (${order.filledQty}/${order.quantity} filled)` : '';
                
                return `
                    <div class="order-item ${order.side.toLowerCase()}">
                        <div class="order-header">
                            <strong>${order.teamName}</strong>
                            <span>${order.side} ${order.quantity} ${order.product}</span>
                        </div>
                        <div class="order-details">
                            ${order.mode} ${priceText}${progress}
                            ${order.message ? `| "${order.message}"` : ''}
                        </div>
                        ${teamInfo && teamInfo.team !== order.teamName ? `
                            <div style="margin-top: 6px;">
                                <button class="btn-small" onclick="respondToOrder('${order.clOrdID}', true)">Aceptar</button>
                                <button class="btn-small" onclick="respondToOrder('${order.clOrdID}', false)">Rechazar</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        function updateOrderBookDisplay(data) {
            const buyContainer = document.getElementById('buy-orders');
            const sellContainer = document.getElementById('sell-orders');
            
            buyContainer.innerHTML = data.buyOrders.map(order => `
                <div class="order-book-entry">
                    <span>${order.quantity}@${order.price || 'MKT'}</span>
                    <span>${order.teamName}</span>
                </div>
            `).join('') || '<p>No buy orders</p>';
            
            sellContainer.innerHTML = data.sellOrders.map(order => `
                <div class="order-book-entry">
                    <span>${order.quantity}@${order.price || 'MKT'}</span>
                    <span>${order.teamName}</span>
                </div>
            `).join('') || '<p>No sell orders</p>';
        }
        
        function displayOffer(offer) {
            const container = document.getElementById('all-orders-list');
            
            const offerElement = document.createElement('div');
            offerElement.className = 'order-item pending';
            offerElement.innerHTML = `
                <div class="order-header">
                    <strong>OFFER: ${offer.buyer}</strong>
                    <span>${offer.quantityRequested} ${offer.product} @ max $${offer.maxPrice}</span>
                </div>
                <div class="order-details">
                    Offer ID: ${offer.offerId} | Expires in: ${offer.expiresIn}ms
                </div>
                <div style="margin-top: 6px;" id="offer-actions-${offer.offerId}">
                    <button class="btn-small" onclick="respondToOffer('${offer.offerId}', true)">Approve</button>
                    <button class="btn-small" onclick="respondToOffer('${offer.offerId}', false)">Deny</button>
                </div>
            `;
            
            container.insertBefore(offerElement, container.firstChild);
            
            if (offer.expiresIn) {
                setTimeout(() => {
                    if (offerElement.parentNode) {
                        offerElement.remove();
                    }
                }, offer.expiresIn);
            }
        }
        
        // Order Management
        function placeOrder() {
            if (!authenticated) {
                addMessage('error', 'Must be authenticated to place orders');
                return;
            }
            
            const side = document.getElementById('side').value;
            const mode = document.getElementById('mode').value;
            const product = document.getElementById('product').value;
            const qty = parseInt(document.getElementById('qty').value);
            const price = parseFloat(document.getElementById('price').value);
            const message = document.getElementById('message').value;
            const debugMode = document.getElementById('debug-mode').value;
            
            if (!qty || qty <= 0) {
                addMessage('error', 'Please enter a valid quantity');
                return;
            }
            
            if (mode === 'LIMIT' && (!price || price <= 0)) {
                addMessage('error', 'Please enter a valid price for limit orders');
                return;
            }
            
            const clOrdID = `ORD-${teamInfo.team}-${Date.now()}-${Math.random().toString(36).substr(2, 8)}`;
            
            const orderMsg = {
                type: 'ORDER',
                clOrdID: clOrdID,
                side: side,
                mode: mode,
                product: product,
                qty: qty,
                message: message || undefined,
                debugMode: debugMode || undefined
            };
            
            if (mode === 'LIMIT') {
                orderMsg.limitPrice = price;
            }
            
            addMessage('info', `Placing ${side} order: ${qty} ${product} @ ${mode}${debugMode ? ` (${debugMode})` : ''}`);
            ws.send(JSON.stringify(orderMsg));
            
            addMyOrder(clOrdID, side, mode, product, qty, price, message, debugMode);
            
            // Clear form
            document.getElementById('qty').value = '';
            document.getElementById('price').value = '';
            document.getElementById('message').value = '';
        }
        
        function addMyOrder(clOrdID, side, mode, product, qty, price, message, debugMode) {
            const order = {
                clOrdID, side, mode, product, qty, price, message, debugMode,
                status: 'submitted',
                timestamp: new Date(),
                statusText: 'Submitted to server'
            };
            
            myOrders.set(clOrdID, order);
            updateMyOrdersDisplay();
        }
        
        function updateMyOrderStatus(clOrdID, status, statusText) {
            const order = myOrders.get(clOrdID);
            if (order) {
                order.status = status;
                order.statusText = statusText;
                order.lastUpdate = new Date();
                updateMyOrdersDisplay();
            }
        }
        
        function updateMyOrdersDisplay() {
            const container = document.getElementById('my-orders-list');
            
            if (myOrders.size === 0) {
                container.innerHTML = '<p>No active orders</p>';
                return;
            }
            
            const orderArray = Array.from(myOrders.values()).sort((a, b) => b.timestamp - a.timestamp);
            
            container.innerHTML = orderArray.map(order => {
                const priceText = order.mode === 'LIMIT' && order.price ? `@ $${order.price}` : '@ Market';
                const timeText = order.timestamp.toLocaleTimeString();
                const debugText = order.debugMode ? ` [${order.debugMode}]` : '';
                
                return `
                    <div class="order-item ${order.side.toLowerCase()} ${order.status}">
                        <div class="order-header">
                            <strong>${order.side} ${order.qty} ${order.product}</strong>
                            <span>${timeText}</span>
                        </div>
                        <div class="order-details">
                            ${order.mode} ${priceText}${debugText} | ${order.statusText}
                            ${order.message ? `| "${order.message}"` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Debug Functions
        function enableDebugButtons() {
            document.getElementById('prod-btn').disabled = false;
            document.getElementById('all-orders-btn').disabled = false;
            document.getElementById('order-book-btn').disabled = false;
            document.getElementById('ping-btn').disabled = false;
            document.getElementById('resync-btn').disabled = false;
            document.getElementById('sessions-btn').disabled = false;
            document.getElementById('place-order-btn').disabled = false;
        }
        
        function disableDebugButtons() {
            document.getElementById('prod-btn').disabled = true;
            document.getElementById('all-orders-btn').disabled = true;
            document.getElementById('order-book-btn').disabled = true;
            document.getElementById('ping-btn').disabled = true;
            document.getElementById('resync-btn').disabled = true;
            document.getElementById('sessions-btn').disabled = true;
            document.getElementById('place-order-btn').disabled = true;
        }
        
        function testProduction() {
            const product = document.getElementById('prod-product').value;
            const qty = parseInt(document.getElementById('prod-qty').value);
            
            if (!qty || qty <= 0) {
                addMessage('error', 'Please enter a valid quantity');
                return;
            }
            
            const prodMsg = {
                type: 'PRODUCTION_UPDATE',
                product: product,
                quantity: qty
            };
            
            addMessage('info', `Testing production: ${qty} ${product}`);
            ws.send(JSON.stringify(prodMsg));
            
            document.getElementById('prod-qty').value = '';
        }
        
        function requestAllOrders() {
            const msg = { type: 'REQUEST_ALL_ORDERS' };
            ws.send(JSON.stringify(msg));
        }
        
        function requestOrderBook() {
            const product = document.getElementById('product-selector').value;
            if (!product) {
                addMessage('error', 'Please select a product first');
                return;
            }
            
            const msg = { type: 'REQUEST_ORDER_BOOK', product: product };
            ws.send(JSON.stringify(msg));
        }
        
        function updateOrderBook() {
            const product = document.getElementById('product-selector').value;
            currentProduct = product;
            
            if (product) {
                requestOrderBook();
            } else {
                document.getElementById('buy-orders').innerHTML = '<p>Select a product</p>';
                document.getElementById('sell-orders').innerHTML = '<p>Select a product</p>';
            }
        }
        
        function sendPing() {
            const msg = { type: 'PING' };
            ws.send(JSON.stringify(msg));
            addMessage('info', 'Ping sent');
        }
        
        function requestResync() {
            const msg = { type: 'RESYNC', lastSync: '' };
            ws.send(JSON.stringify(msg));
            addMessage('info', 'Resync requested');
        }
        
        function respondToOffer(offerId, accept) {
            if (!authenticated) {
                addMessage('error', 'Must be authenticated to respond to offers');
                return;
            }
            
            const response = {
                type: 'ACCEPT_OFFER',
                offerId: offerId,
                accept: accept
            };
            
            ws.send(JSON.stringify(response));
            
            const actionsEl = document.getElementById(`offer-actions-${offerId}`);
            if (actionsEl) {
                actionsEl.innerHTML = `<span style="color: ${accept ? '#2ecc71' : '#e74c3c'};">${accept ? 'APPROVED' : 'DENIED'}</span>`;
            }
            
            addMessage('info', `Offer ${offerId} ${accept ? 'approved' : 'denied'}`);
        }
        
        function respondToOrder(clOrdID, accept) {
            addMessage('info', `Order response not implemented yet: ${clOrdID} ${accept ? 'accepted' : 'rejected'}`);
        }
        
        function requestConnectedSessions() {
            const msg = { type: 'REQUEST_CONNECTED_SESSIONS' };
            ws.send(JSON.stringify(msg));
            addMessage('info', 'Requesting connected sessions...');
        }
        
        function updateSessionsDisplay() {
            const container = document.getElementById('sessions-list');
            
            if (connectedSessions.length === 0) {
                container.innerHTML = '<p>No connected sessions</p>';
                return;
            }
            
            container.innerHTML = connectedSessions.map(session => {
                const connectionTime = new Date(session.connectedAt).toLocaleTimeString();
                
                // Determine display based on client type
                let clientIcon = 'â˜•';
                let clientText = 'Java Client';
                let statusClass = session.authenticated ? 'authenticated' : 'connected';
                let clientClass = 'java-client';
                
                if (session.clientType === 'Multiple Clients') {
                    clientIcon = 'ðŸ”—';
                    clientText = 'Multiple Clients';
                    statusClass = 'authenticated';
                    clientClass = 'multiple-clients';
                } else if (session.clientType === 'Web Browser') {
                    clientIcon = 'ðŸŒ';
                    clientText = 'Web Browser';
                    clientClass = 'web-client';
                }
                
                return `
                    <div class="session-item ${statusClass} ${clientClass}">
                        <div class="order-header">
                            <strong>${session.teamName || 'Anonymous'}</strong>
                            <span>${clientIcon} ${clientText}</span>
                        </div>
                        <div class="order-details">
                            Connected: ${connectionTime} | 
                            Status: ${session.authenticated ? 'Authenticated' : 'Connected'} | 
                            ${session.remoteAddr}
                            ${session.lastActivity ? `| Last Activity: ${new Date(session.lastActivity).toLocaleTimeString()}` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateServerStatsDisplay() {
            if (serverStats.totalConnections !== undefined) {
                document.getElementById('total-connections').textContent = `Total Connections: ${serverStats.totalConnections}`;
            }
            if (serverStats.totalOrders !== undefined) {
                document.getElementById('total-orders').textContent = `Total Orders: ${serverStats.totalOrders}`;
            }
            if (serverStats.totalFills !== undefined) {
                document.getElementById('total-fills').textContent = `Total Fills: ${serverStats.totalFills}`;
            }
            if (serverStats.uptime !== undefined) {
                document.getElementById('server-uptime').textContent = `Server Uptime: ${serverStats.uptime}`;
            }
        }
        
        // Initialize tooltips and enhanced features
        function initializeEnhancements() {
            addFormTooltips();
            updateButtonStates();
            
            // Test docs tab visibility
            const docsTab = document.getElementById('docs-tab');
            if (docsTab) {
                console.log('Docs tab found, content length:', docsTab.innerHTML.length);
            } else {
                console.error('Docs tab not found!');
            }
            
            // Add helpful hints to the interface
            setTimeout(() => {
                if (!connected) {
                    showAlert('Â¡Bienvenido! Comience haciendo clic en "Conectar" para establecer conexiÃ³n con el servidor.', 'info', 5000);
                }
            }, 1000);
        }
        
        // Auto-connect on page load
        window.onload = function() {
            initializeEnhancements();
            // Clean up old orders periodically
            setInterval(() => {
                const cutoff = new Date(Date.now() - 300000); // 5 minutes ago
                for (const [clOrdID, order] of myOrders.entries()) {
                    if (order.status === 'filled' || order.status === 'error') {
                        if (order.timestamp < cutoff) {
                            myOrders.delete(clOrdID);
                        }
                    }
                }
                updateMyOrdersDisplay();
            }, 60000);
            
            // Auto-refresh sessions every 10 seconds if authenticated
            setInterval(() => {
                if (authenticated && ws && ws.readyState === WebSocket.OPEN) {
                    requestConnectedSessions();
                }
            }, 10000);
        };
        
        // Handle Enter key in forms
        document.getElementById('token').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (!connected) {
                    connect();
                } else {
                    login();
                }
            }
        });
        
        ['qty', 'price'].forEach(id => {
            document.getElementById(id).addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    placeOrder();
                }
            });
        });
        
        document.getElementById('prod-qty').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testProduction();
            }
        });

        // New Features Implementation
        
        // Market Simulator Functions
        function createMarketOrder() {
            if (!handleUserAction('createMarketOrder', 'authenticated')) return;
            
            if (!validateForm('market-order')) return;
            
            const side = document.getElementById('sim-side').value;
            const product = document.getElementById('sim-product').value;
            const qty = parseInt(document.getElementById('sim-qty').value);
            const price = parseFloat(document.getElementById('sim-price').value);
            
            const clOrdID = `SIM-${teamInfo.team}-${Date.now()}-${Math.random().toString(36).substr(2, 8)}`;
            
            const orderMsg = {
                type: 'ORDER',
                clOrdID: clOrdID,
                side: side,
                mode: 'LIMIT',
                product: product,
                qty: qty,
                limitPrice: price,
                message: 'ðŸŽ¯ Orden del Simulador de Mercado',
                debugMode: 'MARKET_SIMULATOR'
            };
            
            addMessage('info', `Creando orden de mercado: ${side} ${qty} ${product} @ $${price}`);
            showAlert(`Orden creada: ${side} ${qty} ${product} @ $${price}`, 'success');
            ws.send(JSON.stringify(orderMsg));
            addToTransactionLog('MARKET_ORDER', `${side} ${qty} ${product} @ $${price}`, 'order');
            
            // Clear form
            document.getElementById('sim-qty').value = '';
            document.getElementById('sim-price').value = '';
        }
        
        function updatePrice(product, value) {
            productPrices[product] = parseFloat(value);
            document.getElementById(`${product.toLowerCase().replace('-', '-')}-price`).textContent = parseFloat(value).toFixed(2);
            
            // Auto-create counter orders if auto market maker is enabled
            if (autoMarketMaker && authenticated) {
                createCounterOrders(product, parseFloat(value));
            }
        }
        
        function toggleAutoMarketMaker() {
            autoMarketMaker = !autoMarketMaker;
            const btn = document.getElementById('auto-mm-btn');
            
            if (autoMarketMaker) {
                btn.textContent = 'ðŸ”´ Desactivar Auto-MM';
                btn.style.background = 'rgba(231, 76, 60, 0.3)';
                addMessage('success', 'Auto Market Maker activado');
            } else {
                btn.textContent = 'ðŸŸ¢ Activar Auto-MM';
                btn.style.background = 'rgba(46, 204, 113, 0.3)';
                addMessage('info', 'Auto Market Maker desactivado');
            }
        }
        
        function createCounterOrders(product, basePrice) {
            if (!authenticated) return;
            
            // Create buy order 5% below
            const buyPrice = (basePrice * 0.95).toFixed(2);
            const buyOrderMsg = {
                type: 'ORDER',
                clOrdID: `AMM-BUY-${Date.now()}`,
                side: 'BUY',
                mode: 'LIMIT',
                product: product,
                qty: 5,
                limitPrice: parseFloat(buyPrice),
                message: 'ðŸ¤– Auto Market Maker - Compra',
                debugMode: 'AUTO_MARKET_MAKER'
            };
            
            // Create sell order 5% above
            const sellPrice = (basePrice * 1.05).toFixed(2);
            const sellOrderMsg = {
                type: 'ORDER',
                clOrdID: `AMM-SELL-${Date.now()}`,
                side: 'SELL',
                mode: 'LIMIT',
                product: product,
                qty: 5,
                limitPrice: parseFloat(sellPrice),
                message: 'ðŸ¤– Auto Market Maker - Venta',
                debugMode: 'AUTO_MARKET_MAKER'
            };
            
            setTimeout(() => ws.send(JSON.stringify(buyOrderMsg)), 100);
            setTimeout(() => ws.send(JSON.stringify(sellOrderMsg)), 200);
        }
        
        function clearAllOrders() {
            if (!authenticated) {
                addMessage('error', 'Debe estar autenticado para limpiar Ã³rdenes');
                return;
            }
            
            const clearMsg = { type: 'CLEAR_ALL_ORDERS' };
            ws.send(JSON.stringify(clearMsg));
            addMessage('info', 'Solicitando limpieza de todas las Ã³rdenes');
        }
        
        // Error Injection Functions
        function injectError(errorType) {
            if (!authenticated) {
                addMessage('error', 'Debe estar autenticado para inyectar errores');
                return;
            }
            
            const errorMsg = {
                type: 'INJECT_ERROR',
                errorType: errorType
            };
            
            ws.send(JSON.stringify(errorMsg));
            
            const errorNames = {
                'INSUFFICIENT_BALANCE': 'Saldo Insuficiente',
                'UNAUTHORIZED_PRODUCT': 'Producto No Autorizado',
                'DISCONNECT_CLIENT': 'Desconectar Cliente',
                'OFFER_EXPIRED': 'Expirar Oferta'
            };
            
            addMessage('error', `Inyectando error: ${errorNames[errorType]}`);
            addToTransactionLog('ERROR_INJECTION', errorNames[errorType], 'error');
        }
        
        // Production Validator Functions
        function testProduction() {
            const product = document.getElementById('prod-product').value;
            const qty = parseInt(document.getElementById('prod-qty').value);
            
            if (!qty || qty <= 0) {
                addMessage('error', 'Por favor ingrese una cantidad vÃ¡lida');
                return;
            }
            
            // Simulate algorithm calculation
            const algorithmResult = calculateProductionAlgorithm(product, qty);
            
            const prodMsg = {
                type: 'PRODUCTION_UPDATE',
                product: product,
                quantity: qty
            };
            
            addMessage('info', `Probando producciÃ³n: ${qty} ${product}`);
            ws.send(JSON.stringify(prodMsg));
            
            // Display production validation
            displayProductionValidation(product, qty, algorithmResult);
            addToTransactionLog('PRODUCTION', `${qty} ${product}`, 'production');
            
            document.getElementById('prod-qty').value = '';
        }
        
        function calculateProductionAlgorithm(product, quantity) {
            // Simulate production algorithm
            const branches = 2;
            const maxDepth = 4;
            const decay = 0.7651;
            const baseEnergy = 3.0;
            const levelEnergy = 2.0;
            
            // Simple calculation (this would be more complex in real implementation)
            const expectedQty = Math.floor(baseEnergy * levelEnergy * decay * branches);
            
            return {
                branches,
                maxDepth,
                decay,
                baseEnergy,
                levelEnergy,
                expectedQty,
                actualQty: quantity,
                isCorrect: Math.abs(expectedQty - quantity) <= 2,
                premiumBonus: quantity > expectedQty
            };
        }
        
        function displayProductionValidation(product, quantity, algorithm) {
            const resultEl = document.getElementById('production-result');
            const receivedEl = document.getElementById('prod-received');
            const algorithmEl = document.getElementById('prod-algorithm');
            const validationEl = document.getElementById('prod-validation');
            const premiumEl = document.getElementById('prod-premium');
            
            receivedEl.textContent = `${quantity} ${product} (bÃ¡sico)`;
            algorithmEl.innerHTML = `
                branches=${algorithm.branches}, maxDepth=${algorithm.maxDepth}, decay=${algorithm.decay}<br>
                baseEnergy=${algorithm.baseEnergy}, levelEnergy=${algorithm.levelEnergy}<br>
                â†’ Resultado: ${algorithm.expectedQty} unidades
            `;
            validationEl.innerHTML = algorithm.isCorrect ? 
                'âœ… CORRECTO' : 
                `âŒ INCORRECTO (esperado: ${algorithm.expectedQty})`;
            validationEl.style.color = algorithm.isCorrect ? '#2ecc71' : '#e74c3c';
            premiumEl.textContent = algorithm.premiumBonus ? 'SÃ' : 'NO';
            premiumEl.style.color = algorithm.premiumBonus ? '#f39c12' : '#95a5a6';
            
            resultEl.style.display = 'block';
        }
        
        // Offer Tester Functions
        function sendTestOffer() {
            if (!authenticated) {
                addMessage('error', 'Debe estar autenticado para enviar ofertas');
                return;
            }
            
            const product = document.getElementById('offer-product').value;
            const qty = parseInt(document.getElementById('offer-qty').value);
            const maxPrice = parseFloat(document.getElementById('offer-max-price').value);
            const message = document.getElementById('offer-message').value;
            
            if (!qty || qty <= 0) {
                addMessage('error', 'Por favor ingrese una cantidad vÃ¡lida');
                return;
            }
            
            if (!maxPrice || maxPrice <= 0) {
                addMessage('error', 'Por favor ingrese un precio mÃ¡ximo vÃ¡lido');
                return;
            }
            
            const offerId = `OFFER-${Date.now()}`;
            const offerMsg = {
                type: 'SEND_OFFER',
                offerId: offerId,
                product: product,
                quantityRequested: qty,
                maxPrice: maxPrice,
                message: message || 'Â¡Urgente! Necesario para producciÃ³n premium'
            };
            
            ws.send(JSON.stringify(offerMsg));
            addMessage('info', `Enviando oferta: ${qty} ${product} @ mÃ¡x $${maxPrice}`);
            
            // Start response timer
            startOfferTimer(offerId);
            addToTransactionLog('OFFER_SENT', `${qty} ${product} @ mÃ¡x $${maxPrice}`, 'offer');
        }
        
        function startOfferTimer(offerId) {
            const responseEl = document.getElementById('offer-response');
            const timerEl = document.getElementById('response-timer');
            const statusEl = document.getElementById('offer-status');
            
            responseEl.style.display = 'block';
            statusEl.textContent = 'Pendiente...';
            
            let startTime = Date.now();
            const timer = setInterval(() => {
                const elapsed = Date.now() - startTime;
                timerEl.textContent = `${elapsed}ms`;
                
                if (elapsed > 30000) { // 30 second timeout
                    clearInterval(timer);
                    statusEl.textContent = 'Tiempo agotado';
                    statusEl.style.color = '#e74c3c';
                }
            }, 100);
            
            // Store timer to clear it if response comes
            window.currentOfferTimer = timer;
        }
        
        // Transaction Log Functions
        function addToTransactionLog(type, description, category) {
            const transaction = {
                id: Date.now(),
                timestamp: new Date(),
                type: type,
                description: description,
                category: category
            };
            
            transactionLog.unshift(transaction);
            
            // Keep only last 1000 transactions
            if (transactionLog.length > 1000) {
                transactionLog = transactionLog.slice(0, 1000);
            }
            
            updateTransactionLogDisplay();
        }
        
        function updateTransactionLogDisplay() {
            const container = document.getElementById('transaction-log');
            
            const filteredLog = transactionLog.filter(tx => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'fills') return tx.category === 'fill';
                if (currentFilter === 'orders') return tx.category === 'order';
                if (currentFilter === 'offers') return tx.category === 'offer';
                return true;
            });
            
            if (filteredLog.length === 0) {
                container.innerHTML = '<p>No hay transacciones registradas</p>';
                return;
            }
            
            container.innerHTML = filteredLog.slice(0, 50).map(tx => {
                const timeStr = tx.timestamp.toLocaleTimeString();
                const categoryIcon = {
                    'fill': 'ðŸ’°',
                    'order': 'ðŸ“‹',
                    'offer': 'ðŸŽ¯',
                    'error': 'âŒ',
                    'success': 'âœ…',
                    'production': 'ðŸ­'
                }[tx.category] || 'ðŸ“';
                
                return `
                    <div class="message ${tx.category}" style="margin-bottom: 4px;">
                        <strong>[${timeStr}] ${categoryIcon} ${tx.type}:</strong> ${tx.description}
                    </div>
                `;
            }).join('');
        }
        
        function filterTransactions(filter) {
            currentFilter = filter;
            
            // Update button states
            document.querySelectorAll('#transactions-tab .btn-group button').forEach(btn => {
                btn.style.background = 'rgba(52, 152, 219, 0.3)';
            });
            document.getElementById(`filter-${filter}`).style.background = 'rgba(52, 152, 219, 0.5)';
            
            updateTransactionLogDisplay();
        }
        
        function clearTransactionLog() {
            transactionLog = [];
            updateTransactionLogDisplay();
            addMessage('info', 'Registro de transacciones limpiado');
        }
        
        // Dashboard Functions
        function updateDashboard() {
            if (!teamInfo) return;
            
            document.getElementById('dashboard-balance').textContent = 
                `Balance: $${teamInfo.currentBalance || teamInfo.initialBalance || '--'}`;
            
            const profit = teamInfo.currentBalance ? 
                (teamInfo.currentBalance - teamInfo.initialBalance).toFixed(2) : '--';
            document.getElementById('dashboard-profit').textContent = `P&L: $${profit}`;
            
            document.getElementById('dashboard-volume').textContent = 
                `Volumen 24h: ${calculateVolume24h()}`;
            
            document.getElementById('dashboard-orders').textContent = 
                `Ã“rdenes Activas: ${myOrders.size}`;
            
            document.getElementById('dashboard-fills').textContent = 
                `Ejecuciones Hoy: ${orderStats.fillsToday}`;
            
            document.getElementById('dashboard-connections').textContent = 
                `Conexiones: ${connectedSessions.length}`;
            
            // Update server status indicators
            const serverStatusEl = document.getElementById('server-status');
            const lastUpdateEl = document.getElementById('last-update');
            
            if (serverStatusEl) {
                if (authenticated) {
                    serverStatusEl.textContent = 'ðŸŸ¢';
                    serverStatusEl.style.color = '#2ecc71';
                } else if (connected) {
                    serverStatusEl.textContent = 'ðŸŸ¡';
                    serverStatusEl.style.color = '#f39c12';
                } else {
                    serverStatusEl.textContent = 'ðŸ”´';
                    serverStatusEl.style.color = '#e74c3c';
                }
            }
            
            if (lastUpdateEl) {
                lastUpdateEl.textContent = new Date().toLocaleTimeString();
            }
            
            updateTopProducts();
        }
        
        function calculateVolume24h() {
            // Calculate from transaction log
            const now = new Date();
            const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
            
            return transactionLog
                .filter(tx => tx.timestamp > yesterday && tx.category === 'fill')
                .length;
        }
        
        function updateTopProducts() {
            const productVolumes = {};
            
            transactionLog
                .filter(tx => tx.category === 'fill')
                .forEach(tx => {
                    const match = tx.description.match(/(\w+)/);
                    if (match) {
                        const product = match[1];
                        productVolumes[product] = (productVolumes[product] || 0) + 1;
                    }
                });
            
            const sorted = Object.entries(productVolumes)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3);
            
            const container = document.getElementById('top-products');
            
            if (sorted.length === 0) {
                container.innerHTML = '<p>No hay datos de volumen</p>';
                return;
            }
            
            container.innerHTML = sorted.map(([product, volume], index) => {
                const medal = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'][index];
                return `<p>${medal} ${product}: ${volume} ejecuciones</p>`;
            }).join('');
        }
        
        // Inventory Visualizer
        function updateInventoryVisualizer(inventory) {
            const container = document.getElementById('inventory-visualizer');
            
            if (!inventory || Object.keys(inventory).length === 0) {
                container.innerHTML = '<div class="inventory-item">Sin inventario</div>';
                return;
            }
            
            container.innerHTML = Object.entries(inventory)
                .map(([product, qty]) => `
                    <div class="inventory-item">
                        <strong>${product}</strong><br>
                        <span style="font-size: 14px; color: #f39c12;">${qty}</span>
                    </div>
                `).join('');
        }
        
        // Quick Trade Functions
        function quickTrade(side, product, qty) {
            if (!authenticated) {
                addMessage('error', 'Debe estar autenticado para realizar trading rÃ¡pido');
                return;
            }
            
            const clOrdID = `QUICK-${side}-${Date.now()}`;
            const orderMsg = {
                type: 'ORDER',
                clOrdID: clOrdID,
                side: side,
                mode: 'MARKET',
                product: product,
                qty: qty,
                message: `âš¡ Trading RÃ¡pido`,
                debugMode: 'QUICK_TRADE'
            };
            
            ws.send(JSON.stringify(orderMsg));
            addMessage('info', `Trading rÃ¡pido: ${side} ${qty} ${product}`);
            addToTransactionLog('QUICK_TRADE', `${side} ${qty} ${product}`, 'order');
        }
        
        // Order Management Functions
        function refreshMyOrders() {
            updateMyOrdersDisplay();
            addMessage('info', 'Ã“rdenes actualizadas');
        }
        
        function cancelAllOrders() {
            if (!authenticated) {
                addMessage('error', 'Debe estar autenticado para cancelar Ã³rdenes');
                return;
            }
            
            const cancelMsg = { type: 'CANCEL_ALL_ORDERS' };
            ws.send(JSON.stringify(cancelMsg));
            addMessage('info', 'Solicitando cancelaciÃ³n de todas las Ã³rdenes');
        }
        
        function updateOrderStats(action) {
            if (action === 'order') {
                orderStats.ordersToday++;
                orderStats.totalOrders++;
            } else if (action === 'fill') {
                orderStats.fillsToday++;
                orderStats.totalFills++;
            }
            
            // Update display
            document.getElementById('orders-today').textContent = `Ã“rdenes Hoy: ${orderStats.ordersToday}`;
            document.getElementById('fills-today').textContent = `Ejecuciones Hoy: ${orderStats.fillsToday}`;
            
            const successRate = orderStats.totalOrders > 0 ? 
                ((orderStats.totalFills / orderStats.totalOrders) * 100).toFixed(1) : 0;
            document.getElementById('success-rate').textContent = `Tasa de Ã‰xito: ${successRate}%`;
        }
        
        // Message Management
        function clearMessages() {
            messageList.innerHTML = '';
            addMessage('info', 'Mensajes limpiados');
        }
        
        function exportMessages() {
            const messages = Array.from(messageList.children).map(msg => msg.textContent);
            const blob = new Blob([messages.join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `messages-${new Date().toISOString().slice(0, 19)}.txt`;
            a.click();
            
            URL.revokeObjectURL(url);
            addMessage('info', 'Mensajes exportados');
        }
        
        // Alert and notification system
        function showAlert(message, type = 'info', duration = 3000) {
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            
            // Add appropriate icon based on type
            const icons = {
                'success': 'âœ…',
                'error': 'âŒ',
                'warning': 'âš ï¸',
                'info': 'â„¹ï¸'
            };
            
            alert.innerHTML = `${icons[type] || 'ðŸ“'} ${message}`;
            document.body.appendChild(alert);
            
            // Auto remove after duration
            setTimeout(() => {
                alert.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 300);
            }, duration);
        }
        
        // Enhanced error handling with better user feedback
        function handleUserAction(action, requiredState = 'authenticated') {
            if (requiredState === 'connected' && !connected) {
                showAlert('Debe conectarse al servidor primero. Haga clic en "Conectar".', 'warning');
                return false;
            }
            
            if (requiredState === 'authenticated' && !authenticated) {
                showAlert('Debe autenticarse primero. Ingrese su token y haga clic en "Iniciar SesiÃ³n".', 'warning');
                return false;
            }
            
            return true;
        }
        
        // Add helpful tooltips to form elements
        function addFormTooltips() {
            // Add tooltips to input fields
            document.getElementById('token').setAttribute('data-tooltip', 'Ingrese su token de equipo proporcionado por el profesor (formato: TK-XXXX)');
            document.getElementById('sim-qty').setAttribute('data-tooltip', 'Cantidad de unidades para la orden (nÃºmero entero positivo)');
            document.getElementById('sim-price').setAttribute('data-tooltip', 'Precio por unidad en dÃ³lares (ejemplo: 10.50)');
            document.getElementById('prod-qty').setAttribute('data-tooltip', 'Cantidad a producir para simulaciÃ³n (nÃºmero entero positivo)');
            document.getElementById('offer-qty').setAttribute('data-tooltip', 'Cantidad solicitada en la oferta');
            document.getElementById('offer-max-price').setAttribute('data-tooltip', 'Precio mÃ¡ximo que estÃ¡ dispuesto a pagar');
            
            // Make form elements use tooltip class
            ['token', 'sim-qty', 'sim-price', 'prod-qty', 'offer-qty', 'offer-max-price'].forEach(id => {
                document.getElementById(id).className += ' tooltip';
            });
        }
        
        // Enhanced connection status updates
        function updateConnectionStatus(status, details = '') {
            const statusEl = document.getElementById('status-indicator');
            const connectionTimeEl = document.getElementById('connection-time');
            
            switch(status) {
                case 'connecting':
                    statusEl.textContent = 'Conectando...';
                    statusEl.className = 'status-indicator status-connecting';
                    showAlert('Estableciendo conexiÃ³n con el servidor...', 'info');
                    break;
                case 'connected':
                    statusEl.textContent = 'Conectado';
                    statusEl.className = 'status-indicator status-connected';
                    connectionTimeEl.textContent = `Conectado: ${new Date().toLocaleTimeString()}`;
                    showAlert('ConexiÃ³n establecida exitosamente. Ahora puede iniciar sesiÃ³n.', 'success');
                    break;
                case 'authenticated':
                    statusEl.textContent = `Autenticado: ${details}`;
                    statusEl.className = 'status-indicator status-authenticated';
                    showAlert(`AutenticaciÃ³n exitosa como ${details}. Todas las funciones estÃ¡n disponibles.`, 'success');
                    break;
                case 'disconnected':
                    statusEl.textContent = 'Desconectado';
                    statusEl.className = 'status-indicator status-disconnected';
                    connectionTimeEl.textContent = '';
                    showAlert('ConexiÃ³n perdida. Intente reconectar.', 'error');
                    break;
            }
        }
        
        // Button state management with better feedback
        function updateButtonStates() {
            const buttons = [
                { id: 'login-btn', requires: 'connected', reason: 'Debe conectarse al servidor primero' },
                { id: 'create-order-btn', requires: 'authenticated', reason: 'Debe autenticarse para crear Ã³rdenes' },
                { id: 'prod-btn', requires: 'authenticated', reason: 'Debe autenticarse para simular producciÃ³n' },
                { id: 'send-offer-btn', requires: 'authenticated', reason: 'Debe autenticarse para enviar ofertas' },
                { id: 'place-order-btn', requires: 'authenticated', reason: 'Debe autenticarse para realizar Ã³rdenes' },
                { id: 'ping-btn', requires: 'connected', reason: 'Debe estar conectado para enviar ping' },
                { id: 'resync-btn', requires: 'authenticated', reason: 'Debe autenticarse para solicitar resincronizaciÃ³n' }
            ];
            
            buttons.forEach(btn => {
                const element = document.getElementById(btn.id);
                if (element) {
                    const shouldEnable = (btn.requires === 'connected' && connected) || 
                                       (btn.requires === 'authenticated' && authenticated);
                    
                    element.disabled = !shouldEnable;
                    element.setAttribute('data-disabled-reason', shouldEnable ? '' : btn.reason);
                }
            });
        }
        
        // Enhanced message display with categories
        function addMessage(type, message, showAlert = false) {
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            messageList.appendChild(msg);
            messageList.scrollTop = messageList.scrollHeight;
            
            // Show alert for important messages
            if (showAlert || type === 'error') {
                showAlert(message, type === 'error' ? 'error' : type === 'success' ? 'success' : 'info');
            }
            
            // Auto-scroll to messages tab for errors
            if (type === 'error') {
                const messagesTab = document.querySelector('[onclick="switchRightTab(\'messages\')"]');
                if (messagesTab && !messagesTab.classList.contains('active')) {
                    messagesTab.style.background = 'rgba(231, 76, 60, 0.5)';
                    setTimeout(() => {
                        messagesTab.style.background = '';
                    }, 2000);
                }
            }
        }
        
        // Enhanced form validation with user feedback
        function validateForm(formType) {
            let isValid = true;
            let errors = [];
            
            switch(formType) {
                case 'login':
                    const token = document.getElementById('token').value.trim();
                    if (!token) {
                        errors.push('El token es requerido');
                        isValid = false;
                    } else if (!token.startsWith('TK-')) {
                        errors.push('El token debe comenzar con "TK-"');
                        isValid = false;
                    }
                    break;
                    
                case 'order':
                    const qty = parseInt(document.getElementById('qty').value);
                    const price = parseFloat(document.getElementById('price').value);
                    const mode = document.getElementById('mode').value;
                    
                    if (!qty || qty <= 0) {
                        errors.push('La cantidad debe ser un nÃºmero positivo');
                        isValid = false;
                    }
                    
                    if (mode === 'LIMIT' && (!price || price <= 0)) {
                        errors.push('El precio debe ser un nÃºmero positivo para Ã³rdenes lÃ­mite');
                        isValid = false;
                    }
                    break;
                    
                case 'market-order':
                    const simQty = parseInt(document.getElementById('sim-qty').value);
                    const simPrice = parseFloat(document.getElementById('sim-price').value);
                    
                    if (!simQty || simQty <= 0) {
                        errors.push('La cantidad debe ser un nÃºmero positivo');
                        isValid = false;
                    }
                    
                    if (!simPrice || simPrice <= 0) {
                        errors.push('El precio debe ser un nÃºmero positivo');
                        isValid = false;
                    }
                    break;
            }
            
            if (!isValid) {
                showAlert(`Errores de validaciÃ³n: ${errors.join(', ')}`, 'error');
            }
            
            return isValid;
        }
        
        // Enhanced button enabling
        function enableDebugButtons() {
            document.getElementById('prod-btn').disabled = false;
            document.getElementById('all-orders-btn').disabled = false;
            document.getElementById('order-book-btn').disabled = false;
            document.getElementById('ping-btn').disabled = false;
            document.getElementById('resync-btn').disabled = false;
            document.getElementById('sessions-btn').disabled = false;
            document.getElementById('place-order-btn').disabled = false;
            document.getElementById('create-order-btn').disabled = false;
            document.getElementById('send-offer-btn').disabled = false;
            document.getElementById('quick-buy-fosfo').disabled = false;
            document.getElementById('quick-sell-fosfo').disabled = false;
            document.getElementById('quick-buy-pita').disabled = false;
            document.getElementById('quick-sell-pita').disabled = false;
            document.getElementById('refresh-orders-btn').disabled = false;
            document.getElementById('cancel-all-btn').disabled = false;
            
            // Error injection buttons
            document.getElementById('err-balance-btn').disabled = false;
            document.getElementById('err-product-btn').disabled = false;
            document.getElementById('err-disconnect-btn').disabled = false;
            document.getElementById('err-expire-btn').disabled = false;
        }
    </script>
</body>
</html>