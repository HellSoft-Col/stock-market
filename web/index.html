<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ¥‘ Intercambio de Aguacates - Trading Platform</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¥‘</text></svg>">
    
    <!-- Meta tags -->
    <meta name="description" content="Modern trading platform for avocados with real-time simulation and advanced analytics">
    <meta name="theme-color" content="#059669">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'mono': ['JetBrains Mono', 'monospace']
                    },
                    colors: {
                        primary: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            500: '#059669',
                            600: '#047857',
                            700: '#065f46',
                            900: '#064e3b'
                        }
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        
        .glass-effect {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-connected { background: #10b981; }
        .status-connecting { background: #f59e0b; }
        .status-disconnected { background: #ef4444; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .tab-active {
            border-bottom: 2px solid #059669;
            color: #059669;
        }
        
        .sidebar-tab-active {
            background: #ecfdf5;
            border-left: 4px solid #059669;
            color: #059669;
        }
    </style>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 font-sans">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">ðŸ¥‘</div>
                    <div>
                        <h1 class="text-xl font-bold">Intercambio de Aguacates</h1>
                        <p class="text-sm text-green-100">Trading Platform</p>
                    </div>
                </div>
                
                <!-- Status & Controls -->
                <div class="flex items-center space-x-4">
                    <div class="flex items-center bg-white/10 rounded-lg px-3 py-1">
                        <span id="status-dot" class="status-dot status-disconnected"></span>
                        <span id="status-text" class="text-sm font-medium">Disconnected</span>
                    </div>
                    <!-- Version Info -->
                    <div class="hidden sm:flex items-center bg-white/10 rounded-lg px-3 py-1 text-xs" title="Deployed Version">
                        <i class="fas fa-code-branch mr-2"></i>
                        <span id="version-info" class="font-mono">{{VERSION}}</span>
                    </div>
                    <button onclick="toggleTheme()" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                        <i id="theme-icon" class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Sidebar -->
            <div class="lg:col-span-1">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                    <!-- Sidebar Tabs -->
                    <div class="border-b border-gray-200 dark:border-gray-700">
                        <nav class="flex space-x-0">
                            <button onclick="switchSidebarTab('auth')" class="sidebar-tab flex-1 py-3 px-4 text-sm font-medium border-r border-gray-200 dark:border-gray-700 sidebar-tab-active" id="auth-tab">
                                <i class="fas fa-key mr-2"></i>Auth
                            </button>
                            <button onclick="switchSidebarTab('simulator')" class="sidebar-tab flex-1 py-3 px-4 text-sm font-medium border-r border-gray-200 dark:border-gray-700" id="simulator-tab">
                                <i class="fas fa-rocket mr-2"></i>Sim
                            </button>
                            <button onclick="switchSidebarTab('debug')" class="sidebar-tab flex-1 py-3 px-4 text-sm font-medium" id="debug-tab">
                                <i class="fas fa-bug mr-2"></i>Debug
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Auth Content -->
                    <div id="auth-content" class="p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Authentication</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Team Token</label>
                                <input type="text" id="token" placeholder="TK-XXXX" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Format: TK-XXXX</p>
                            </div>
                            
                            <div class="flex space-x-2">
                                <button onclick="toggleConnection()" id="connect-btn" 
                                        class="flex-1 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                    <i class="fas fa-plug mr-2"></i>Connect
                                </button>
                                <button onclick="login()" id="login-btn" disabled
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                                </button>
                            </div>
                        </div>
                        
                        <!-- Team Info -->
                        <div id="team-info" class="mt-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg" style="display: none;">
                            <div id="team-details" class="text-sm text-green-800 dark:text-green-200"></div>
                        </div>
                        
                        <!-- Inventory -->
                        <div class="mt-6">
                            <h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3">Inventory</h4>
                            <div id="inventory-grid" class="grid grid-cols-2 gap-2">
                                <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-center">
                                    <div class="text-sm text-gray-500 dark:text-gray-400">No data</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Simulator Content -->
                    <div id="simulator-content" class="p-6" style="display: none;">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Market Simulator</h3>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Type</label>
                                    <select id="sim-side" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                                        <option value="BUY">ðŸŸ¢ Buy</option>
                                        <option value="SELL">ðŸ”´ Sell</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Product</label>
                                    <select id="sim-product" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                                        <option value="FOSFO">FOSFO</option>
                                        <option value="PITA">PITA</option>
                                        <option value="PALTA-OIL">PALTA-OIL</option>
                                        <option value="GUACA">GUACA</option>
                                        <option value="SEBO">SEBO</option>
                                        <option value="H-GUACA">H-GUACA</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Quantity</label>
                                    <input type="number" id="sim-qty" placeholder="10" min="1" 
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Price</label>
                                    <input type="number" id="sim-price" placeholder="15.50" step="0.01" 
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                                </div>
                            </div>
                            
                            <button onclick="createMarketOrder()" id="create-order-btn" disabled
                                    class="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                <i class="fas fa-chart-line mr-2"></i>Create Market Order
                            </button>
                            
                            <div class="mt-4">
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 mb-2">
                                    <div class="text-xs text-yellow-800 dark:text-yellow-200">
                                        <strong>ðŸ’¡ Auto Market Maker:</strong> Automatically creates random buy/sell orders every 3 seconds to simulate market activity. Buy orders will appear in your Offers tab for testing.
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="toggleAutoMarketMaker()" id="auto-mm-btn" disabled
                                            class="bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                                        <i class="fas fa-robot mr-1"></i>Auto MM
                                    </button>
                                    <button onclick="clearAllOrders()" id="clear-all-btn" disabled
                                            class="bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                                        <i class="fas fa-trash mr-1"></i>Clear All
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Debug Content -->
                    <div id="debug-content" class="p-6" style="display: none;">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Debug Tools</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Error Injection</h4>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="injectError('INSUFFICIENT_BALANCE')" id="err-balance-btn" disabled
                                            class="bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Balance
                                    </button>
                                    <button onclick="injectError('UNAUTHORIZED_PRODUCT')" id="err-product-btn" disabled
                                            class="bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Product
                                    </button>
                                    <button onclick="injectError('DISCONNECT_CLIENT')" id="err-disconnect-btn" disabled
                                            class="bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Disconnect
                                    </button>
                                    <button onclick="injectError('OFFER_EXPIRED')" id="err-expire-btn" disabled
                                            class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Expire
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Production Test</h4>
                                <div class="space-y-2">
                                    <select id="prod-product" class="w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm dark:bg-gray-700 dark:text-white">
                                        <option value="FOSFO">FOSFO</option>
                                        <option value="PITA">PITA</option>
                                        <option value="PALTA-OIL">PALTA-OIL</option>
                                        <option value="GUACA">GUACA</option>
                                        <option value="SEBO">SEBO</option>
                                        <option value="H-GUACA">H-GUACA</option>
                                    </select>
                                    <input type="number" id="prod-qty" placeholder="Quantity" min="1" 
                                           class="w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm dark:bg-gray-700 dark:text-white">
                                    <button onclick="testProduction()" id="prod-btn" disabled
                                            class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-sm transition-colors">
                                        Test Production
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tools</h4>
                                <div class="grid grid-cols-2 gap-1">
                                    <button onclick="sendPing()" id="ping-btn" disabled
                                            class="bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Ping
                                    </button>
                                    <button onclick="requestResync()" id="resync-btn" disabled
                                            class="bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Resync
                                    </button>
                                    <button onclick="requestAllOrders()" id="all-orders-btn" disabled
                                            class="bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Orders
                                    </button>
                                    <button onclick="requestConnectedSessions()" id="sessions-btn" disabled
                                            class="bg-teal-600 hover:bg-teal-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Sessions
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Performance</h4>
                                <div class="grid grid-cols-1 gap-1">
                                    <button onclick="requestTeamPerformanceReport()" id="team-perf-btn" disabled
                                            class="bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        My Performance
                                    </button>
                                    <button onclick="requestGlobalPerformanceReport()" id="global-perf-btn" disabled
                                            class="bg-amber-600 hover:bg-amber-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Global Report
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Testing</h4>
                                <div class="grid grid-cols-1 gap-1">
                                    <button onclick="addTestTransaction()" 
                                            class="bg-pink-600 hover:bg-pink-700 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Test Transaction
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="lg:col-span-3">
                <!-- Main Tabs -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="border-b border-gray-200 dark:border-gray-700">
                        <nav class="flex space-x-0 overflow-x-auto">
                            <button onclick="switchMainTab('dashboard')" class="main-tab px-6 py-3 text-sm font-medium border-r border-gray-200 dark:border-gray-700 tab-active whitespace-nowrap" id="dashboard-tab">
                                <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                            </button>
                            <button onclick="switchMainTab('trading')" class="main-tab px-6 py-3 text-sm font-medium border-r border-gray-200 dark:border-gray-700 whitespace-nowrap" id="trading-tab">
                                <i class="fas fa-exchange-alt mr-2"></i>Trading
                            </button>
                            <button onclick="switchMainTab('ticker')" class="main-tab px-6 py-3 text-sm font-medium border-r border-gray-200 dark:border-gray-700 whitespace-nowrap" id="ticker-tab">
                                <i class="fas fa-chart-area mr-2"></i>Ticker
                            </button>
                            <button onclick="switchMainTab('orderbook')" class="main-tab px-6 py-3 text-sm font-medium border-r border-gray-200 dark:border-gray-700 whitespace-nowrap" id="orderbook-tab">
                                <i class="fas fa-list-alt mr-2"></i>Order Book
                            </button>
                            <button onclick="switchMainTab('transactions')" class="main-tab px-6 py-3 text-sm font-medium border-r border-gray-200 dark:border-gray-700 whitespace-nowrap" id="transactions-tab">
                                <i class="fas fa-history mr-2"></i>History
                            </button>
                            <button onclick="switchMainTab('sdk-emulator')" class="main-tab px-6 py-3 text-sm font-medium border-r border-gray-200 dark:border-gray-700 whitespace-nowrap" id="sdk-emulator-tab">
                                <i class="fas fa-code mr-2"></i>SDK Emulator
                            </button>
                            <button onclick="switchMainTab('docs')" class="main-tab px-6 py-3 text-sm font-medium whitespace-nowrap" id="docs-tab">
                                <i class="fas fa-book mr-2"></i>Docs
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div id="dashboard-content" class="p-6">
                        <!-- Stats Cards -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-4 text-white card-hover">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100 text-sm">Balance</p>
                                        <p class="text-2xl font-bold" id="dashboard-balance">$--</p>
                                    </div>
                                    <div class="bg-white/20 rounded-lg p-3">
                                        <i class="fas fa-wallet text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-4 text-white card-hover">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm">P&L</p>
                                        <p class="text-2xl font-bold" id="dashboard-profit">$--</p>
                                    </div>
                                    <div class="bg-white/20 rounded-lg p-3">
                                        <i class="fas fa-chart-line text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-4 text-white card-hover">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-purple-100 text-sm">Active Orders</p>
                                        <p class="text-2xl font-bold" id="dashboard-orders">--</p>
                                    </div>
                                    <div class="bg-white/20 rounded-lg p-3">
                                        <i class="fas fa-list text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg p-4 text-white card-hover">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-orange-100 text-sm">Fills</p>
                                        <p class="text-2xl font-bold" id="dashboard-fills">--</p>
                                    </div>
                                    <div class="bg-white/20 rounded-lg p-3">
                                        <i class="fas fa-check-circle text-xl"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Market Activity -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-line mr-2 text-primary-600"></i>Market Activity
                            </h3>
                            <div id="market-activity" class="space-y-3">
                                <div class="flex items-center justify-center py-8 text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    Connect to see real-time market activity
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trading Content -->
                    <div id="trading-content" class="p-6" style="display: none;">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Order Form -->
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                    <i class="fas fa-plus-circle mr-2 text-primary-600"></i>New Order
                                </h3>
                                
                                <div class="space-y-4">
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Side</label>
                                            <select id="side" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-600 dark:text-white">
                                                <option value="BUY">ðŸŸ¢ Buy</option>
                                                <option value="SELL">ðŸ”´ Sell</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Type</label>
                                            <select id="mode" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-600 dark:text-white">
                                                <option value="MARKET">Market</option>
                                                <option value="LIMIT">Limit</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Product</label>
                                        <select id="product" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-600 dark:text-white">
                                            <option value="FOSFO">FOSFO</option>
                                            <option value="PITA">PITA</option>
                                            <option value="PALTA-OIL">PALTA-OIL</option>
                                            <option value="GUACA">GUACA</option>
                                            <option value="SEBO">SEBO</option>
                                            <option value="H-GUACA">H-GUACA</option>
                                        </select>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Quantity</label>
                                            <input type="number" id="qty" placeholder="10" min="1" 
                                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-600 dark:text-white">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Price</label>
                                            <input type="number" id="price" placeholder="15.50" step="0.01" 
                                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-600 dark:text-white">
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Message (optional)</label>
                                        <textarea id="message" placeholder="Optional message" rows="2" 
                                                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-600 dark:text-white"></textarea>
                                    </div>
                                    
                                    <!-- Auto Accept Toggle -->
                                    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" id="auto-accept-toggle" class="w-4 h-4 text-yellow-600 rounded focus:ring-yellow-500">
                                            <span class="ml-2 text-sm font-medium text-yellow-800 dark:text-yellow-200">
                                                <i class="fas fa-bolt mr-1"></i>Auto-Accept (instant fill for testing)
                                            </span>
                                        </label>
                                        <p class="text-xs text-yellow-700 dark:text-yellow-300 mt-1 ml-6">
                                            When enabled, orders are automatically matched by the server (debug mode)
                                        </p>
                                    </div>
                                    
                                    <button onclick="placeOrder()" id="place-order-btn" disabled
                                            class="w-full bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                                        <i class="fas fa-paper-plane mr-2"></i>Place Order
                                    </button>
                                    
                                    <!-- Quick Actions -->
                                    <div class="grid grid-cols-2 gap-2 pt-2">
                                        <button onclick="quickTrade('BUY', 'FOSFO', 5)" id="quick-buy-fosfo" disabled
                                                class="bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                            Quick Buy FOSFO
                                        </button>
                                        <button onclick="quickTrade('SELL', 'FOSFO', 5)" id="quick-sell-fosfo" disabled
                                                class="bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                            Quick Sell FOSFO
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Orders & Messages -->
                            <div>
                                <div class="flex border-b border-gray-200 dark:border-gray-600 mb-4">
                                    <button onclick="switchTradingTab('orders')" class="trading-tab px-4 py-2 text-sm font-medium tab-active" id="trading-orders-tab">
                                        <i class="fas fa-list mr-2"></i>My Orders
                                    </button>
                                    <button onclick="switchTradingTab('offers')" class="trading-tab px-4 py-2 text-sm font-medium" id="trading-offers-tab">
                                        <i class="fas fa-handshake mr-2"></i>Offers <span id="offer-count" class="bg-red-500 text-white text-xs rounded-full px-2 ml-1" style="display: none;">0</span>
                                    </button>
                                    <button onclick="switchTradingTab('messages')" class="trading-tab px-4 py-2 text-sm font-medium" id="trading-messages-tab">
                                        <i class="fas fa-comments mr-2"></i>Messages
                                    </button>
                                </div>
                                
                                <!-- Orders Tab -->
                                <div id="trading-orders-content">
                                    <div class="flex space-x-2 mb-4">
                                        <button onclick="refreshMyOrders()" id="refresh-orders-btn" disabled
                                                class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                            <i class="fas fa-sync mr-1"></i>Refresh
                                        </button>
                                        <button onclick="cancelAutoMMOrders()" id="cancel-mm-btn" disabled
                                                class="bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                            <i class="fas fa-robot mr-1"></i>Cancel MM Orders
                                        </button>
                                        <button onclick="cancelAllOrders()" id="cancel-all-btn" disabled
                                                class="bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                            <i class="fas fa-times mr-1"></i>Cancel All
                                        </button>
                                    </div>
                                    
                                    <div id="my-orders-list" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 h-80 overflow-y-auto">
                                        <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
                                            <i class="fas fa-info-circle mr-2"></i>No active orders
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Offers Tab -->
                                <div id="trading-offers-content" style="display: none;">
                                    <div class="mb-4">
                                        <h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-2">
                                            <i class="fas fa-bell mr-2 text-yellow-500"></i>Incoming Offers
                                        </h4>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">
                                            Teams with your products will send you buy offers. Accept to sell immediately.
                                        </p>
                                    </div>
                                    
                                    <div id="offers-list" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 h-80 overflow-y-auto space-y-3">
                                        <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
                                            <i class="fas fa-info-circle mr-2"></i>No pending offers
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Messages Tab -->
                                <div id="trading-messages-content" style="display: none;">
                                    <div class="flex justify-between items-center mb-4">
                                        <h4 class="text-sm font-semibold text-gray-900 dark:text-white">System Messages</h4>
                                        <button onclick="clearMessages()" 
                                                class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                            <i class="fas fa-trash mr-1"></i>Clear
                                        </button>
                                    </div>
                                    
                                    <div id="message-list" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 h-80 overflow-y-auto font-mono text-sm">
                                        <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
                                            <i class="fas fa-info-circle mr-2"></i>No system messages
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ticker Content -->
                    <div id="ticker-content" class="p-6" style="display: none;">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-chart-area mr-2 text-primary-600"></i>Live Market Ticker
                        </h3>
                        <div id="ticker-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                                <div class="flex items-center text-yellow-800 dark:text-yellow-200">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>No market data available
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Book Content -->
                    <div id="orderbook-content" class="p-6" style="display: none;">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                <i class="fas fa-list-alt mr-2 text-primary-600"></i>Order Book
                            </h3>
                            <select id="product-selector" onchange="updateOrderBook()" 
                                    class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                                <option value="">Select Product</option>
                                <option value="FOSFO">FOSFO</option>
                                <option value="PITA">PITA</option>
                                <option value="PALTA-OIL">PALTA-OIL</option>
                                <option value="GUACA">GUACA</option>
                                <option value="SEBO">SEBO</option>
                                <option value="H-GUACA">H-GUACA</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <!-- Buy Orders -->
                            <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                                <h4 class="text-green-800 dark:text-green-200 font-semibold mb-3">
                                    <i class="fas fa-arrow-up mr-2"></i>Buy Orders
                                </h4>
                                <div id="buy-orders" class="space-y-2 h-64 overflow-y-auto">
                                    <div class="text-green-600 dark:text-green-400 text-sm">Select a product</div>
                                </div>
                            </div>
                            
                            <!-- Sell Orders -->
                            <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                                <h4 class="text-red-800 dark:text-red-200 font-semibold mb-3">
                                    <i class="fas fa-arrow-down mr-2"></i>Sell Orders
                                </h4>
                                <div id="sell-orders" class="space-y-2 h-64 overflow-y-auto">
                                    <div class="text-red-600 dark:text-red-400 text-sm">Select a product</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- All Orders -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                            <h4 class="text-gray-900 dark:text-white font-semibold mb-3">
                                <i class="fas fa-list mr-2"></i>All Orders
                            </h4>
                            <div id="all-orders-list" class="h-40 overflow-y-auto">
                                <div class="text-gray-500 dark:text-gray-400 text-sm">
                                    <i class="fas fa-info-circle mr-2"></i>No orders available
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Transactions Content -->
                    <div id="transactions-content" class="p-6" style="display: none;">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-history mr-2 text-primary-600"></i>Transaction History
                        </h3>
                        
                        <!-- Info Box -->
                        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                            <div class="flex items-start">
                                <i class="fas fa-info-circle text-blue-600 dark:text-blue-400 mr-3 mt-1"></i>
                                <div class="text-sm text-blue-800 dark:text-blue-200">
                                    <strong>How transactions work:</strong>
                                    <ul class="mt-2 space-y-1 ml-4 list-disc">
                                        <li><strong>Place Order:</strong> Your order is sent to the market (appears in "Pending Orders" below)</li>
                                        <li><strong>Wait for Match:</strong> The order sits in the order book until matched with a counterparty</li>
                                        <li><strong>Get Filled:</strong> When matched, you receive a FILL message and the transaction appears in "Completed Transactions"</li>
                                    </ul>
                                    <p class="mt-2"><em>ðŸ’¡ Tip: Enable "Auto-Accept" in Trading tab for instant fills!</em></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pending Orders -->
                        <div class="mb-4">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-md font-semibold text-gray-900 dark:text-white flex items-center">
                                    <i class="fas fa-clock mr-2 text-yellow-600"></i>
                                    Pending Orders
                                    <span id="pending-count" class="ml-2 bg-yellow-500 text-white text-xs rounded-full px-2 py-0.5">0</span>
                                </h4>
                                <button onclick="clearPendingOrders()" class="text-xs bg-gray-600 hover:bg-gray-700 text-white px-2 py-1 rounded transition-colors">
                                    <i class="fas fa-trash mr-1"></i>Clear
                                </button>
                            </div>
                            <div id="pending-orders-list" class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 max-h-48 overflow-y-auto">
                                <div class="text-sm text-yellow-700 dark:text-yellow-300 text-center py-2">
                                    <i class="fas fa-info-circle mr-2"></i>No pending orders
                                </div>
                            </div>
                        </div>
                        
                        <!-- Completed Transactions -->
                        <div>
                            <h4 class="text-md font-semibold text-gray-900 dark:text-white mb-2 flex items-center">
                                <i class="fas fa-check-circle mr-2 text-green-600"></i>
                                Completed Transactions
                            </h4>
                            <div id="transactions-list" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 h-64 overflow-y-auto">
                                <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-info-circle mr-2"></i>No transactions yet
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SDK Emulator Content -->
                    <div id="sdk-emulator-content" class="p-6" style="display: none;">
                        <div class="mb-6">
                            <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                                <i class="fas fa-code mr-2 text-blue-600"></i>Java SDK Event Emulator
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                Test all Java SDK EventListener callbacks by emulating server messages. Perfect for debugging your Java trading bots!
                            </p>
                        </div>

                        <!-- Info Box -->
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-2 border-blue-300 dark:border-blue-700 rounded-lg p-4 mb-6">
                            <div class="flex items-start">
                                <i class="fas fa-lightbulb text-blue-600 dark:text-blue-400 mr-3 mt-1 text-2xl"></i>
                                <div class="text-sm text-blue-800 dark:text-blue-200">
                                    <strong class="text-lg">ðŸ’¡ Quick Setup:</strong>
                                    <ol class="mt-2 ml-4 space-y-2 list-decimal">
                                        <li><strong>Connect your Java SDK client</strong> using the same token you're using in this web UI</li>
                                        <li><strong>Both sessions will share the same team name</strong> (shown below)</li>
                                        <li><strong>Click any button below</strong> to send events to your Java client's EventListener callbacks</li>
                                        <li><strong>Watch your Java console</strong> to see the callbacks being triggered!</li>
                                    </ol>
                                    <div class="mt-3 p-2 bg-blue-100 dark:bg-blue-800/40 rounded border border-blue-300 dark:border-blue-600">
                                        <strong>Example:</strong> If you're logged in as <code class="bg-white dark:bg-gray-700 px-1 rounded">TEAM-BOT-01</code>, your Java SDK should also connect as <code class="bg-white dark:bg-gray-700 px-1 rounded">TEAM-BOT-01</code> using the same token.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Target Team Configuration -->
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-2 border-green-400 dark:border-green-600 rounded-lg p-4 mb-6">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-md font-semibold text-green-900 dark:text-green-200">
                                    <i class="fas fa-check-circle mr-2"></i>Your Team (Ready to Test)
                                </h4>
                                <span class="text-xs bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200 px-2 py-1 rounded-full font-semibold">
                                    Same Token = Same Team
                                </span>
                            </div>
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        <i class="fas fa-user-friends mr-1"></i>Target Team Name (Events will be sent here)
                                    </label>
                                    <div class="relative">
                                        <input type="text" id="sdk-target-team" placeholder="Will auto-fill when you login" 
                                               class="w-full px-3 py-2 pr-10 border-2 border-green-400 dark:border-green-600 rounded-lg dark:bg-gray-700 dark:text-white font-mono font-bold text-green-700 dark:text-green-300"
                                               value="" readonly>
                                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                            <i class="fas fa-lock text-green-600 dark:text-green-400"></i>
                                        </div>
                                    </div>
                                    <div class="mt-2 p-3 bg-green-100 dark:bg-green-900/40 rounded-lg border border-green-300 dark:border-green-700">
                                        <p class="text-xs text-green-800 dark:text-green-200 flex items-start">
                                            <i class="fas fa-info-circle mr-2 mt-0.5"></i>
                                            <span>
                                                <strong>How it works:</strong> Since you're using the same token in both the web UI and your Java SDK client, 
                                                they both connect as the same team. Events sent from here will be received by your Java client running 
                                                with this team name. No need to change anything!
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Grid of Event Emulators -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- onOffer Event -->
                            <div class="bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 border-2 border-yellow-400 dark:border-yellow-600 rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200 mb-3">
                                    <i class="fas fa-handshake mr-2"></i>onOffer(OfferMessage)
                                </h4>
                                <p class="text-xs text-yellow-700 dark:text-yellow-300 mb-4">
                                    Creates a sandbox buy order from a fictitious buyer team. The offer is sent to your team for testing.
                                </p>
                                
                                <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded p-2 mb-3 text-xs text-yellow-800 dark:text-yellow-200">
                                    <strong>ðŸŽ¯ Debug Mode Sandbox:</strong> 
                                    <ul class="list-disc ml-4 mt-1">
                                        <li><strong>Buyer Team can be fake</strong> (e.g., "FAKE-BUYER-01") - no validation!</li>
                                        <li><strong>You need inventory</strong> of the product to accept the offer</li>
                                        <li>Offer appears in Java SDK (onOffer callback) and web UI</li>
                                        <li>Accept it to complete a REAL trade (updates your balance/inventory)</li>
                                        <li><strong>Only works when debug mode is enabled</strong></li>
                                    </ul>
                                </div>
                                
                                <div class="space-y-3">
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Buyer Team (can be fake!)</label>
                                            <input type="text" id="sdk-offer-buyer" value="TEAM-BOT-01" 
                                                   class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white font-mono"
                                                   placeholder="e.g., FAKE-BUYER-01">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Product</label>
                                            <select id="sdk-offer-product" class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                                <option value="FOSFO">FOSFO</option>
                                                <option value="PITA">PITA</option>
                                                <option value="PALTA-OIL">PALTA-OIL</option>
                                                <option value="GUACA">GUACA</option>
                                                <option value="SEBO">SEBO</option>
                                                <option value="H-GUACA">H-GUACA</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Quantity</label>
                                            <input type="number" id="sdk-offer-qty" value="10" min="1" 
                                                   class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Max Price</label>
                                            <input type="number" id="sdk-offer-price" value="25.00" step="0.01" 
                                                   class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Expires In (ms)</label>
                                        <input type="number" id="sdk-offer-expires" value="30000" min="1000" step="1000" 
                                               class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <button onclick="emulateOffer()" id="sdk-offer-btn" disabled
                                            class="w-full bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                                        <i class="fas fa-paper-plane mr-1"></i>Send OFFER to Client
                                    </button>
                                </div>
                            </div>

                            <!-- onFill Event -->
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-2 border-green-400 dark:border-green-600 rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-green-800 dark:text-green-200 mb-3">
                                    <i class="fas fa-check-circle mr-2"></i>onFill(FillMessage)
                                </h4>
                                <p class="text-xs text-green-700 dark:text-green-300 mb-4">
                                    Simulate an order fill/execution
                                </p>
                                
                                <div class="space-y-3">
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Side</label>
                                            <select id="sdk-fill-side" class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                                <option value="BUY">BUY</option>
                                                <option value="SELL">SELL</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Product</label>
                                            <select id="sdk-fill-product" class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                                <option value="FOSFO">FOSFO</option>
                                                <option value="PITA">PITA</option>
                                                <option value="PALTA-OIL">PALTA-OIL</option>
                                                <option value="GUACA">GUACA</option>
                                                <option value="SEBO">SEBO</option>
                                                <option value="H-GUACA">H-GUACA</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Quantity</label>
                                            <input type="number" id="sdk-fill-qty" value="5" min="1" 
                                                   class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Fill Price</label>
                                            <input type="number" id="sdk-fill-price" value="20.50" step="0.01" 
                                                   class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Counterparty</label>
                                        <input type="text" id="sdk-fill-counterparty" value="MARKET-MAKER" 
                                               class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <button onclick="emulateFill()" id="sdk-fill-btn" disabled
                                            class="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                                        <i class="fas fa-paper-plane mr-1"></i>Send FILL to Client
                                    </button>
                                </div>
                            </div>

                            <!-- onError Event -->
                            <div class="bg-gradient-to-br from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 border-2 border-red-400 dark:border-red-600 rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-red-800 dark:text-red-200 mb-3">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>onError(ErrorMessage)
                                </h4>
                                <p class="text-xs text-red-700 dark:text-red-300 mb-4">
                                    Simulate error messages from the server
                                </p>
                                
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Error Code</label>
                                        <select id="sdk-error-code" class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                            <option value="INSUFFICIENT_BALANCE">INSUFFICIENT_BALANCE</option>
                                            <option value="UNAUTHORIZED_PRODUCT">UNAUTHORIZED_PRODUCT</option>
                                            <option value="INVALID_ORDER">INVALID_ORDER</option>
                                            <option value="OFFER_EXPIRED">OFFER_EXPIRED</option>
                                            <option value="AUTH_FAILED">AUTH_FAILED</option>
                                            <option value="RATE_LIMIT_EXCEEDED">RATE_LIMIT_EXCEEDED</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Error Message</label>
                                        <textarea id="sdk-error-message" rows="2" 
                                                  class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white"
                                                  placeholder="Detailed error description">Insufficient balance to place this order</textarea>
                                    </div>
                                    <button onclick="emulateError()" id="sdk-error-btn" disabled
                                            class="w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                                        <i class="fas fa-paper-plane mr-1"></i>Send ERROR to Client
                                    </button>
                                </div>
                            </div>

                            <!-- onInventoryUpdate Event -->
                            <div class="bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 border-2 border-purple-400 dark:border-purple-600 rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-purple-800 dark:text-purple-200 mb-3">
                                    <i class="fas fa-boxes mr-2"></i>onInventoryUpdate(InventoryUpdateMessage)
                                </h4>
                                <p class="text-xs text-purple-700 dark:text-purple-300 mb-4">
                                    Simulate inventory changes
                                </p>
                                
                                <div class="space-y-3">
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Product</label>
                                            <select id="sdk-inv-product" class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                                <option value="FOSFO">FOSFO</option>
                                                <option value="PITA">PITA</option>
                                                <option value="PALTA-OIL">PALTA-OIL</option>
                                                <option value="GUACA">GUACA</option>
                                                <option value="SEBO">SEBO</option>
                                                <option value="H-GUACA">H-GUACA</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">New Quantity</label>
                                            <input type="number" id="sdk-inv-qty" value="100" min="0" 
                                                   class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                        </div>
                                    </div>
                                    <div class="bg-purple-100 dark:bg-purple-900/30 rounded p-2 text-xs text-purple-800 dark:text-purple-200">
                                        <strong>Tip:</strong> You can send full inventory updates with all products by entering JSON in the format: {"FOSFO": 50, "PITA": 30}
                                    </div>
                                    <button onclick="emulateInventoryUpdate()" id="sdk-inv-btn" disabled
                                            class="w-full bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                                        <i class="fas fa-paper-plane mr-1"></i>Send INVENTORY_UPDATE to Client
                                    </button>
                                </div>
                            </div>

                            <!-- onBalanceUpdate Event -->
                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 border-2 border-blue-400 dark:border-blue-600 rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-3">
                                    <i class="fas fa-dollar-sign mr-2"></i>onBalanceUpdate(BalanceUpdateMessage)
                                </h4>
                                <p class="text-xs text-blue-700 dark:text-blue-300 mb-4">
                                    Simulate balance changes
                                </p>
                                
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">New Balance</label>
                                        <input type="number" id="sdk-balance-amount" value="10000.00" step="0.01" 
                                               class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Reason (optional)</label>
                                        <input type="text" id="sdk-balance-reason" value="Trade execution" placeholder="e.g., Trade execution, Deposit, etc." 
                                               class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <button onclick="emulateBalanceUpdate()" id="sdk-balance-btn" disabled
                                            class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                                        <i class="fas fa-paper-plane mr-1"></i>Send BALANCE_UPDATE to Client
                                    </button>
                                </div>
                            </div>

                            <!-- onBroadcast Event -->
                            <div class="bg-gradient-to-br from-indigo-50 to-violet-50 dark:from-indigo-900/20 dark:to-violet-900/20 border-2 border-indigo-400 dark:border-indigo-600 rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-indigo-800 dark:text-indigo-200 mb-3">
                                    <i class="fas fa-bullhorn mr-2"></i>onBroadcast(BroadcastNotificationMessage)
                                </h4>
                                <p class="text-xs text-indigo-700 dark:text-indigo-300 mb-4">
                                    Simulate broadcast messages to all clients
                                </p>
                                
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Sender</label>
                                        <input type="text" id="sdk-broadcast-sender" value="SYSTEM" 
                                               class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Message</label>
                                        <textarea id="sdk-broadcast-message" rows="2" 
                                                  class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white"
                                                  placeholder="Broadcast message">Market will close in 5 minutes!</textarea>
                                    </div>
                                    <button onclick="emulateBroadcast()" id="sdk-broadcast-btn" disabled
                                            class="w-full bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                                        <i class="fas fa-paper-plane mr-1"></i>Send BROADCAST to Client
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Events -->
                        <div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-4">
                            <!-- onOrderAck -->
                            <div class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg p-4">
                                <h5 class="text-sm font-semibold text-gray-800 dark:text-gray-200 mb-2">
                                    <i class="fas fa-check mr-1"></i>onOrderAck
                                </h5>
                                <div class="space-y-2">
                                    <input type="text" id="sdk-ack-orderid" placeholder="Order ID" 
                                           class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                    <select id="sdk-ack-status" class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                        <option value="ACCEPTED">ACCEPTED</option>
                                        <option value="REJECTED">REJECTED</option>
                                        <option value="CANCELLED">CANCELLED</option>
                                    </select>
                                    <button onclick="emulateOrderAck()" id="sdk-ack-btn" disabled
                                            class="w-full bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Send ORDER_ACK
                                    </button>
                                </div>
                            </div>

                            <!-- onTicker -->
                            <div class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg p-4">
                                <h5 class="text-sm font-semibold text-gray-800 dark:text-gray-200 mb-2">
                                    <i class="fas fa-chart-line mr-1"></i>onTicker
                                </h5>
                                <div class="space-y-2">
                                    <select id="sdk-ticker-product" class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                        <option value="FOSFO">FOSFO</option>
                                        <option value="PITA">PITA</option>
                                        <option value="PALTA-OIL">PALTA-OIL</option>
                                        <option value="GUACA">GUACA</option>
                                        <option value="SEBO">SEBO</option>
                                        <option value="H-GUACA">H-GUACA</option>
                                    </select>
                                    <input type="number" id="sdk-ticker-price" placeholder="Price" value="15.50" step="0.01"
                                           class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                    <button onclick="emulateTicker()" id="sdk-ticker-btn" disabled
                                            class="w-full bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Send TICKER
                                    </button>
                                </div>
                            </div>

                            <!-- onEventDelta -->
                            <div class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg p-4">
                                <h5 class="text-sm font-semibold text-gray-800 dark:text-gray-200 mb-2">
                                    <i class="fas fa-sync mr-1"></i>onEventDelta
                                </h5>
                                <div class="space-y-2">
                                    <input type="number" id="sdk-delta-count" placeholder="Event count" value="5" min="0"
                                           class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Sends resync response</div>
                                    <button onclick="emulateEventDelta()" id="sdk-delta-btn" disabled
                                            class="w-full bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs transition-colors">
                                        Send EVENT_DELTA
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Event Log -->
                        <div class="mt-6">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">
                                    <i class="fas fa-stream mr-2"></i>Emulation Log
                                </h4>
                                <button onclick="clearEmulationLog()" class="text-xs bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded transition-colors">
                                    <i class="fas fa-trash mr-1"></i>Clear
                                </button>
                            </div>
                            <div id="sdk-emulation-log" class="bg-gray-900 text-green-400 font-mono text-xs p-4 rounded-lg h-48 overflow-y-auto">
                                <div class="text-gray-500">Ready to emulate SDK events... Connect to server first!</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Documentation Content -->
                    <div id="docs-content" class="p-6" style="display: none;">
                        <div class="max-w-4xl mx-auto">
                            <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                                <i class="fas fa-book mr-3 text-primary-600"></i>ðŸ“š DocumentaciÃ³n de la Plataforma
                            </h3>
                            
                            <!-- Quick Start Guide -->
                            <div class="bg-gradient-to-r from-primary-50 to-green-50 dark:from-primary-900/20 dark:to-green-900/20 border border-primary-200 dark:border-primary-800 rounded-xl p-6 mb-8">
                                <h4 class="text-xl font-semibold text-primary-800 dark:text-primary-200 mb-4">
                                    ðŸš€ GuÃ­a de Inicio RÃ¡pido
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="space-y-3">
                                        <div class="flex items-start space-x-3">
                                            <div class="bg-primary-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">1</div>
                                            <div>
                                                <h5 class="font-semibold text-gray-900 dark:text-white">Conectar al Servidor</h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-300">Haz clic en "Conectar" en la pestaÃ±a de AutenticaciÃ³n para establecer conexiÃ³n</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start space-x-3">
                                            <div class="bg-primary-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">2</div>
                                            <div>
                                                <h5 class="font-semibold text-gray-900 dark:text-white">Autenticarse</h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-300">Ingresa tu token de equipo (formato: TK-XXXX) y haz clic en "Login"</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="flex items-start space-x-3">
                                            <div class="bg-primary-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">3</div>
                                            <div>
                                                <h5 class="font-semibold text-gray-900 dark:text-white">Verificar Estado</h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-300">Confirma que tu inventario y balance aparezcan correctamente</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start space-x-3">
                                            <div class="bg-primary-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">4</div>
                                            <div>
                                                <h5 class="font-semibold text-gray-900 dark:text-white">Comenzar a Operar</h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-300">Usa las pestaÃ±as Trading o Simulador para realizar Ã³rdenes</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Simulator vs Trading Comparison -->
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-6 mb-8">
                                <h4 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-balance-scale mr-2 text-blue-600"></i>âš–ï¸ Simulador vs Trading Real
                                </h4>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <!-- Simulator -->
                                    <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                                        <h5 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-3">
                                            <i class="fas fa-rocket mr-2"></i>ðŸŽ¯ Simulador de Mercado
                                        </h5>
                                        <div class="space-y-3">
                                            <div>
                                                <h6 class="font-medium text-blue-900 dark:text-blue-100">PropÃ³sito:</h6>
                                                <p class="text-sm text-blue-700 dark:text-blue-300">Crear Ã³rdenes de prueba y simular condiciones de mercado sin riesgo real</p>
                                            </div>
                                            <div>
                                                <h6 class="font-medium text-blue-900 dark:text-blue-100">CaracterÃ­sticas:</h6>
                                                <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-1">
                                                    <li>â€¢ Solo Ã³rdenes LIMIT con precio fijo</li>
                                                    <li>â€¢ Auto Market Maker (crea Ã³rdenes cada 3s)</li>
                                                    <li>â€¢ Limpieza masiva de Ã³rdenes simuladas</li>
                                                    <li>â€¢ Control de precios de mercado</li>
                                                    <li>â€¢ Usa debugMode: AUTO_ACCEPT</li>
                                                </ul>
                                            </div>
                                            <div>
                                                <h6 class="font-medium text-blue-900 dark:text-blue-100">Ideal para:</h6>
                                                <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-1">
                                                    <li>â€¢ Probar estrategias de trading</li>
                                                    <li>â€¢ Crear liquidez artificial</li>
                                                    <li>â€¢ Entrenar nuevos usuarios</li>
                                                    <li>â€¢ Debugging de algoritmos</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Real Trading -->
                                    <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                                        <h5 class="text-lg font-semibold text-green-800 dark:text-green-200 mb-3">
                                            <i class="fas fa-chart-line mr-2"></i>ðŸ“ˆ Trading Real
                                        </h5>
                                        <div class="space-y-3">
                                            <div>
                                                <h6 class="font-medium text-green-900 dark:text-green-100">PropÃ³sito:</h6>
                                                <p class="text-sm text-green-700 dark:text-green-300">Realizar operaciones reales que afectan tu balance e inventario</p>
                                            </div>
                                            <div>
                                                <h6 class="font-medium text-green-900 dark:text-green-100">CaracterÃ­sticas:</h6>
                                                <ul class="text-sm text-green-700 dark:text-green-300 space-y-1">
                                                    <li>â€¢ Ã“rdenes MARKET y LIMIT</li>
                                                    <li>â€¢ Mensajes personalizados</li>
                                                    <li>â€¢ ValidaciÃ³n de fondos real</li>
                                                    <li>â€¢ EjecuciÃ³n inmediata</li>
                                                    <li>â€¢ Impacto directo en P&L</li>
                                                </ul>
                                            </div>
                                            <div>
                                                <h6 class="font-medium text-green-900 dark:text-green-100">Ideal para:</h6>
                                                <ul class="text-sm text-green-700 dark:text-green-300 space-y-1">
                                                    <li>â€¢ Operaciones de producciÃ³n</li>
                                                    <li>â€¢ Trading competitivo</li>
                                                    <li>â€¢ GeneraciÃ³n de ganancias reales</li>
                                                    <li>â€¢ Arbitraje de precios</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Main Features -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                <!-- Trading Features -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-6">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                        <i class="fas fa-chart-line mr-2 text-green-600"></i>CaracterÃ­sticas de Trading
                                    </h4>
                                    <div class="space-y-4">
                                        <div>
                                            <h5 class="font-medium text-gray-900 dark:text-white">ðŸŽ¯ Simulador</h5>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Crear Ã³rdenes de prueba, ajustar precios de mercado y usar Auto Market Maker</p>
                                        </div>
                                        <div>
                                            <h5 class="font-medium text-gray-900 dark:text-white">ðŸ“ˆ Trading en Vivo</h5>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Realizar Ã³rdenes de mercado y lÃ­mite con mensajes personalizados</p>
                                        </div>
                                        <div>
                                            <h5 class="font-medium text-gray-900 dark:text-white">ðŸ“Š Libro de Ã“rdenes</h5>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Ver Ã³rdenes de compra/venta en tiempo real por producto</p>
                                        </div>
                                        <div>
                                            <h5 class="font-medium text-gray-900 dark:text-white">ðŸ“‹ Historial</h5>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Rastrear todas las transacciones y ejecuciones de Ã³rdenes</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Debug Tools -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-6">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                        <i class="fas fa-bug mr-2 text-orange-600"></i>Herramientas de Debug
                                    </h4>
                                    <div class="space-y-4">
                                        <div>
                                            <h5 class="font-medium text-gray-900 dark:text-white">ðŸš¨ InyecciÃ³n de Errores</h5>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Simular errores de balance, productos no autorizados, desconexiones</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">â†’ Resultado visible en: NotificaciÃ³n toast + pestaÃ±a "Messages"</p>
                                        </div>
                                        <div>
                                            <h5 class="font-medium text-gray-900 dark:text-white">ðŸ­ Pruebas de ProducciÃ³n</h5>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Validar algoritmos de producciÃ³n y bonificaciones premium</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">â†’ Resultado visible en: Inventario (sidebar) + notificaciÃ³n toast</p>
                                        </div>
                                        <div>
                                            <h5 class="font-medium text-gray-900 dark:text-white">ðŸ”§ Utilidades</h5>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Ping, resincronizar datos, ver sesiones, consultar Ã³rdenes</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">â†’ Resultado visible en: Panel "Market Activity" en Dashboard</p>
                                        </div>
                                        <div>
                                            <h5 class="font-medium text-gray-900 dark:text-white">ðŸ“Š Reportes de Performance</h5>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Ver rendimiento de tu equipo y ranking global</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">â†’ Resultado visible en: Panel "Market Activity" en Dashboard</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Server Interactions Documentation -->
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-6 mb-8">
                                <h4 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-server mr-2 text-purple-600"></i>ðŸ–¥ï¸ Interacciones con el Servidor
                                </h4>
                                
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <div class="bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4">
                                        <h5 class="text-lg font-semibold text-purple-800 dark:text-purple-200 mb-3">
                                            <i class="fas fa-plug mr-2"></i>ConexiÃ³n WebSocket
                                        </h5>
                                        <ul class="text-sm text-purple-700 dark:text-purple-300 space-y-2">
                                            <li>â€¢ <strong>ConexiÃ³n persistente:</strong> Mantiene comunicaciÃ³n bidireccional en tiempo real</li>
                                            <li>â€¢ <strong>AutenticaciÃ³n:</strong> ValidaciÃ³n segura con tokens de equipo</li>
                                            <li>â€¢ <strong>Heartbeat:</strong> Ping automÃ¡tico para verificar conectividad</li>
                                            <li>â€¢ <strong>ReconexiÃ³n:</strong> Manejo automÃ¡tico de desconexiones</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800 rounded-lg p-4">
                                        <h5 class="text-lg font-semibold text-indigo-800 dark:text-indigo-200 mb-3">
                                            <i class="fas fa-exchange-alt mr-2"></i>Tipos de Mensajes
                                        </h5>
                                        <ul class="text-sm text-indigo-700 dark:text-indigo-300 space-y-2">
                                            <li>â€¢ <strong>ORDER:</strong> CreaciÃ³n de Ã³rdenes de compra/venta</li>
                                            <li>â€¢ <strong>CANCEL:</strong> CancelaciÃ³n de Ã³rdenes especÃ­ficas</li>
                                            <li>â€¢ <strong>PING:</strong> VerificaciÃ³n de conectividad</li>
                                            <li>â€¢ <strong>RESYNC:</strong> SincronizaciÃ³n completa de datos</li>
                                            <li>â€¢ <strong>PRODUCTION:</strong> SimulaciÃ³n de producciÃ³n</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
                                    <h5 class="font-semibold text-gray-900 dark:text-white mb-3">
                                        <i class="fas fa-code mr-2 text-gray-600"></i>Estructura de Mensajes JSON
                                    </h5>
                                    <div class="font-mono text-sm bg-gray-800 text-green-400 p-3 rounded">
{<br>
&nbsp;&nbsp;"type": "ORDER",<br>
&nbsp;&nbsp;"data": {<br>
&nbsp;&nbsp;&nbsp;&nbsp;"side": "BUY",<br>
&nbsp;&nbsp;&nbsp;&nbsp;"product": "FOSFO",<br>
&nbsp;&nbsp;&nbsp;&nbsp;"quantity": 10,<br>
&nbsp;&nbsp;&nbsp;&nbsp;"price": 15.50,<br>
&nbsp;&nbsp;&nbsp;&nbsp;"mode": "LIMIT"<br>
&nbsp;&nbsp;}<br>
}
                                    </div>
                                </div>
                                
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                                    <h5 class="font-semibold text-yellow-800 dark:text-yellow-200 mb-3">
                                        <i class="fas fa-flask mr-2"></i>Utilidad para Testing de Clientes
                                    </h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <h6 class="font-medium text-yellow-900 dark:text-yellow-100 mb-2">Casos de Prueba:</h6>
                                            <ul class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
                                                <li>â€¢ Validar manejo de errores de conexiÃ³n</li>
                                                <li>â€¢ Probar reconexiÃ³n automÃ¡tica</li>
                                                <li>â€¢ Verificar parseo de mensajes JSON</li>
                                                <li>â€¢ Testear timeout de Ã³rdenes</li>
                                                <li>â€¢ Simular pÃ©rdida de paquetes</li>
                                            </ul>
                                        </div>
                                        <div>
                                            <h6 class="font-medium text-yellow-900 dark:text-yellow-100 mb-2">Beneficios:</h6>
                                            <ul class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
                                                <li>â€¢ Debugging en tiempo real</li>
                                                <li>â€¢ ValidaciÃ³n de protocolos</li>
                                                <li>â€¢ SimulaciÃ³n de escenarios edge-case</li>
                                                <li>â€¢ Monitoreo de performance</li>
                                                <li>â€¢ Testing de load balancing</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Button Guide -->
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-6 mb-8">
                                <h4 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-mouse-pointer mr-2 text-indigo-600"></i>ðŸ–±ï¸ GuÃ­a de Botones y Acciones
                                </h4>
                                
                                <!-- Simulator Section -->
                                <div class="mb-6">
                                    <h5 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-3">
                                        <i class="fas fa-rocket mr-2"></i>PestaÃ±a Simulador
                                    </h5>
                                    <div class="space-y-3 ml-4">
                                        <div class="border-l-4 border-green-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Create Market Order</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Crea una orden LIMIT simulada con precio fijo</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: NotificaciÃ³n toast + pestaÃ±a "My Orders" + Market Activity</p>
                                        </div>
                                        <div class="border-l-4 border-yellow-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Auto MM</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Inicia/detiene el creador automÃ¡tico de Ã³rdenes (cada 3 segundos)</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: NotificaciÃ³n toast + pestaÃ±a "Messages" + My Orders se llenarÃ¡n automÃ¡ticamente</p>
                                        </div>
                                        <div class="border-l-4 border-red-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Clear All</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">âš ï¸ FunciÃ³n pendiente - El servidor aÃºn no soporta cancelaciÃ³n de Ã³rdenes</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">ðŸ“ VerÃ¡s un mensaje informativo por ahora</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Trading Section -->
                                <div class="mb-6">
                                    <h5 class="text-lg font-semibold text-green-800 dark:text-green-200 mb-3">
                                        <i class="fas fa-exchange-alt mr-2"></i>PestaÃ±a Trading
                                    </h5>
                                    <div class="space-y-3 ml-4">
                                        <div class="border-l-4 border-green-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Place Order</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">EnvÃ­a una orden real (MARKET o LIMIT) que afecta tu balance</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: Toast de confirmaciÃ³n + History tab "Pending Orders" + cuando se ejecute aparece en "Completed Transactions"</p>
                                        </div>
                                        <div class="border-l-4 border-yellow-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Auto-Accept Toggle</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Activa el modo auto-accept para que tus Ã³rdenes se ejecuten instantÃ¡neamente (ideal para testing)</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ Cuando estÃ¡ activado, las Ã³rdenes se ejecutan inmediatamente sin esperar match</p>
                                        </div>
                                        <div class="border-l-4 border-blue-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Refresh Orders</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Actualiza la lista de tus Ã³rdenes activas desde el servidor</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: Lista "My Orders" se actualiza + contador en Dashboard</p>
                                        </div>
                                        <div class="border-l-4 border-purple-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Quick Buy/Sell FOSFO</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Atajos para comprar/vender rÃ¡pidamente 5 unidades de FOSFO al precio de mercado</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: Toast + My Orders + History cuando se ejecute</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Debug Section -->
                                <div class="mb-6">
                                    <h5 class="text-lg font-semibold text-orange-800 dark:text-orange-200 mb-3">
                                        <i class="fas fa-bug mr-2"></i>PestaÃ±a Debug
                                    </h5>
                                    <div class="space-y-3 ml-4">
                                        <div class="border-l-4 border-red-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Error Injection (Balance, Product, etc.)</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Prueba cÃ³mo tu cliente maneja diferentes tipos de errores del servidor</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: Toast de error + Messages tab + posible mensaje de error del servidor</p>
                                        </div>
                                        <div class="border-l-4 border-blue-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Test Production</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Simula producciÃ³n de un producto para actualizar tu inventario</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: Inventario (sidebar izquierdo) + Toast de confirmaciÃ³n</p>
                                        </div>
                                        <div class="border-l-4 border-green-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Ping</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Verifica conectividad con el servidor (latencia)</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: Toast "Pong received" + Messages tab</p>
                                        </div>
                                        <div class="border-l-4 border-purple-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Resync</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Solicita resincronizaciÃ³n completa de datos desde el servidor</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: ActualizaciÃ³n de Inventory + Balance + Toast</p>
                                        </div>
                                        <div class="border-l-4 border-indigo-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Orders</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Solicita lista completa de todas las Ã³rdenes activas en el mercado</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: Messages tab + log del servidor</p>
                                        </div>
                                        <div class="border-l-4 border-teal-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Sessions</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Muestra todas las sesiones de clientes conectados al servidor</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: Panel "Market Activity" en Dashboard con lista de equipos conectados</p>
                                        </div>
                                        <div class="border-l-4 border-emerald-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">My Performance</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Reporte detallado de tu rendimiento: P&L, ROI, trades, volumen</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: Panel "Market Activity" con tarjeta verde de estadÃ­sticas</p>
                                        </div>
                                        <div class="border-l-4 border-amber-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Global Report</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Reporte global del mercado con top traders y estadÃ­sticas</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: Panel "Market Activity" con tarjeta pÃºrpura y ranking</p>
                                        </div>
                                        <div class="border-l-4 border-pink-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Test Transaction</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">AÃ±ade una transacciÃ³n de prueba para verificar que la pestaÃ±a History funciona correctamente</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ VerÃ¡s el resultado en: PestaÃ±a "History" con la transacciÃ³n de prueba</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Other Tabs -->
                                <div class="mb-6">
                                    <h5 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                                        <i class="fas fa-chart-line mr-2"></i>Otras PestaÃ±as
                                    </h5>
                                    <div class="space-y-3 ml-4">
                                        <div class="border-l-4 border-blue-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Ticker Tab</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Muestra precios en tiempo real de todos los productos</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ Se actualiza automÃ¡ticamente cuando el servidor envÃ­a TICKER messages</p>
                                        </div>
                                        <div class="border-l-4 border-green-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">Order Book Tab</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Visualiza Ã³rdenes de compra/venta por producto</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ Selecciona un producto del dropdown y verÃ¡s las Ã³rdenes activas</p>
                                        </div>
                                        <div class="border-l-4 border-purple-500 pl-3">
                                            <h6 class="font-medium text-gray-900 dark:text-white">History Tab</h6>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">Muestra dos secciones: "Pending Orders" (Ã³rdenes enviadas esperando match) y "Completed Transactions" (Ã³rdenes ejecutadas)</p>
                                            <p class="text-xs text-blue-600 dark:text-blue-400">ðŸ“ Pending Orders se actualiza al enviar Ã³rdenes. Completed Transactions se actualiza cuando recibes FILL messages</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Keyboard Shortcuts -->
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-6 mb-8">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                    <i class="fas fa-keyboard mr-2 text-purple-600"></i>âŒ¨ï¸ Atajos de Teclado
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h5 class="font-medium text-gray-900 dark:text-white mb-3">NavegaciÃ³n</h5>
                                        <div class="space-y-2">
                                            <div class="flex justify-between items-center">
                                                <span class="text-sm text-gray-600 dark:text-gray-300">PestaÃ±a Debug</span>
                                                <kbd class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-2 py-1 rounded text-xs">Ctrl + Alt + D</kbd>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-sm text-gray-600 dark:text-gray-300">PestaÃ±a Simulador</span>
                                                <kbd class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-2 py-1 rounded text-xs">Ctrl + Alt + S</kbd>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-sm text-gray-600 dark:text-gray-300">PestaÃ±a Trading</span>
                                                <kbd class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-2 py-1 rounded text-xs">Ctrl + Alt + T</kbd>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-900 dark:text-white mb-3">Acciones de Trading</h5>
                                        <div class="space-y-2">
                                            <div class="flex justify-between items-center">
                                                <span class="text-sm text-gray-600 dark:text-gray-300">Compra RÃ¡pida FOSFO</span>
                                                <kbd class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-2 py-1 rounded text-xs">Ctrl + B</kbd>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-sm text-gray-600 dark:text-gray-300">Actualizar Ã“rdenes</span>
                                                <kbd class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-2 py-1 rounded text-xs">Ctrl + Shift + R</kbd>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Products Guide -->
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-6 mb-8">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                    <i class="fas fa-leaf mr-2 text-green-600"></i>ðŸ¥‘ Productos Disponibles
                                </h4>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 text-center">
                                        <div class="font-mono font-bold text-gray-900 dark:text-white">FOSFO</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-300">Producto BÃ¡sico</div>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 text-center">
                                        <div class="font-mono font-bold text-gray-900 dark:text-white">PITA</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-300">Intermedio</div>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 text-center">
                                        <div class="font-mono font-bold text-gray-900 dark:text-white">PALTA-OIL</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-300">Producto Refinado</div>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 text-center">
                                        <div class="font-mono font-bold text-gray-900 dark:text-white">GUACA</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-300">Producto Premium</div>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 text-center">
                                        <div class="font-mono font-bold text-gray-900 dark:text-white">SEBO</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-300">Subproducto</div>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 text-center">
                                        <div class="font-mono font-bold text-gray-900 dark:text-white">H-GUACA</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-300">Alta Calidad</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tips & Best Practices -->
                            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-6">
                                <h4 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200 mb-4">
                                    <i class="fas fa-lightbulb mr-2"></i>ðŸ’¡ Consejos y Mejores PrÃ¡cticas
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h5 class="font-medium text-yellow-800 dark:text-yellow-200 mb-2">âš ï¸ Notas Importantes</h5>
                                        <ul class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
                                            <li>â€¢ Siempre verifica tu balance antes de Ã³rdenes grandes</li>
                                            <li>â€¢ Usa el simulador para probar estrategias de forma segura</li>
                                            <li>â€¢ Monitorea el ticker para oportunidades de arbitraje</li>
                                            <li>â€¢ Auto Market Maker crea Ã³rdenes automÃ¡ticamente</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-yellow-800 dark:text-yellow-200 mb-2">ðŸŽ¯ Mejores PrÃ¡cticas</h5>
                                        <ul class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
                                            <li>â€¢ Usa mensajes descriptivos en las Ã³rdenes</li>
                                            <li>â€¢ Revisa el libro de Ã³rdenes antes de lÃ­mites</li>
                                            <li>â€¢ Ping regular para verificar conectividad</li>
                                            <li>â€¢ Monitorea algoritmos de producciÃ³n para bonos</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Production Results Modal (hidden) -->
    <div id="production-result" class="hidden"></div>
    <div id="offer-response" class="hidden"></div>
    <div id="sessions-list" class="hidden"></div>

    <!-- JavaScript placeholder for existing functionality -->
    <script>
        // Version info - will be replaced during build
        const APP_VERSION = '{{VERSION}}';
        const APP_COMMIT = '{{COMMIT}}';
        const APP_BUILD_DATE = '{{BUILD_DATE}}';
        
        // Update version display on load
        document.addEventListener('DOMContentLoaded', function() {
            const versionEl = document.getElementById('version-info');
            if (versionEl && APP_COMMIT !== '{{COMMIT}}') {
                versionEl.textContent = APP_COMMIT.substring(0, 7);
                versionEl.title = `Version: ${APP_VERSION}\nCommit: ${APP_COMMIT}\nBuilt: ${APP_BUILD_DATE}`;
            }
        });
        
        // Global variables and state
        let socket = null;
        let isConnected = false;
        let isAuthenticated = false;
        let currentTeam = null;
        let currentSidebarTab = 'auth';
        let currentMainTab = 'dashboard';
        let currentTradingTab = 'orders';
        let autoMarketMaker = false;
        let autoMarketMakerInterval = null;
        let isDarkMode = false;
        let myActiveOrders = [];
        let activeOffers = [];
        let pendingOrders = []; // Track orders sent but not yet filled
        let heartbeatInterval = null;
        let reconnectAttempts = 0;
        let maxReconnectAttempts = 5;
        
        // Toast notification system
        function showToast(message, type = 'info', duration = 3000) {
            const toastContainer = document.getElementById('toast-container') || createToastContainer();
            
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type} animate-slide-in`;
            
            const icon = type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : type === 'warning' ? 'âš ' : 'â„¹';
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
            
            toast.innerHTML = `
                <div class="${bgColor} text-white px-4 py-3 rounded-lg shadow-lg flex items-center space-x-3 max-w-md">
                    <span class="text-xl font-bold">${icon}</span>
                    <span class="flex-1">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('animate-slide-out');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }
        
        function createToastContainer() {
            const container = document.createElement('div');
            container.id = 'toast-container';
            container.className = 'fixed top-20 right-4 z-50 space-y-2';
            document.body.appendChild(container);
            
            const style = document.createElement('style');
            style.textContent = `
                .animate-slide-in {
                    animation: slideIn 0.3s ease-out;
                }
                .animate-slide-out {
                    animation: slideOut 0.3s ease-in;
                }
                @keyframes slideIn {
                    from { transform: translateX(400px); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(400px); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            return container;
        }
        
        // Theme management
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-icon').className = 'fas fa-sun';
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('theme-icon').className = 'fas fa-moon';
            }
        }
        
        // Tab switching functions
        function switchSidebarTab(tab) {
            // Hide all sidebar content
            document.getElementById('auth-content').style.display = 'none';
            document.getElementById('simulator-content').style.display = 'none';
            document.getElementById('debug-content').style.display = 'none';
            
            // Remove active class from all tabs
            document.querySelectorAll('.sidebar-tab').forEach(t => {
                t.classList.remove('sidebar-tab-active');
            });
            
            // Show selected content and mark tab active
            document.getElementById(tab + '-content').style.display = 'block';
            document.getElementById(tab + '-tab').classList.add('sidebar-tab-active');
            
            currentSidebarTab = tab;
        }
        
        function switchMainTab(tab) {
            // Hide all main content
            document.getElementById('dashboard-content').style.display = 'none';
            document.getElementById('trading-content').style.display = 'none';
            document.getElementById('ticker-content').style.display = 'none';
            document.getElementById('orderbook-content').style.display = 'none';
            document.getElementById('transactions-content').style.display = 'none';
            document.getElementById('sdk-emulator-content').style.display = 'none';
            document.getElementById('docs-content').style.display = 'none';
            
            // Remove active class from all tabs
            document.querySelectorAll('.main-tab').forEach(t => {
                t.classList.remove('tab-active');
            });
            
            // Show selected content and mark tab active
            document.getElementById(tab + '-content').style.display = 'block';
            document.getElementById(tab + '-tab').classList.add('tab-active');
            
            currentMainTab = tab;
        }
        
        function switchTradingTab(tab) {
            // Hide all trading content
            document.getElementById('trading-orders-content').style.display = 'none';
            document.getElementById('trading-offers-content').style.display = 'none';
            document.getElementById('trading-messages-content').style.display = 'none';
            
            // Remove active class from all tabs
            document.querySelectorAll('.trading-tab').forEach(t => {
                t.classList.remove('tab-active');
            });
            
            // Show selected content and mark tab active
            document.getElementById('trading-' + tab + '-content').style.display = 'block';
            document.getElementById('trading-' + tab + '-tab').classList.add('tab-active');
            
            currentTradingTab = tab;
        }
        
        // Connection functions
        function toggleConnection() {
            if (!isConnected) {
                connect();
            } else {
                disconnect();
            }
        }
        
        function connect() {
            console.log('Connecting...');
            updateStatus('connecting', 'Connecting...');
            showToast('Connecting to server...', 'info');
            
            // Create WebSocket connection
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            
            try {
                socket = new WebSocket(wsUrl);
                
                socket.onopen = function(event) {
                    console.log('WebSocket connected');
                    isConnected = true;
                    reconnectAttempts = 0;
                    updateStatus('connected', 'Connected');
                    document.getElementById('connect-btn').innerHTML = '<i class="fas fa-unlink mr-2"></i>Disconnect';
                    document.getElementById('login-btn').disabled = false;
                    showToast('Connected to server successfully!', 'success');
                    enableButtons();
                    startHeartbeat();
                };
                
                socket.onmessage = function(event) {
                    try {
                        const message = JSON.parse(event.data);
                        handleServerMessage(message);
                    } catch (e) {
                        console.error('Failed to parse message:', event.data, e);
                    }
                };
                
                socket.onclose = function(event) {
                    console.log('WebSocket disconnected', event.code, event.reason);
                    isConnected = false;
                    updateStatus('disconnected', 'Disconnected');
                    document.getElementById('connect-btn').innerHTML = '<i class="fas fa-plug mr-2"></i>Connect';
                    document.getElementById('login-btn').disabled = true;
                    document.getElementById('team-info').style.display = 'none';
                    disableButtons();
                    stopHeartbeat();
                    if (autoMarketMakerInterval) {
                        clearInterval(autoMarketMakerInterval);
                        autoMarketMakerInterval = null;
                        autoMarketMaker = false;
                    }
                    socket = null;
                    
                    // Attempt reconnection if it wasn't a manual disconnect
                    if (event.code !== 1000 && reconnectAttempts < maxReconnectAttempts) {
                        const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000);
                        reconnectAttempts++;
                        showToast(`Reconnecting in ${delay/1000}s... (attempt ${reconnectAttempts}/${maxReconnectAttempts})`, 'warning', delay);
                        setTimeout(() => {
                            if (!isConnected) {
                                connect();
                            }
                        }, delay);
                    } else if (reconnectAttempts >= maxReconnectAttempts) {
                        showToast('Max reconnection attempts reached. Please reconnect manually.', 'error', 5000);
                        isAuthenticated = false;
                    } else {
                        showToast('Disconnected from server', 'warning');
                        isAuthenticated = false;
                    }
                };
                
                socket.onerror = function(error) {
                    console.error('WebSocket error:', error);
                    updateStatus('disconnected', 'Connection Error');
                    showToast('Connection error occurred', 'error');
                };
                
            } catch (error) {
                console.error('Failed to create WebSocket connection:', error);
                updateStatus('disconnected', 'Connection Failed');
                showToast('Failed to connect to server', 'error');
            }
        }
        
        function disconnect() {
            console.log('Disconnecting...');
            reconnectAttempts = maxReconnectAttempts; // Prevent auto-reconnect
            stopHeartbeat();
            if (socket) {
                socket.close(1000, 'Manual disconnect'); // Normal closure
                socket = null;
            }
            isConnected = false;
            isAuthenticated = false;
            updateStatus('disconnected', 'Disconnected');
            document.getElementById('connect-btn').innerHTML = '<i class="fas fa-plug mr-2"></i>Connect';
            document.getElementById('login-btn').disabled = true;
            document.getElementById('team-info').style.display = 'none';
            disableButtons();
            stopAutoMarketMaker();
        }
        
        function startHeartbeat() {
            stopHeartbeat();
            heartbeatInterval = setInterval(() => {
                if (socket && socket.readyState === WebSocket.OPEN) {
                    const pingMessage = {
                        type: "PING"
                    };
                    socket.send(JSON.stringify(pingMessage));
                    console.log('Heartbeat ping sent');
                }
            }, 30000); // Send ping every 30 seconds
        }
        
        function stopHeartbeat() {
            if (heartbeatInterval) {
                clearInterval(heartbeatInterval);
                heartbeatInterval = null;
            }
        }
        
        function login() {
            const token = document.getElementById('token').value.trim();
            if (!token) {
                showToast('Please enter a team token', 'warning');
                return;
            }
            
            if (!socket || socket.readyState !== WebSocket.OPEN) {
                showToast('Please connect to the server first', 'warning');
                return;
            }
            
            console.log('Logging in with token:', token);
            showToast('Authenticating...', 'info');
            
            // Send authentication message
            const authMessage = {
                type: "LOGIN",
                token: token
            };
            
            sendMessage(authMessage);
        }
        
        function updateStatus(status, text) {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            
            statusDot.className = `status-dot status-${status}`;
            statusText.textContent = text;
        }
        
        function showTeamInfo(teamName) {
            const teamInfo = document.getElementById('team-info');
            const teamDetails = document.getElementById('team-details');
            
            const balance = currentTeam ? currentTeam.currentBalance : 0;
            const species = currentTeam ? currentTeam.species : 'Unknown';
            
            teamDetails.innerHTML = `
                <p><strong>Team:</strong> ${teamName}</p>
                <p><strong>Species:</strong> ${species}</p>
                <p><strong>Balance:</strong> $${balance.toFixed(2)}</p>
                <p><strong>Status:</strong> Active</p>
            `;
            
            teamInfo.style.display = 'block';
            updateInventory(currentTeam ? currentTeam.inventory : null);
        }
        
        function updateInventory(inventory = null) {
            const inventoryGrid = document.getElementById('inventory-grid');
            
            if (!inventory) {
                // Default empty state
                inventoryGrid.innerHTML = `
                    <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-center">
                        <div class="text-sm text-gray-500 dark:text-gray-400">No data</div>
                    </div>
                `;
                return;
            }
            
            const inventoryItems = Object.entries(inventory).map(([product, quantity]) => ({
                product,
                quantity
            }));
            
            if (inventoryItems.length === 0) {
                inventoryGrid.innerHTML = `
                    <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-center">
                        <div class="text-sm text-gray-500 dark:text-gray-400">No inventory</div>
                    </div>
                `;
                return;
            }
            
            inventoryGrid.innerHTML = inventoryItems.map(item => `
                <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-center">
                    <div class="text-xs font-medium text-gray-900 dark:text-white">${item.product}</div>
                    <div class="text-lg font-bold text-primary-600">${item.quantity}</div>
                </div>
            `).join('');
        }
        
        function updateInventoryDisplay(inventory) {
            updateInventory(inventory);
        }
        
        function updateBalanceDisplay(balance) {
            document.getElementById('dashboard-balance').textContent = `$${balance.toFixed(2)}`;
        }
        
        function updateDashboard(team) {
            if (team.currentBalance !== undefined) {
                updateBalanceDisplay(team.currentBalance);
            }
            if (team.inventory) {
                updateInventoryDisplay(team.inventory);
            }
        }
        
        function updateDashboardAfterTrade(fillMessage) {
            // This would ideally update from server data, but we can make basic updates
            const fillsElement = document.getElementById('dashboard-fills');
            const currentFills = parseInt(fillsElement.textContent) || 0;
            fillsElement.textContent = (currentFills + 1).toString();
        }
        
        function addTransactionToList(fillMessage) {
            const transactionsList = document.getElementById('transactions-list');
            
            // Create transaction entry
            const transactionElement = document.createElement('div');
            transactionElement.className = 'p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 mb-2';
            transactionElement.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <div class="text-sm font-medium text-gray-900 dark:text-white">
                            ${fillMessage.side} ${fillMessage.fillQty} ${fillMessage.product}
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">
                            Price: $${fillMessage.fillPrice.toFixed(2)} | Total: $${(fillMessage.fillPrice * fillMessage.fillQty).toFixed(2)}
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">
                            Counterparty: ${fillMessage.counterparty}
                        </div>
                    </div>
                    <div class="text-xs text-gray-400">
                        ${new Date(fillMessage.serverTime).toLocaleTimeString()}
                    </div>
                </div>
            `;
            
            // Remove empty state if exists
            const emptyState = transactionsList.querySelector('.flex.items-center.justify-center');
            if (emptyState) {
                emptyState.remove();
            }
            
            // Add to top of list
            transactionsList.insertBefore(transactionElement, transactionsList.firstChild);
            
            // Remove from pending orders if this order was pending
            if (fillMessage.clOrdID) {
                removePendingOrder(fillMessage.clOrdID);
            }
        }
        
        function addPendingOrder(orderData) {
            // Add to pending orders array
            pendingOrders.push({
                clOrdID: orderData.clOrdID,
                side: orderData.side,
                mode: orderData.mode,
                product: orderData.product,
                qty: orderData.qty,
                price: orderData.limitPrice,
                message: orderData.message,
                timestamp: Date.now(),
                autoAccept: orderData.debugMode === "AUTO_ACCEPT"
            });
            
            updatePendingOrdersDisplay();
        }
        
        function removePendingOrder(clOrdID) {
            pendingOrders = pendingOrders.filter(order => order.clOrdID !== clOrdID);
            updatePendingOrdersDisplay();
        }
        
        function updatePendingOrdersDisplay() {
            const pendingList = document.getElementById('pending-orders-list');
            const pendingCount = document.getElementById('pending-count');
            
            pendingCount.textContent = pendingOrders.length;
            
            if (pendingOrders.length === 0) {
                pendingList.innerHTML = `
                    <div class="text-sm text-yellow-700 dark:text-yellow-300 text-center py-2">
                        <i class="fas fa-info-circle mr-2"></i>No pending orders
                    </div>
                `;
                return;
            }
            
            pendingList.innerHTML = pendingOrders.map(order => {
                const priceText = order.price ? `$${order.price.toFixed(2)}` : 'MARKET';
                const sideColor = order.side === 'BUY' ? 'text-green-700 dark:text-green-300' : 'text-red-700 dark:text-red-300';
                const timeAgo = Math.floor((Date.now() - order.timestamp) / 1000);
                const timeStr = timeAgo < 60 ? `${timeAgo}s ago` : `${Math.floor(timeAgo / 60)}m ago`;
                
                return `
                    <div class="p-2 bg-white dark:bg-gray-800 rounded border border-yellow-300 dark:border-yellow-700 mb-2">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="text-sm font-medium ${sideColor}">
                                    ${order.side} ${order.qty} ${order.product} @ ${priceText}
                                    ${order.autoAccept ? '<span class="text-xs bg-yellow-500 text-white px-1 rounded ml-1">âš¡AUTO</span>' : ''}
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">
                                    ${order.mode} â€¢ ${timeStr}
                                </div>
                            </div>
                            <div class="text-xs text-gray-400">
                                <i class="fas fa-clock animate-spin"></i>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function clearPendingOrders() {
            if (pendingOrders.length === 0) {
                showToast('No pending orders to clear', 'info');
                return;
            }
            
            if (confirm(`Clear ${pendingOrders.length} pending orders from the list?\n\nNote: This only clears the UI display. Orders may still be active in the market.`)) {
                pendingOrders = [];
                updatePendingOrdersDisplay();
                showToast('Pending orders list cleared', 'success');
            }
        }
        
        function addMessageToLog(message) {
            const messageList = document.getElementById('message-list');
            
            const messageElement = document.createElement('div');
            messageElement.className = 'p-2 bg-gray-100 dark:bg-gray-600 rounded text-xs mb-1';
            messageElement.innerHTML = `
                <span class="text-gray-500 dark:text-gray-400">[${new Date().toLocaleTimeString()}]</span>
                <span class="text-gray-900 dark:text-white">${message}</span>
            `;
            
            // Remove empty state if exists
            const emptyState = messageList.querySelector('.flex.items-center.justify-center');
            if (emptyState) {
                emptyState.remove();
            }
            
            messageList.insertBefore(messageElement, messageList.firstChild);
            
            // Keep only last 100 messages
            while (messageList.children.length > 100) {
                messageList.removeChild(messageList.lastChild);
            }
        }
        
        function showNotification(message, type = 'info') {
            // Simple notification - could be enhanced with a proper notification system
            console.log(`[${type.toUpperCase()}] ${message}`);
            
            // Show in market activity
            const marketActivity = document.getElementById('market-activity');
            const notificationElement = document.createElement('div');
            notificationElement.className = `p-3 rounded-lg mb-2 ${
                type === 'success' ? 'bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200' :
                type === 'error' ? 'bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-200' :
                'bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200'
            }`;
            notificationElement.innerHTML = `
                <div class="text-sm">${message}</div>
                <div class="text-xs opacity-75">${new Date().toLocaleTimeString()}</div>
            `;
            
            // Remove empty state if exists
            const emptyState = marketActivity.querySelector('.flex.items-center.justify-center');
            if (emptyState) {
                emptyState.remove();
            }
            
            marketActivity.insertBefore(notificationElement, marketActivity.firstChild);
            
            // Keep only last 10 notifications
            while (marketActivity.children.length > 10) {
                marketActivity.removeChild(marketActivity.lastChild);
            }
        }
        
        function enableButtons() {
            const buttons = [
                'create-order-btn', 'auto-mm-btn', 'clear-all-btn', 'place-order-btn',
                'refresh-orders-btn', 'cancel-mm-btn', 'cancel-all-btn', 'quick-buy-fosfo', 'quick-sell-fosfo',
                'err-balance-btn', 'err-product-btn', 'err-disconnect-btn', 'err-expire-btn',
                'prod-btn', 'ping-btn', 'resync-btn', 'all-orders-btn', 'sessions-btn',
                'team-perf-btn', 'global-perf-btn',
                // SDK Emulator buttons
                'sdk-offer-btn', 'sdk-fill-btn', 'sdk-error-btn', 'sdk-inv-btn', 
                'sdk-balance-btn', 'sdk-broadcast-btn', 'sdk-ack-btn', 'sdk-ticker-btn', 'sdk-delta-btn'
            ];
            
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.disabled = false;
            });
        }
        
        function disableButtons() {
            const buttons = [
                'create-order-btn', 'auto-mm-btn', 'clear-all-btn', 'place-order-btn',
                'refresh-orders-btn', 'cancel-mm-btn', 'cancel-all-btn', 'quick-buy-fosfo', 'quick-sell-fosfo',
                'err-balance-btn', 'err-product-btn', 'err-disconnect-btn', 'err-expire-btn',
                'prod-btn', 'ping-btn', 'resync-btn', 'all-orders-btn', 'sessions-btn',
                'team-perf-btn', 'global-perf-btn',
                // SDK Emulator buttons
                'sdk-offer-btn', 'sdk-fill-btn', 'sdk-error-btn', 'sdk-inv-btn', 
                'sdk-balance-btn', 'sdk-broadcast-btn', 'sdk-ack-btn', 'sdk-ticker-btn', 'sdk-delta-btn'
            ];
            
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.disabled = true;
            });
        }
        
        // Message handling
        function sendMessage(message) {
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify(message));
                console.log('Sent message:', message);
            } else {
                console.error('WebSocket not connected');
                showToast('Not connected to server', 'error');
            }
        }
        
        function handleServerMessage(message) {
            console.log('Received message:', message);
            
            switch (message.type) {
                case 'LOGIN_OK':
                    handleAuthSuccess(message);
                    break;
                case 'PONG':
                    addMessageToLog('Pong received');
                    showToast('Pong received from server', 'success', 2000);
                    break;
                case 'ERROR':
                    handleError(message);
                    break;
                case 'FILL':
                    handleFillMessage(message);
                    break;
                case 'ORDER_ACK':
                    handleOrderAck(message);
                    break;
                case 'TICKER':
                    handleTickerUpdate(message);
                    break;
                case 'MARKET_STATE':
                    handleMarketStateUpdate(message);
                    break;
                case 'ORDER_BOOK_UPDATE':
                    handleOrderBookUpdate(message);
                    break;
                case 'ALL_ORDERS':
                    handleAllOrdersResponse(message);
                    break;
                case 'CONNECTED_SESSIONS':
                    handleSessionsResponse(message);
                    break;
                case 'INVENTORY_UPDATE':
                    handleInventoryUpdate(message);
                    break;
                case 'BALANCE_UPDATE':
                    handleBalanceUpdate(message);
                    break;
                case 'PERFORMANCE_REPORT':
                    handlePerformanceReport(message);
                    break;
                case 'GLOBAL_PERFORMANCE_REPORT':
                    handleGlobalPerformanceReport(message);
                    break;
                case 'EVENT_DELTA':
                    handleEventDelta(message);
                    break;
                case 'OFFER':
                    handleOfferMessage(message);
                    break;
                case 'BROADCAST_NOTIFICATION':
                    showToast(`ðŸ“¢ ${message.sender}: ${message.message}`, 'info', 5000);
                    addMessageToLog(`ðŸ“¢ Broadcast from ${message.sender}: ${message.message}`);
                    break;
                case 'SDK_EMULATOR_ACK':
                    if (message.success) {
                        logToEmulator(`âœ“ Emulated ${message.messageType} delivered to ${message.targetTeam}`, 'received');
                    } else {
                        logToEmulator(`âœ— Failed to deliver ${message.messageType} to ${message.targetTeam}`, 'error');
                        showToast(`Failed to send ${message.messageType}`, 'error');
                    }
                    break;
                default:
                    console.log('Unknown message type:', message.type);
                    addMessageToLog(`Unknown message: ${message.type}`);
            }
        }
        
        function handleEventDelta(message) {
            const eventCount = message.events ? message.events.length : 0;
            showToast(`Resync complete: ${eventCount} events received`, 'success');
            addMessageToLog(`Resync: Processed ${eventCount} events`);
            
            if (message.events && message.events.length > 0) {
                message.events.forEach(event => {
                    if (event.type === 'FILL') {
                        addTransactionToList(event);
                    }
                });
                
                // Refresh orders and inventory after resync
                if (isAuthenticated) {
                    setTimeout(() => refreshMyOrders(), 500);
                }
            }
        }
        
        function handleOfferMessage(message) {
            console.log('Received offer:', message);
            
            // Add to active offers
            activeOffers.push(message);
            
            // Update offer count badge
            updateOfferCount();
            
            // Display offers
            displayOffers();
            
            // Show toast notification
            showToast(`ðŸ“¬ New offer: ${message.quantityRequested} ${message.product} from ${message.buyer} @ $${message.maxPrice.toFixed(2)}`, 'info', 5000);
            
            // Log message
            addMessageToLog(`OFFER: ${message.buyer} wants ${message.quantityRequested} ${message.product} @ $${message.maxPrice.toFixed(2)}`);
        }
        
        function displayOffers() {
            const offersList = document.getElementById('offers-list');
            
            if (!activeOffers || activeOffers.length === 0) {
                offersList.innerHTML = `
                    <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
                        <i class="fas fa-info-circle mr-2"></i>No pending offers
                    </div>
                `;
                return;
            }
            
            offersList.innerHTML = activeOffers.map(offer => {
                const expiresIn = offer.expiresIn ? `Expires in ${Math.floor(offer.expiresIn / 1000)}s` : 'No expiry';
                
                return `
                    <div class="p-4 bg-white dark:bg-gray-800 rounded-lg border-2 border-yellow-400 dark:border-yellow-600 shadow-lg">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-handshake text-yellow-500 mr-2"></i>
                                    <span class="font-semibold text-gray-900 dark:text-white">
                                        ${offer.buyer} wants to buy
                                    </span>
                                </div>
                                <div class="text-lg font-bold text-primary-600 dark:text-primary-400">
                                    ${offer.quantityRequested} ${offer.product}
                                </div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">
                                    Offering up to: <span class="font-semibold text-green-600 dark:text-green-400">$${offer.maxPrice.toFixed(2)}</span> per unit
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">
                                    <i class="fas fa-clock mr-1"></i>${expiresIn}
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <div>
                                <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Quantity to sell</label>
                                <input type="number" id="qty-${offer.offerId}" 
                                       value="${offer.quantityRequested}" 
                                       min="1" 
                                       max="${offer.quantityRequested}"
                                       class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Your price</label>
                                <input type="number" id="price-${offer.offerId}" 
                                       value="${offer.maxPrice.toFixed(2)}" 
                                       step="0.01"
                                       max="${offer.maxPrice}"
                                       class="w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="acceptOffer('${offer.offerId}')" 
                                    class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-check mr-1"></i>Accept
                            </button>
                            <button onclick="rejectOffer('${offer.offerId}')" 
                                    class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-times mr-1"></i>Reject
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateOfferCount() {
            const badge = document.getElementById('offer-count');
            if (activeOffers.length > 0) {
                badge.textContent = activeOffers.length;
                badge.style.display = 'inline';
            } else {
                badge.style.display = 'none';
            }
        }
        
        function acceptOffer(offerId) {
            const offer = activeOffers.find(o => o.offerId === offerId);
            if (!offer) {
                showToast('Offer not found', 'error');
                return;
            }
            
            const qtyInput = document.getElementById(`qty-${offerId}`);
            const priceInput = document.getElementById(`price-${offerId}`);
            
            const qty = parseInt(qtyInput.value);
            const price = parseFloat(priceInput.value);
            
            if (!qty || qty <= 0) {
                showToast('Invalid quantity', 'warning');
                return;
            }
            
            if (!price || price <= 0) {
                showToast('Invalid price', 'warning');
                return;
            }
            
            if (price > offer.maxPrice) {
                showToast(`Price cannot exceed $${offer.maxPrice.toFixed(2)}`, 'warning');
                return;
            }
            
            // Send accept message
            const acceptMsg = {
                type: "ACCEPT_OFFER",
                offerId: offerId,
                accept: true,
                quantityOffered: qty,
                priceOffered: price
            };
            
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify(acceptMsg));
                showToast(`Accepting offer: ${qty} ${offer.product} @ $${price.toFixed(2)}`, 'success');
                
                // Remove from active offers
                activeOffers = activeOffers.filter(o => o.offerId !== offerId);
                updateOfferCount();
                displayOffers();
            } else {
                showToast('Not connected to server', 'error');
            }
        }
        
        function rejectOffer(offerId) {
            const offer = activeOffers.find(o => o.offerId === offerId);
            if (!offer) {
                showToast('Offer not found', 'error');
                return;
            }
            
            // Send reject message
            const rejectMsg = {
                type: "ACCEPT_OFFER",
                offerId: offerId,
                accept: false,
                quantityOffered: 0,
                priceOffered: 0
            };
            
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify(rejectMsg));
                showToast(`Rejected offer from ${offer.buyer}`, 'info');
                
                // Remove from active offers
                activeOffers = activeOffers.filter(o => o.offerId !== offerId);
                updateOfferCount();
                displayOffers();
            } else {
                showToast('Not connected to server', 'error');
            }
        }
        
        function handleAuthSuccess(message) {
            // Check if admin user
            if (message.team === 'admin') {
                const token = document.getElementById('token').value;
                localStorage.setItem('adminToken', token);
                window.location.href = '/admin.html';
                return;
            }
            
            isAuthenticated = true;
            currentTeam = {
                teamName: message.team,
                species: message.species,
                currentBalance: message.currentBalance,
                inventory: message.inventory,
                authorizedProducts: message.authorizedProducts
            };
            updateStatus('authenticated', 'Authenticated');
            showTeamInfo(message.team);
            enableButtons();
            updateDashboard(currentTeam);
            
            // Auto-populate SDK Emulator target team and buyer
            const sdkTargetTeam = document.getElementById('sdk-target-team');
            if (sdkTargetTeam && !sdkTargetTeam.value) {
                sdkTargetTeam.value = message.team;
                sdkTargetTeam.placeholder = message.team;
            }
            
            const sdkOfferBuyer = document.getElementById('sdk-offer-buyer');
            if (sdkOfferBuyer) {
                sdkOfferBuyer.value = message.team;
            }
            
            showToast(`Welcome, ${message.team}!`, 'success');
        }
        
        function handleAuthFailure(message) {
            showToast('Authentication failed: ' + (message.reason || 'Invalid token'), 'error');
        }
        
        function handleAllOrdersResponse(message) {
            myActiveOrders = message.orders || [];
            displayMyOrders(myActiveOrders);
            showToast(`Loaded ${myActiveOrders.length} active orders`, 'info', 2000);
        }
        
        function displayMyOrders(orders) {
            const ordersList = document.getElementById('my-orders-list');
            
            if (!orders || orders.length === 0) {
                ordersList.innerHTML = `
                    <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
                        <i class="fas fa-info-circle mr-2"></i>No active orders
                    </div>
                `;
                document.getElementById('dashboard-orders').textContent = '0';
                return;
            }
            
            document.getElementById('dashboard-orders').textContent = orders.length.toString();
            
            ordersList.innerHTML = orders.map(order => {
                const sideColor = order.side === 'BUY' ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400';
                const priceText = order.price ? `$${order.price.toFixed(2)}` : 'MARKET';
                
                return `
                    <div class="p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 mb-2">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="text-sm font-medium ${sideColor}">
                                    ${order.side} ${order.quantity} ${order.product}
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">
                                    Price: ${priceText} | Mode: ${order.mode}
                                </div>
                                ${order.message ? `<div class="text-xs text-gray-400 italic">"${order.message}"</div>` : ''}
                                <div class="text-xs text-gray-400">
                                    ID: ${order.clOrdID}
                                </div>
                            </div>
                            <button onclick="cancelOrder('${order.clOrdID}')" 
                                    class="ml-2 bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                                Cancel
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function handleOrderBookUpdate(message) {
            updateOrderBookDisplay(message);
        }
        
        function updateOrderBookDisplay(orderBookData) {
            const selectedProduct = document.getElementById('product-selector').value;
            if (selectedProduct !== orderBookData.product) {
                return;
            }
            
            const buyOrdersDiv = document.getElementById('buy-orders');
            const sellOrdersDiv = document.getElementById('sell-orders');
            const allOrdersDiv = document.getElementById('all-orders-list');
            
            if (!orderBookData.buyOrders || orderBookData.buyOrders.length === 0) {
                buyOrdersDiv.innerHTML = '<div class="text-green-600 dark:text-green-400 text-sm">No buy orders</div>';
            } else {
                buyOrdersDiv.innerHTML = orderBookData.buyOrders.slice(0, 10).map(order => `
                    <div class="flex justify-between items-center text-sm p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                        <span class="font-medium">${order.quantity}</span>
                        <span class="text-green-600 dark:text-green-400 font-bold">$${order.price ? order.price.toFixed(2) : 'MARKET'}</span>
                        <span class="text-xs text-gray-500">${order.teamName}</span>
                        ${order.teamName !== currentTeam ? `
                            <button onclick="fillOrder('${order.clOrdID}', 'SELL', '${order.product}', ${order.quantity}, ${order.price || 0})" 
                                    class="px-2 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded transition-colors">
                                Fill
                            </button>
                        ` : '<span class="text-xs text-gray-400">You</span>'}
                    </div>
                `).join('');
            }
            
            if (!orderBookData.sellOrders || orderBookData.sellOrders.length === 0) {
                sellOrdersDiv.innerHTML = '<div class="text-red-600 dark:text-red-400 text-sm">No sell orders</div>';
            } else {
                sellOrdersDiv.innerHTML = orderBookData.sellOrders.slice(0, 10).map(order => `
                    <div class="flex justify-between items-center text-sm p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                        <span class="font-medium">${order.quantity}</span>
                        <span class="text-red-600 dark:text-red-400 font-bold">$${order.price ? order.price.toFixed(2) : 'MARKET'}</span>
                        <span class="text-xs text-gray-500">${order.teamName}</span>
                        ${order.teamName !== currentTeam ? `
                            <button onclick="fillOrder('${order.clOrdID}', 'BUY', '${order.product}', ${order.quantity}, ${order.price || 0})" 
                                    class="px-2 py-1 bg-green-500 hover:bg-green-600 text-white text-xs rounded transition-colors">
                                Fill
                            </button>
                        ` : '<span class="text-xs text-gray-400">You</span>'}
                    </div>
                `).join('');
            }
            
            const allOrders = [...(orderBookData.buyOrders || []), ...(orderBookData.sellOrders || [])];
            if (allOrders.length === 0) {
                allOrdersDiv.innerHTML = '<div class="text-gray-500 dark:text-gray-400 text-sm"><i class="fas fa-info-circle mr-2"></i>No orders available</div>';
            } else {
                allOrdersDiv.innerHTML = allOrders.map(order => {
                    const sideColor = order.side === 'BUY' ? 'text-green-600' : 'text-red-600';
                    const counterSide = order.side === 'BUY' ? 'SELL' : 'BUY';
                    const isMyOrder = order.teamName === currentTeam;
                    return `
                        <div class="flex justify-between items-center text-xs p-2 border-b border-gray-200 dark:border-gray-600">
                            <span class="${sideColor} font-medium">${order.side}</span>
                            <span>${order.quantity} ${orderBookData.product}</span>
                            <span class="font-bold">$${order.price ? order.price.toFixed(2) : 'MKT'}</span>
                            <span class="text-gray-500">${order.teamName}</span>
                            ${!isMyOrder ? `
                                <button onclick="fillOrder('${order.clOrdID}', '${counterSide}', '${order.product}', ${order.quantity}, ${order.price || 0})" 
                                        class="px-2 py-1 ${order.side === 'BUY' ? 'bg-red-500 hover:bg-red-600' : 'bg-green-500 hover:bg-green-600'} text-white text-xs rounded">
                                    Fill
                                </button>
                            ` : '<span class="text-xs text-gray-400">You</span>'}
                        </div>
                    `;
                }).join('');
            }
            
            showToast(`Order book updated for ${orderBookData.product}`, 'info', 2000);
        }
        
        function handleFillMessage(message) {
            console.log('ðŸŽ¯ FILL message received - Adding to transaction history:', message);
            addTransactionToList(message);
            updateDashboardAfterTrade(message);
            showNotification(`Trade executed: ${message.side} ${message.fillQty} ${message.product} @ $${message.fillPrice.toFixed(2)}`, 'success');
            showToast(`âœ“ FILL: ${message.side} ${message.fillQty} ${message.product} @ $${message.fillPrice.toFixed(2)}`, 'success');
            
            if (isAuthenticated) {
                setTimeout(() => refreshMyOrders(), 500);
            }
        }
        
        function handleOrderAck(message) {
            console.log('âœ… ORDER_ACK received:', message);
            addMessageToLog(`Order ${message.clOrdID} acknowledged: ${message.status}`);
            showToast(`âœ… Order ${message.status} - waiting for match...`, 'info', 2000);
            
            if (isAuthenticated) {
                setTimeout(() => refreshMyOrders(), 500);
            }
        }
        
        function handleTickerUpdate(message) {
            updateTickerDisplay(message);
        }
        
        function handleMarketStateUpdate(message) {
            updateMarketStateDisplay(message);
        }
        
        function updateTickerDisplay(ticker) {
            const tickerList = document.getElementById('ticker-list');
            
            // Find existing ticker for this product or create new one
            let tickerElement = document.querySelector(`[data-product="${ticker.product}"]`);
            
            if (!tickerElement) {
                tickerElement = document.createElement('div');
                tickerElement.className = 'bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4';
                tickerElement.setAttribute('data-product', ticker.product);
                
                // Remove "no data" message if it exists
                const noDataElement = tickerList.querySelector('.bg-yellow-50');
                if (noDataElement) {
                    noDataElement.remove();
                }
                
                tickerList.appendChild(tickerElement);
            }
            
            const bidText = ticker.bestBid ? `$${ticker.bestBid.toFixed(2)}` : 'N/A';
            const askText = ticker.bestAsk ? `$${ticker.bestAsk.toFixed(2)}` : 'N/A';
            const midText = ticker.mid ? `$${ticker.mid.toFixed(2)}` : 'N/A';
            const spreadText = (ticker.bestBid && ticker.bestAsk) ? 
                `$${(ticker.bestAsk - ticker.bestBid).toFixed(2)}` : 'N/A';
            
            tickerElement.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white">${ticker.product}</h4>
                    <span class="text-xs text-gray-500 dark:text-gray-400">${new Date(ticker.serverTime).toLocaleTimeString()}</span>
                </div>
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <div>
                        <span class="text-gray-600 dark:text-gray-400">Bid:</span>
                        <span class="font-medium text-green-600 dark:text-green-400 ml-1">${bidText}</span>
                    </div>
                    <div>
                        <span class="text-gray-600 dark:text-gray-400">Ask:</span>
                        <span class="font-medium text-red-600 dark:text-red-400 ml-1">${askText}</span>
                    </div>
                    <div>
                        <span class="text-gray-600 dark:text-gray-400">Mid:</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 ml-1">${midText}</span>
                    </div>
                    <div>
                        <span class="text-gray-600 dark:text-gray-400">Spread:</span>
                        <span class="font-medium text-gray-900 dark:text-white ml-1">${spreadText}</span>
                    </div>
                </div>
                <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                    24h Volume: ${ticker.volume24h}
                </div>
            `;
        }
        
        function updateMarketStateDisplay(marketState) {
            // Update the market activity with real-time market information
            const marketActivity = document.getElementById('market-activity');
            
            const stateElement = document.createElement('div');
            stateElement.className = 'p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg mb-2';
            stateElement.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <div class="text-sm font-medium text-blue-900 dark:text-blue-100">
                            Market Update: ${marketState.product}
                        </div>
                        <div class="text-xs text-blue-700 dark:text-blue-300">
                            ${marketState.bestBid ? `Bid: $${marketState.bestBid.toFixed(2)}` : 'No Bid'} | 
                            ${marketState.bestAsk ? `Ask: $${marketState.bestAsk.toFixed(2)}` : 'No Ask'}
                            ${marketState.lastTradePrice ? ` | Last: $${marketState.lastTradePrice.toFixed(2)}` : ''}
                        </div>
                    </div>
                    <div class="text-xs text-blue-600 dark:text-blue-400">
                        ${new Date(marketState.updatedAt).toLocaleTimeString()}
                    </div>
                </div>
            `;
            
            // Remove empty state if exists
            const emptyState = marketActivity.querySelector('.flex.items-center.justify-center');
            if (emptyState) {
                emptyState.remove();
            }
            
            marketActivity.insertBefore(stateElement, marketActivity.firstChild);
            
            // Keep only last 10 market updates
            while (marketActivity.children.length > 10) {
                marketActivity.removeChild(marketActivity.lastChild);
            }
        }
        
        function handleSessionsResponse(message) {
            displaySessions(message.sessions);
        }
        
        function handleInventoryUpdate(message) {
            updateInventoryDisplay(message.inventory);
            
            // Show which products changed
            const products = Object.keys(message.inventory);
            if (products.length > 0) {
                const summary = products.map(p => `${p}: ${message.inventory[p]}`).join(', ');
                showToast(`Inventory updated: ${summary}`, 'success', 3000);
                addMessageToLog(`Inventory update: ${summary}`);
            } else {
                showToast('Inventory updated', 'success', 2000);
            }
        }
        
        function handleBalanceUpdate(message) {
            updateBalanceDisplay(message.balance);
            showToast(`Balance updated: $${message.balance.toFixed(2)}`, 'success', 2000);
        }
        
        function handleError(message) {
            console.error('Server error:', message);
            showToast('Error: ' + message.reason, 'error');
            addMessageToLog(`ERROR: ${message.reason}`);
            
            if (message.code && message.code.includes('AUTH')) {
                handleAuthFailure(message);
            }
        }
        
        function handlePerformanceReport(message) {
            displayPerformanceReport(message);
        }
        
        function handleGlobalPerformanceReport(message) {
            displayGlobalPerformanceReport(message);
        }
        
        function displayPerformanceReport(report) {
            const marketActivity = document.getElementById('market-activity');
            
            const reportElement = document.createElement('div');
            reportElement.className = 'p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg mb-2';
            reportElement.innerHTML = `
                <h4 class="font-semibold text-green-800 dark:text-green-200 mb-3">
                    <i class="fas fa-chart-bar mr-2"></i>Performance Report - ${report.teamName}
                </h4>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <div class="text-green-900 dark:text-green-100">
                            <strong>P&L:</strong> $${report.profitLoss.toFixed(2)} (${report.roi.toFixed(1)}% ROI)
                        </div>
                        <div class="text-green-700 dark:text-green-300">
                            <strong>Balance:</strong> $${report.startBalance.toFixed(2)} â†’ $${report.finalBalance.toFixed(2)}
                        </div>
                        <div class="text-green-700 dark:text-green-300">
                            <strong>Total Trades:</strong> ${report.totalTrades}
                        </div>
                        <div class="text-green-700 dark:text-green-300">
                            <strong>Volume:</strong> $${report.totalVolume.toFixed(2)}
                        </div>
                    </div>
                    <div>
                        <div class="text-green-700 dark:text-green-300">
                            <strong>Buy/Sell:</strong> ${report.buyTrades}/${report.sellTrades}
                        </div>
                        <div class="text-green-700 dark:text-green-300">
                            <strong>Avg Trade:</strong> $${report.avgTradeSize.toFixed(2)}
                        </div>
                        ${report.rank ? `<div class="text-green-700 dark:text-green-300">
                            <strong>Rank:</strong> ${report.rank}/${report.totalTeams}
                        </div>` : ''}
                    </div>
                </div>
                <div class="text-xs text-green-600 dark:text-green-400 mt-2">
                    Generated: ${new Date(report.serverTime).toLocaleTimeString()}
                </div>
            `;
            
            // Remove empty state if exists
            const emptyState = marketActivity.querySelector('.flex.items-center.justify-center');
            if (emptyState) {
                emptyState.remove();
            }
            
            marketActivity.insertBefore(reportElement, marketActivity.firstChild);
            showToast('Performance report loaded', 'success');
        }
        
        function displayGlobalPerformanceReport(report) {
            const marketActivity = document.getElementById('market-activity');
            
            const reportElement = document.createElement('div');
            reportElement.className = 'p-4 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg mb-2';
            reportElement.innerHTML = `
                <h4 class="font-semibold text-purple-800 dark:text-purple-200 mb-3">
                    <i class="fas fa-globe mr-2"></i>Global Performance Report
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <div class="text-purple-900 dark:text-purple-100">
                            <strong>Duration:</strong> ${report.duration}
                        </div>
                        <div class="text-purple-700 dark:text-purple-300">
                            <strong>Total Trades:</strong> ${report.totalTrades}
                        </div>
                        <div class="text-purple-700 dark:text-purple-300">
                            <strong>Total Volume:</strong> $${report.totalVolume.toFixed(2)}
                        </div>
                    </div>
                    <div>
                        <div class="text-purple-700 dark:text-purple-300">
                            <strong>Top Traders:</strong>
                        </div>
                        <div class="mt-1 space-y-1">
                            ${report.topTraders.slice(0, 3).map((trader, index) => `
                                <div class="text-xs text-purple-600 dark:text-purple-400">
                                    ${index + 1}. ${trader.teamName}: ${trader.roi.toFixed(1)}% ROI
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                <div class="text-xs text-purple-600 dark:text-purple-400 mt-2">
                    Generated: ${new Date(report.serverTime).toLocaleTimeString()}
                </div>
            `;
            
            // Remove empty state if exists
            const emptyState = marketActivity.querySelector('.flex.items-center.justify-center');
            if (emptyState) {
                emptyState.remove();
            }
            
            marketActivity.insertBefore(reportElement, marketActivity.firstChild);
            showToast('Global performance report loaded', 'success');
        }

        // Performance report functions
        function requestTeamPerformanceReport() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const message = {
                type: "REQUEST_PERFORMANCE_REPORT",
                scope: "team"
            };
            
            sendMessage(message);
            addMessageToLog('Requested team performance report');
            showToast('Requesting performance report...', 'info');
        }
        
        function requestGlobalPerformanceReport() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const message = {
                type: "REQUEST_PERFORMANCE_REPORT",
                scope: "global"
            };
            
            sendMessage(message);
            addMessageToLog('Requested global performance report');
            showToast('Requesting global report...', 'info');
        }

        // Trading functions
        function createMarketOrder() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const side = document.getElementById('sim-side').value;
            const product = document.getElementById('sim-product').value;
            const qty = parseInt(document.getElementById('sim-qty').value);
            const price = parseFloat(document.getElementById('sim-price').value);
            
            if (!product || !qty || qty <= 0 || !price || price <= 0) {
                showToast('Please fill in all required fields', 'warning');
                return;
            }
            
            const timestamp = Date.now();
            const clOrdID = `SIM-${currentTeam.teamName}-${timestamp}`;
            
            const orderMessage = {
                type: "ORDER",
                clOrdID: clOrdID,
                side: side,
                mode: "LIMIT",
                product: product,
                qty: qty,
                limitPrice: price,
                message: "Simulator order",
                debugMode: "TEAM_ONLY"
            };
            
            sendMessage(orderMessage);
            addPendingOrder(orderMessage);
            addMessageToLog(`Simulator order sent: ${side} ${qty} ${product} @ $${price.toFixed(2)}`);
            showToast(`Simulator order: ${side} ${qty} ${product} @ $${price.toFixed(2)} (will appear in Offers tab)`, 'success');
            
            document.getElementById('sim-qty').value = '';
            document.getElementById('sim-price').value = '';
        }
        
        function placeOrder() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const side = document.getElementById('side').value;
            const mode = document.getElementById('mode').value;
            const product = document.getElementById('product').value;
            const qty = parseInt(document.getElementById('qty').value);
            const price = parseFloat(document.getElementById('price').value);
            const message = document.getElementById('message').value.trim();
            
            if (!product || !qty || qty <= 0) {
                showToast('Please fill in all required fields', 'warning');
                return;
            }
            
            if (mode === 'LIMIT' && (!price || price <= 0)) {
                showToast('LIMIT orders require a positive price', 'warning');
                return;
            }
            
            const timestamp = Date.now();
            const clOrdID = `WEB-${currentTeam.teamName}-${timestamp}`;
            const autoAccept = document.getElementById('auto-accept-toggle').checked;
            
            const orderMessage = {
                type: "ORDER",
                clOrdID: clOrdID,
                side: side,
                mode: mode,
                product: product,
                qty: qty,
                limitPrice: mode === 'LIMIT' ? price : null,
                message: message || ''
            };
            
            // Add debug mode if auto-accept is enabled
            if (autoAccept) {
                orderMessage.debugMode = "AUTO_ACCEPT";
            }
            
            sendMessage(orderMessage);
            
            // Add to pending orders list
            addPendingOrder(orderMessage);
            
            const priceStr = mode === 'LIMIT' ? '$' + price.toFixed(2) : 'MARKET';
            addMessageToLog(`Order sent: ${side} ${qty} ${product} @ ${priceStr}${autoAccept ? ' [AUTO-ACCEPT]' : ''}`);
            const toastMsg = autoAccept 
                ? `âš¡ Order placed: ${side} ${qty} ${product} (auto-accept enabled - instant fill!)`
                : `ðŸ“¤ Order placed: ${side} ${qty} ${product} (waiting for match...)`;
            showToast(toastMsg, 'success');
            console.log('ðŸ“¤ Order sent to server:', orderMessage);
            
            document.getElementById('qty').value = '';
            document.getElementById('price').value = '';
            document.getElementById('message').value = '';
        }
        
        function quickTrade(side, product, quantity) {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            if (!currentTeam || !currentTeam.teamName) {
                showToast('Team information not available', 'error');
                return;
            }
            
            const timestamp = Date.now();
            const clOrdID = `QUICK-${currentTeam.teamName}-${timestamp}`;
            
            const orderMessage = {
                type: "ORDER",
                clOrdID: clOrdID,
                side: side,
                mode: "MARKET",
                product: product,
                qty: quantity,
                message: "Quick trade"
            };
            
            sendMessage(orderMessage);
            addPendingOrder(orderMessage);
            showToast(`Quick ${side}: ${quantity} ${product}`, 'success');
        }
        
        function toggleAutoMarketMaker() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            autoMarketMaker = !autoMarketMaker;
            const btn = document.getElementById('auto-mm-btn');
            
            if (autoMarketMaker) {
                btn.innerHTML = '<i class="fas fa-robot mr-1"></i>ðŸ”´ Stop MM';
                btn.className = btn.className.replace('bg-yellow-600', 'bg-red-600').replace('hover:bg-yellow-700', 'hover:bg-red-700');
                showToast('Auto Market Maker started - Creating buy/sell orders automatically every 3 seconds', 'success');
                startAutoMarketMaker();
            } else {
                btn.innerHTML = '<i class="fas fa-robot mr-1"></i>Auto MM';
                btn.className = btn.className.replace('bg-red-600', 'bg-yellow-600').replace('hover:bg-red-700', 'hover:bg-yellow-700');
                showToast('Auto Market Maker stopped', 'info');
                stopAutoMarketMaker();
            }
        }
        
        function startAutoMarketMaker() {
            const products = ['FOSFO', 'PITA', 'PALTA-OIL', 'GUACA', 'SEBO', 'H-GUACA'];
            
            autoMarketMakerInterval = setInterval(() => {
                if (!autoMarketMaker || !isAuthenticated) {
                    stopAutoMarketMaker();
                    return;
                }
                
                const product = products[Math.floor(Math.random() * products.length)];
                const side = Math.random() > 0.5 ? 'BUY' : 'SELL';
                const qty = Math.floor(Math.random() * 5) + 1;
                const basePrice = 10 + Math.random() * 20;
                const spread = 0.5;
                const price = side === 'BUY' ? basePrice - spread : basePrice + spread;
                
                const timestamp = Date.now();
                const clOrdID = `MM-${currentTeam.teamName}-${timestamp}`;
                
                const orderMessage = {
                    type: "ORDER",
                    clOrdID: clOrdID,
                    side: side,
                    mode: "LIMIT",
                    product: product,
                    qty: qty,
                    limitPrice: price,
                    message: "Auto Market Maker",
                    debugMode: "TEAM_ONLY"
                };
                
                sendMessage(orderMessage);
                addPendingOrder(orderMessage);
                addMessageToLog(`Auto MM: ${side} ${qty} ${product} @ $${price.toFixed(2)}`);
            }, 3000);
        }
        
        function stopAutoMarketMaker() {
            if (autoMarketMakerInterval) {
                clearInterval(autoMarketMakerInterval);
                autoMarketMakerInterval = null;
            }
        }
        
        function clearAllOrders() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            if (myActiveOrders.length === 0) {
                showToast('No active orders to clear', 'info');
                return;
            }
            
            if (!confirm(`Are you sure you want to cancel all ${myActiveOrders.length} active orders?`)) {
                return;
            }
            
            let cancelledCount = 0;
            let errors = 0;
            
            myActiveOrders.forEach(order => {
                const cancelMessage = {
                    type: "CANCEL",
                    clOrdID: order.clOrdID
                };
                try {
                    sendMessage(cancelMessage);
                    cancelledCount++;
                } catch (e) {
                    errors++;
                }
            });
            
            showToast(`Cancelling ${cancelledCount} orders...`, 'success');
            setTimeout(() => refreshMyOrders(), 1500);
        }
        
        function refreshMyOrders() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const message = {
                type: "REQUEST_ALL_ORDERS"
            };
            
            sendMessage(message);
            addMessageToLog('Requested all orders');
            showToast('Refreshing orders...', 'info', 1500);
        }
        
        function cancelAutoMMOrders() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const mmOrders = myActiveOrders.filter(order => order.clOrdID && order.clOrdID.startsWith('MM-'));
            
            if (mmOrders.length === 0) {
                showToast('No Auto MM orders to cancel', 'info');
                return;
            }
            
            if (!confirm(`Cancel ${mmOrders.length} Auto Market Maker order(s)?`)) {
                return;
            }
            
            let cancelled = 0;
            mmOrders.forEach(order => {
                const cancelMessage = {
                    type: "CANCEL",
                    clOrdID: order.clOrdID
                };
                sendMessage(cancelMessage);
                cancelled++;
            });
            
            showToast(`Cancelling ${cancelled} Auto MM orders...`, 'info');
            
            setTimeout(() => {
                refreshMyOrders();
            }, 500);
        }
        
        function cancelAllOrders() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            if (!confirm('Are you sure you want to cancel ALL your active orders?')) {
                return;
            }
            
            clearAllOrders();
        }
        
        function cancelOrder(clOrdID) {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const cancelMessage = {
                type: "CANCEL",
                clOrdID: clOrdID
            };
            
            sendMessage(cancelMessage);
            showToast(`Cancelling order...`, 'info');
            setTimeout(() => refreshMyOrders(), 500);
        }
        
        function clearMessages() {
            document.getElementById('message-list').innerHTML = `
                <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
                    <i class="fas fa-info-circle mr-2"></i>No system messages
                </div>
            `;
            showToast('Messages cleared', 'success', 2000);
        }
        
        // Debug functions
        function injectError(errorType) {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const timestamp = Date.now();
            const clOrdID = `ERR-${currentTeam.teamName}-${timestamp}`;
            
            // Different error types require different test scenarios
            let errorOrder;
            
            switch(errorType) {
                case 'INSUFFICIENT_BALANCE':
                    // Try to buy with very high price to exceed balance
                    errorOrder = {
                        type: "ORDER",
                        clOrdID: clOrdID,
                        side: "BUY",
                        mode: "LIMIT",
                        product: "FOSFO",
                        qty: 1000,
                        limitPrice: 999999.99
                    };
                    break;
                    
                case 'UNAUTHORIZED_PRODUCT':
                    // Try to trade a product team doesn't have access to
                    errorOrder = {
                        type: "ORDER",
                        clOrdID: clOrdID,
                        side: "SELL",
                        mode: "MARKET",
                        product: "INVALID_PRODUCT",
                        qty: 1
                    };
                    break;
                    
                case 'DISCONNECT_CLIENT':
                    // Manually disconnect the websocket
                    showToast('Simulating disconnect...', 'warning');
                    addMessageToLog('Simulating client disconnect');
                    disconnect();
                    setTimeout(() => {
                        showToast('Reconnect manually or wait for auto-reconnect', 'info', 5000);
                    }, 1000);
                    return;
                    
                case 'OFFER_EXPIRED':
                    // This would be for ACCEPT_OFFER message, not ORDER
                    showToast('Offer expiry test not implemented for ORDER type', 'info');
                    addMessageToLog('Offer expiry test requires ACCEPT_OFFER message type');
                    return;
                    
                default:
                    showToast(`Unknown error type: ${errorType}`, 'error');
                    return;
            }
            
            sendMessage(errorOrder);
            showToast(`Testing error scenario: ${errorType}`, 'warning');
            addMessageToLog(`Error scenario test: ${errorType}`);
        }
        
        function testProduction() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const product = document.getElementById('prod-product').value;
            const quantity = parseInt(document.getElementById('prod-qty').value);
            
            if (!product || !quantity || quantity <= 0) {
                showToast('Please enter a valid product and quantity', 'warning');
                return;
            }
            
            const productionMessage = {
                type: "PRODUCTION_UPDATE",
                product: product,
                quantity: quantity
            };
            
            sendMessage(productionMessage);
            showToast(`Production test: +${quantity} ${product}`, 'info');
            addMessageToLog(`Production test: ${product} x${quantity}`);
            
            document.getElementById('prod-qty').value = '';
            
            setTimeout(() => {
                if (isAuthenticated) {
                    const resyncMsg = {
                        type: "RESYNC",
                        lastSync: new Date().toISOString()
                    };
                    sendMessage(resyncMsg);
                }
            }, 1000);
        }
        
        function sendPing() {
            if (!socket || socket.readyState !== WebSocket.OPEN) {
                showToast('Not connected to server', 'error');
                return;
            }
            
            const pingMessage = {
                type: "PING"
            };
            
            sendMessage(pingMessage);
            addMessageToLog('Ping sent');
            showToast('Ping sent to server', 'info', 2000);
        }
        
        function requestResync() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const resyncMessage = {
                type: "RESYNC",
                lastSync: new Date().toISOString()
            };
            
            sendMessage(resyncMessage);
            showToast('Requesting data resync...', 'info');
            addMessageToLog('Resync requested');
        }
        
        function requestAllOrders() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const message = {
                type: "REQUEST_ALL_ORDERS"
            };
            
            sendMessage(message);
            addMessageToLog('Requested all orders');
            showToast('Fetching all orders...', 'info');
        }
        
        function requestConnectedSessions() {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const message = {
                type: "REQUEST_CONNECTED_SESSIONS"
            };
            
            sendMessage(message);
            showToast('Fetching connected sessions...', 'info');
        }
        
        function handleSessionsResponse(message) {
            displaySessions(message.sessions);
        }
        
        function displaySessions(sessions) {
            const marketActivity = document.getElementById('market-activity');
            
            const sessionsElement = document.createElement('div');
            sessionsElement.className = 'p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg mb-2';
            sessionsElement.innerHTML = `
                <h4 class="font-semibold text-blue-800 dark:text-blue-200 mb-3">
                    <i class="fas fa-users mr-2"></i>Connected Sessions (${sessions.length})
                </h4>
                <div class="space-y-2">
                    ${sessions.map(session => `
                        <div class="flex justify-between items-center text-sm">
                            <div>
                                <span class="font-medium text-blue-900 dark:text-blue-100">${session.teamName}</span>
                                <span class="text-blue-600 dark:text-blue-300">(${session.clientType})</span>
                            </div>
                            <div class="text-blue-600 dark:text-blue-400">
                                ${session.authenticated ? 'âœ“ Auth' : '- Not Auth'}
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="text-xs text-blue-600 dark:text-blue-400 mt-2">
                    Updated: ${new Date().toLocaleTimeString()}
                </div>
            `;
            
            const emptyState = marketActivity.querySelector('.flex.items-center.justify-center');
            if (emptyState) {
                emptyState.remove();
            }
            
            marketActivity.insertBefore(sessionsElement, marketActivity.firstChild);
            showToast(`${sessions.length} connected sessions`, 'success');
        }
        
        function updateOrderBook() {
            const product = document.getElementById('product-selector').value;
            
            if (!product) {
                showToast('Please select a product', 'warning');
                return;
            }
            
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const message = {
                type: "REQUEST_ORDER_BOOK",
                product: product
            };
            
            sendMessage(message);
            showToast(`Fetching order book for ${product}...`, 'info', 2000);
        }
        
        function fillOrder(targetClOrdID, side, product, quantity, price) {
            if (!isAuthenticated) {
                showToast('Please authenticate first', 'warning');
                return;
            }
            
            const priceDisplay = price > 0 ? `$${price.toFixed(2)}` : 'MARKET';
            const action = side === 'BUY' ? 'buy' : 'sell';
            
            if (!confirm(`Fill this order?\n\n${action.toUpperCase()} ${quantity} ${product} @ ${priceDisplay}\n\nThis will create a counter-order to match.`)) {
                return;
            }
            
            const limitPrice = price > 0 ? price : null;
            const clOrdID = `FILL-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            
            const orderMsg = {
                type: "ORDER",
                clOrdID: clOrdID,
                side: side,
                mode: limitPrice ? "LIMIT" : "MARKET",
                product: product,
                qty: quantity,
                limitPrice: limitPrice
            };
            
            sendMessage(orderMsg);
            showToast(`Creating ${action} order to fill...`, 'info');
        }
        
        // ===== SDK Emulator Functions (Global Scope) =====
        
        function logToEmulator(message, type = 'info') {
            const log = document.getElementById('sdk-emulation-log');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'sent' ? 'ðŸ“¤' : type === 'received' ? 'ðŸ“¥' : type === 'error' ? 'âŒ' : 'â„¹ï¸';
            const color = type === 'sent' ? 'text-blue-400' : type === 'received' ? 'text-green-400' : type === 'error' ? 'text-red-400' : 'text-gray-400';
            
            const entry = document.createElement('div');
            entry.className = `${color} mb-1`;
            entry.innerHTML = `[${timestamp}] ${icon} ${message}`;
            log.appendChild(entry);
            
            // Auto scroll to bottom
            log.scrollTop = log.scrollHeight;
            
            // Keep only last 100 entries
            while (log.children.length > 100) {
                log.removeChild(log.firstChild);
            }
        }
        
        function clearEmulationLog() {
            const log = document.getElementById('sdk-emulation-log');
            log.innerHTML = '<div class="text-gray-500">Log cleared. Ready to emulate SDK events...</div>';
        }
        
        // Helper function to send SDK emulator messages
        function sendSDKEmulatorMessage(messageType, payload) {
            const targetTeam = document.getElementById('sdk-target-team').value.trim();
            
            if (!targetTeam) {
                showToast('Please login first to auto-fill your team name', 'warning');
                logToEmulator('âŒ Cannot send - not logged in. Login first to set target team.', 'error');
                return false;
            }
            
            if (!isAuthenticated) {
                showToast('Please login first', 'warning');
                return false;
            }
            
            const emulatorMessage = {
                type: 'SDK_EMULATOR',
                targetTeam: targetTeam,
                messageType: messageType,
                messagePayload: payload
            };
            
            sendMessage(emulatorMessage);
            logToEmulator(`ðŸ“¤ Sending ${messageType} to your Java SDK client (${targetTeam})...`, 'sent');
            return true;
        }
        
        function emulateOffer() {
            const offerId = 'OFFER-' + Date.now();
            const buyer = document.getElementById('sdk-offer-buyer').value;
            const product = document.getElementById('sdk-offer-product').value;
            const qty = parseInt(document.getElementById('sdk-offer-qty').value);
            const maxPrice = parseFloat(document.getElementById('sdk-offer-price').value);
            const expiresIn = parseInt(document.getElementById('sdk-offer-expires').value);
            
            const payload = {
                offerId: offerId,
                buyer: buyer,
                product: product,
                quantityRequested: qty,
                maxPrice: maxPrice,
                expiresIn: expiresIn,
                timestamp: new Date().toISOString()
            };
            
            if (sendSDKEmulatorMessage('OFFER', payload)) {
                showToast(`ðŸ“¬ OFFER sent: ${buyer} wants ${qty} ${product} @ $${maxPrice}`, 'info', 4000);
            }
        }
        
        function emulateFill() {
            const side = document.getElementById('sdk-fill-side').value;
            const product = document.getElementById('sdk-fill-product').value;
            const qty = parseInt(document.getElementById('sdk-fill-qty').value);
            const fillPrice = parseFloat(document.getElementById('sdk-fill-price').value);
            const counterparty = document.getElementById('sdk-fill-counterparty').value;
            
            const payload = {
                clOrdID: 'ORD-' + Date.now(),
                side: side,
                product: product,
                fillQty: qty,
                fillPrice: fillPrice,
                counterparty: counterparty,
                serverTime: new Date().toISOString()
            };
            
            if (sendSDKEmulatorMessage('FILL', payload)) {
                showToast(`âœ… FILL sent: ${side} ${qty} ${product} @ $${fillPrice}`, 'success', 4000);
            }
        }
        
        function emulateError() {
            const code = document.getElementById('sdk-error-code').value;
            const reason = document.getElementById('sdk-error-message').value;
            
            const payload = {
                code: code,
                reason: reason,
                timestamp: new Date().toISOString()
            };
            
            if (sendSDKEmulatorMessage('ERROR', payload)) {
                showToast(`âŒ ERROR sent: ${code} - ${reason}`, 'error', 4000);
            }
        }
        
        function emulateInventoryUpdate() {
            const product = document.getElementById('sdk-inv-product').value;
            const qty = parseInt(document.getElementById('sdk-inv-qty').value);
            
            // Build inventory object
            const inventory = {};
            inventory[product] = qty;
            
            const payload = {
                inventory: inventory,
                timestamp: new Date().toISOString()
            };
            
            if (sendSDKEmulatorMessage('INVENTORY_UPDATE', payload)) {
                showToast(`ðŸ“¦ INVENTORY_UPDATE sent: ${product} = ${qty}`, 'info', 4000);
            }
        }
        
        function emulateBalanceUpdate() {
            const newBalance = parseFloat(document.getElementById('sdk-balance-amount').value);
            const reason = document.getElementById('sdk-balance-reason').value;
            
            const payload = {
                newBalance: newBalance,
                reason: reason,
                timestamp: new Date().toISOString()
            };
            
            if (sendSDKEmulatorMessage('BALANCE_UPDATE', payload)) {
                showToast(`ðŸ’° BALANCE_UPDATE sent: $${newBalance.toFixed(2)}`, 'info', 4000);
            }
        }
        
        function emulateBroadcast() {
            const sender = document.getElementById('sdk-broadcast-sender').value;
            const message = document.getElementById('sdk-broadcast-message').value;
            
            const payload = {
                sender: sender,
                message: message,
                timestamp: new Date().toISOString()
            };
            
            if (sendSDKEmulatorMessage('BROADCAST_NOTIFICATION', payload)) {
                showToast(`ðŸ“¢ BROADCAST sent: "${message}"`, 'info', 4000);
            }
        }
        
        function emulateOrderAck() {
            const clOrdID = document.getElementById('sdk-ack-orderid').value || 'ORD-' + Date.now();
            const status = document.getElementById('sdk-ack-status').value;
            
            const payload = {
                clOrdID: clOrdID,
                status: status,
                timestamp: new Date().toISOString()
            };
            
            if (sendSDKEmulatorMessage('ORDER_ACK', payload)) {
                showToast(`âœ“ ORDER_ACK sent: ${status}`, 'info', 4000);
            }
        }
        
        function emulateTicker() {
            const product = document.getElementById('sdk-ticker-product').value;
            const price = parseFloat(document.getElementById('sdk-ticker-price').value);
            
            const payload = {
                product: product,
                price: price,
                bid: price - 0.5,
                ask: price + 0.5,
                volume: Math.floor(Math.random() * 1000),
                timestamp: new Date().toISOString()
            };
            
            if (sendSDKEmulatorMessage('TICKER', payload)) {
                showToast(`ðŸ“Š TICKER sent: ${product} @ $${price}`, 'info', 4000);
            }
        }
        
        function emulateEventDelta() {
            const eventCount = parseInt(document.getElementById('sdk-delta-count').value);
            
            // Generate sample events
            const events = [];
            for (let i = 0; i < eventCount; i++) {
                events.push({
                    type: 'FILL',
                    clOrdID: 'ORD-' + (Date.now() + i),
                    side: i % 2 === 0 ? 'BUY' : 'SELL',
                    product: 'FOSFO',
                    fillQty: 5,
                    fillPrice: 15.0 + (i * 0.1),
                    counterparty: 'RESYNC-TEAM',
                    serverTime: new Date().toISOString()
                });
            }
            
            const payload = {
                events: events,
                timestamp: new Date().toISOString()
            };
            
            if (sendSDKEmulatorMessage('EVENT_DELTA', payload)) {
                showToast(`ðŸ”„ EVENT_DELTA sent with ${eventCount} events`, 'info', 4000);
            }
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial state
            updateStatus('disconnected', 'Disconnected');
            disableButtons();
            
            // Test function to manually add a transaction (for debugging)
            window.addTestTransaction = function() {
                const testFill = {
                    side: 'BUY',
                    fillQty: 10,
                    product: 'FOSFO',
                    fillPrice: 15.50,
                    counterparty: 'TestTeam',
                    serverTime: Date.now()
                };
                addTransactionToList(testFill);
                showToast('Test transaction added', 'success');
            };
        });
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.altKey) {
                    switch(e.key) {
                        case 'd':
                            e.preventDefault();
                            switchSidebarTab('debug');
                            break;
                        case 's':
                            e.preventDefault();
                            switchSidebarTab('simulator');
                            break;
                        case 't':
                            e.preventDefault();
                            switchMainTab('trading');
                            break;
                    }
                }
                
                if (e.ctrlKey && !e.altKey) {
                    switch(e.key) {
                        case 'b':
                            e.preventDefault();
                            if (!document.getElementById('quick-buy-fosfo').disabled) {
                                quickTrade('BUY', 'FOSFO', 5);
                            }
                            break;
                        case 'r':
                            if (e.shiftKey) {
                                e.preventDefault();
                                if (!document.getElementById('refresh-orders-btn').disabled) {
                                    refreshMyOrders();
                                }
                            }
                            break;
                    }
                }
            });
    </script>
</body>
</html>